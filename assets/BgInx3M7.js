import{i as jc,o as Wc,w as qc,a as Hc,b as Qo,d as Wn,c as Kc,e as Gc,u as Vc,f as Zo,F as Jc,g as kr,h as _t,j as Mr,k as Pe,r as wt,n as bt,l as K,t as Sn,m as $r,p as tt,q as Tn,s as Yc,E as Xc,v as On,x as ua,_ as ca,C as zc,y as Qc,z as Zc,A as ef,B as tf,D as rf,G as _i,H as nf,I as of,T as sf,J as fa,K as af,L as uf,M as cf,N as ff,O as lf,P as hf,Q as df,R as pf,S as D,U as la,V as vo,W as yf,X as gf,Y as an,Z as un,$ as mf,a0 as vf}from"./app-Bx0gTu8y.js";const _f=(...t)=>e=>{t.forEach(r=>{jc(r)?r(e):r.value=e})},wf=(t,e,r,n)=>{let o={offsetX:0,offsetY:0};const i=s=>{const u=s.clientX,d=s.clientY,{offsetX:m,offsetY:v}=o,b=t.value.getBoundingClientRect(),I=b.left,E=b.top,A=b.width,_=b.height,O=document.documentElement.clientWidth,T=document.documentElement.clientHeight,B=-I+m,P=-E+v,F=O-I-A+m,q=T-E-_+v,H=$=>{let te=m+$.clientX-u,G=v+$.clientY-d;n!=null&&n.value||(te=Math.min(Math.max(te,B),F),G=Math.min(Math.max(G,P),q)),o={offsetX:te,offsetY:G},t.value&&(t.value.style.transform=`translate(${Qo(te)}, ${Qo(G)})`)},oe=()=>{document.removeEventListener("mousemove",H),document.removeEventListener("mouseup",oe)};document.addEventListener("mousemove",H),document.addEventListener("mouseup",oe)},a=()=>{e.value&&t.value&&e.value.addEventListener("mousedown",i)},c=()=>{e.value&&t.value&&e.value.removeEventListener("mousedown",i)},h=()=>{o={offsetX:0,offsetY:0},t.value&&(t.value.style.transform="none")};return Wc(()=>{qc(()=>{r.value?a():c()})}),Hc(()=>{c()}),{resetPosition:h}},ha=Symbol("dialogInjectionKey"),Ef=Wn({name:"ElDialogContent"}),bf=Wn({...Ef,props:Kc,emits:Gc,setup(t,{expose:e}){const r=t,{t:n}=Vc(),{Close:o}=zc,{dialogRef:i,headerRef:a,bodyId:c,ns:h,style:s}=Zo(ha),{focusTrapRef:u}=Zo(Jc),d=kr(()=>[h.b(),h.is("fullscreen",r.fullscreen),h.is("draggable",r.draggable),h.is("align-center",r.alignCenter),{[h.m("center")]:r.center}]),m=_f(u,i),v=kr(()=>r.draggable),b=kr(()=>r.overflow),{resetPosition:I}=wf(i,a,v,b);return e({resetPosition:I}),(E,A)=>(_t(),Mr("div",{ref:K(m),class:bt(K(d)),style:ua(K(s)),tabindex:"-1"},[Pe("header",{ref_key:"headerRef",ref:a,class:bt([K(h).e("header"),{"show-close":E.showClose}])},[wt(E.$slots,"header",{},()=>[Pe("span",{role:"heading","aria-level":E.ariaLevel,class:bt(K(h).e("title"))},Sn(E.title),11,["aria-level"])]),E.showClose?(_t(),Mr("button",{key:0,"aria-label":K(n)("el.dialog.close"),class:bt(K(h).e("headerbtn")),type:"button",onClick:_=>E.$emit("close")},[$r(K(Xc),{class:bt(K(h).e("close"))},{default:tt(()=>[(_t(),Tn(Yc(E.closeIcon||K(o))))]),_:1},8,["class"])],10,["aria-label","onClick"])):On("v-if",!0)],2),Pe("div",{id:K(c),class:bt(K(h).e("body"))},[wt(E.$slots,"default")],10,["id"]),E.$slots.footer?(_t(),Mr("footer",{key:0,class:bt(K(h).e("footer"))},[wt(E.$slots,"footer")],2)):On("v-if",!0)],6))}});var Sf=ca(bf,[["__file","dialog-content.vue"]]);const Af=Wn({name:"ElDialog",inheritAttrs:!1}),If=Wn({...Af,props:Qc,emits:Zc,setup(t,{expose:e}){const r=t,n=ef();tf({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},kr(()=>!!n.title));const o=rf("dialog"),i=_i(),a=_i(),c=_i(),{visible:h,titleId:s,bodyId:u,style:d,overlayDialogStyle:m,rendered:v,zIndex:b,afterEnter:I,afterLeave:E,beforeLeave:A,handleClose:_,onModalClick:O,onOpenAutoFocus:T,onCloseAutoFocus:B,onCloseRequested:P,onFocusoutPrevented:F}=nf(r,i);of(ha,{dialogRef:i,headerRef:a,bodyId:u,ns:o,rendered:v,style:d});const q=df(O),H=kr(()=>r.draggable&&!r.fullscreen);return e({visible:h,dialogContentRef:c,resetPosition:()=>{var $;($=c.value)==null||$.resetPosition()}}),($,te)=>(_t(),Tn(K(hf),{to:$.appendTo,disabled:$.appendTo!=="body"?!1:!$.appendToBody},{default:tt(()=>[$r(sf,{name:"dialog-fade",onAfterEnter:K(I),onAfterLeave:K(E),onBeforeLeave:K(A),persisted:""},{default:tt(()=>[fa($r(K(af),{"custom-mask-event":"",mask:$.modal,"overlay-class":$.modalClass,"z-index":K(b)},{default:tt(()=>[Pe("div",{role:"dialog","aria-modal":"true","aria-label":$.title||void 0,"aria-labelledby":$.title?void 0:K(s),"aria-describedby":K(u),class:bt(`${K(o).namespace.value}-overlay-dialog`),style:ua(K(m)),onClick:K(q).onClick,onMousedown:K(q).onMousedown,onMouseup:K(q).onMouseup},[$r(K(uf),{loop:"",trapped:K(h),"focus-start-el":"container",onFocusAfterTrapped:K(T),onFocusAfterReleased:K(B),onFocusoutPrevented:K(F),onReleaseRequested:K(P)},{default:tt(()=>[K(v)?(_t(),Tn(Sf,cf({key:0,ref_key:"dialogContentRef",ref:c},$.$attrs,{center:$.center,"align-center":$.alignCenter,"close-icon":$.closeIcon,draggable:K(H),overflow:$.overflow,fullscreen:$.fullscreen,"show-close":$.showClose,title:$.title,"aria-level":$.headerAriaLevel,onClose:K(_)}),ff({header:tt(()=>[$.$slots.title?wt($.$slots,"title",{key:1}):wt($.$slots,"header",{key:0,close:K(_),titleId:K(s),titleClass:K(o).e("title")})]),default:tt(()=>[wt($.$slots,"default")]),_:2},[$.$slots.footer?{name:"footer",fn:tt(()=>[wt($.$slots,"footer")])}:void 0]),1040,["center","align-center","close-icon","draggable","overflow","fullscreen","show-close","title","aria-level","onClose"])):On("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,["aria-label","aria-labelledby","aria-describedby","onClick","onMousedown","onMouseup"])]),_:3},8,["mask","overlay-class","z-index"]),[[lf,K(h)]])]),_:3},8,["onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}});var Tf=ca(If,[["__file","dialog.vue"]]);const da=pf(Tf);var ke={},Yr={},xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.COMMUNITY_SITE_URL=xe.IS_DEBUG_MODE=xe.getProtocol=xe.setProtocol=xe.getSdkName=xe.setSdkName=void 0;var pa="@cloudbase/js-sdk";function Of(t){pa=t}xe.setSdkName=Of;function xf(){return pa}xe.getSdkName=xf;var ya=typeof location<"u"&&location.protocol==="http:"?"http:":"https:";function Nf(t){ya=t}xe.setProtocol=Nf;function Rf(){return ya}xe.getProtocol=Rf;xe.IS_DEBUG_MODE=!1;xe.COMMUNITY_SITE_URL="https://support.qq.com/products/148793";var qn={};Object.defineProperty(qn,"__esModule",{value:!0});qn.ERRORS=void 0;qn.ERRORS={INVALID_PARAMS:"INVALID_PARAMS",INVALID_SYNTAX:"INVALID_SYNTAX",INVALID_OPERATION:"INVALID_OPERATION",OPERATION_FAIL:"OPERATION_FAIL",NETWORK_ERROR:"NETWORK_ERROR",UNKOWN_ERROR:"UNKOWN_ERROR"};(function(t){var e=D&&D.__createBinding||(Object.create?function(n,o,i,a){a===void 0&&(a=i),Object.defineProperty(n,a,{enumerable:!0,get:function(){return o[i]}})}:function(n,o,i,a){a===void 0&&(a=i),n[a]=o[i]}),r=D&&D.__exportStar||function(n,o){for(var i in n)i!=="default"&&!o.hasOwnProperty(i)&&e(o,n,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(xe,t),r(qn,t)})(Yr);var ga={},hr={},xn;(function(t){t.local="local",t.none="none",t.session="session"})(xn||(xn={}));var ma=function(){function t(){}return t}(),Cf=function(){function t(){}return t}();function no(t,e,r){r===void 0&&(r={});var n=/\?/.test(e),o="";for(var i in r)o===""?!n&&(e+="?"):o+="&",o+=i+"="+encodeURIComponent(r[i]);return e+=o,/^http(s)?\:\/\//.test(e)?e:""+t+e}const Pf=Object.freeze(Object.defineProperty({__proto__:null,AbstractSDKRequest:ma,AbstractStorage:Cf,get StorageType(){return xn},formatUrl:no},Symbol.toStringTag,{value:"Module"})),va=la(Pf);var j={},_a={exports:{}};function Bf(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var wi={exports:{}};const Df={},Lf=Object.freeze(Object.defineProperty({__proto__:null,default:Df},Symbol.toStringTag,{value:"Module"})),Ff=la(Lf);var es;function Xr(){return es||(es=1,function(t,e){(function(r,n){t.exports=n()})(D,function(){var r=r||function(n,o){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof D<"u"&&D.crypto&&(i=D.crypto),!i&&typeof Bf=="function")try{i=Ff}catch{}var a=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},c=Object.create||function(){function _(){}return function(O){var T;return _.prototype=O,T=new _,_.prototype=null,T}}(),h={},s=h.lib={},u=s.Base=function(){return{extend:function(_){var O=c(this);return _&&O.mixIn(_),(!O.hasOwnProperty("init")||this.init===O.init)&&(O.init=function(){O.$super.init.apply(this,arguments)}),O.init.prototype=O,O.$super=this,O},create:function(){var _=this.extend();return _.init.apply(_,arguments),_},init:function(){},mixIn:function(_){for(var O in _)_.hasOwnProperty(O)&&(this[O]=_[O]);_.hasOwnProperty("toString")&&(this.toString=_.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=s.WordArray=u.extend({init:function(_,O){_=this.words=_||[],O!=o?this.sigBytes=O:this.sigBytes=_.length*4},toString:function(_){return(_||v).stringify(this)},concat:function(_){var O=this.words,T=_.words,B=this.sigBytes,P=_.sigBytes;if(this.clamp(),B%4)for(var F=0;F<P;F++){var q=T[F>>>2]>>>24-F%4*8&255;O[B+F>>>2]|=q<<24-(B+F)%4*8}else for(var H=0;H<P;H+=4)O[B+H>>>2]=T[H>>>2];return this.sigBytes+=P,this},clamp:function(){var _=this.words,O=this.sigBytes;_[O>>>2]&=4294967295<<32-O%4*8,_.length=n.ceil(O/4)},clone:function(){var _=u.clone.call(this);return _.words=this.words.slice(0),_},random:function(_){for(var O=[],T=0;T<_;T+=4)O.push(a());return new d.init(O,_)}}),m=h.enc={},v=m.Hex={stringify:function(_){for(var O=_.words,T=_.sigBytes,B=[],P=0;P<T;P++){var F=O[P>>>2]>>>24-P%4*8&255;B.push((F>>>4).toString(16)),B.push((F&15).toString(16))}return B.join("")},parse:function(_){for(var O=_.length,T=[],B=0;B<O;B+=2)T[B>>>3]|=parseInt(_.substr(B,2),16)<<24-B%8*4;return new d.init(T,O/2)}},b=m.Latin1={stringify:function(_){for(var O=_.words,T=_.sigBytes,B=[],P=0;P<T;P++){var F=O[P>>>2]>>>24-P%4*8&255;B.push(String.fromCharCode(F))}return B.join("")},parse:function(_){for(var O=_.length,T=[],B=0;B<O;B++)T[B>>>2]|=(_.charCodeAt(B)&255)<<24-B%4*8;return new d.init(T,O)}},I=m.Utf8={stringify:function(_){try{return decodeURIComponent(escape(b.stringify(_)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(_){return b.parse(unescape(encodeURIComponent(_)))}},E=s.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(_){typeof _=="string"&&(_=I.parse(_)),this._data.concat(_),this._nDataBytes+=_.sigBytes},_process:function(_){var O,T=this._data,B=T.words,P=T.sigBytes,F=this.blockSize,q=F*4,H=P/q;_?H=n.ceil(H):H=n.max((H|0)-this._minBufferSize,0);var oe=H*F,$=n.min(oe*4,P);if(oe){for(var te=0;te<oe;te+=F)this._doProcessBlock(B,te);O=B.splice(0,oe),T.sigBytes-=$}return new d.init(O,$)},clone:function(){var _=u.clone.call(this);return _._data=this._data.clone(),_},_minBufferSize:0});s.Hasher=E.extend({cfg:u.extend(),init:function(_){this.cfg=this.cfg.extend(_),this.reset()},reset:function(){E.reset.call(this),this._doReset()},update:function(_){return this._append(_),this._process(),this},finalize:function(_){_&&this._append(_);var O=this._doFinalize();return O},blockSize:16,_createHelper:function(_){return function(O,T){return new _.init(T).finalize(O)}},_createHmacHelper:function(_){return function(O,T){return new A.HMAC.init(_,T).finalize(O)}}});var A=h.algo={};return h}(Math);return r})}(wi)),wi.exports}var Ei={exports:{}},ts;function Uf(){return ts||(ts=1,function(t,e){(function(r,n){t.exports=n(Xr())})(D,function(r){return function(n){var o=r,i=o.lib,a=i.WordArray,c=i.Hasher,h=o.algo,s=[],u=[];(function(){function v(A){for(var _=n.sqrt(A),O=2;O<=_;O++)if(!(A%O))return!1;return!0}function b(A){return(A-(A|0))*4294967296|0}for(var I=2,E=0;E<64;)v(I)&&(E<8&&(s[E]=b(n.pow(I,1/2))),u[E]=b(n.pow(I,1/3)),E++),I++})();var d=[],m=h.SHA256=c.extend({_doReset:function(){this._hash=new a.init(s.slice(0))},_doProcessBlock:function(v,b){for(var I=this._hash.words,E=I[0],A=I[1],_=I[2],O=I[3],T=I[4],B=I[5],P=I[6],F=I[7],q=0;q<64;q++){if(q<16)d[q]=v[b+q]|0;else{var H=d[q-15],oe=(H<<25|H>>>7)^(H<<14|H>>>18)^H>>>3,$=d[q-2],te=($<<15|$>>>17)^($<<13|$>>>19)^$>>>10;d[q]=oe+d[q-7]+te+d[q-16]}var G=T&B^~T&P,Ee=E&A^E&_^A&_,Ae=(E<<30|E>>>2)^(E<<19|E>>>13)^(E<<10|E>>>22),rt=(T<<26|T>>>6)^(T<<21|T>>>11)^(T<<7|T>>>25),ne=F+rt+G+u[q]+d[q],Ie=Ae+Ee;F=P,P=B,B=T,T=O+ne|0,O=_,_=A,A=E,E=ne+Ie|0}I[0]=I[0]+E|0,I[1]=I[1]+A|0,I[2]=I[2]+_|0,I[3]=I[3]+O|0,I[4]=I[4]+T|0,I[5]=I[5]+B|0,I[6]=I[6]+P|0,I[7]=I[7]+F|0},_doFinalize:function(){var v=this._data,b=v.words,I=this._nDataBytes*8,E=v.sigBytes*8;return b[E>>>5]|=128<<24-E%32,b[(E+64>>>9<<4)+14]=n.floor(I/4294967296),b[(E+64>>>9<<4)+15]=I,v.sigBytes=b.length*4,this._process(),this._hash},clone:function(){var v=c.clone.call(this);return v._hash=this._hash.clone(),v}});o.SHA256=c._createHelper(m),o.HmacSHA256=c._createHmacHelper(m)}(Math),r.SHA256})}(Ei)),Ei.exports}var bi={exports:{}},rs;function kf(){return rs||(rs=1,function(t,e){(function(r,n){t.exports=n(Xr())})(D,function(r){(function(){var n=r,o=n.lib,i=o.Base,a=n.enc,c=a.Utf8,h=n.algo;h.HMAC=i.extend({init:function(s,u){s=this._hasher=new s.init,typeof u=="string"&&(u=c.parse(u));var d=s.blockSize,m=d*4;u.sigBytes>m&&(u=s.finalize(u)),u.clamp();for(var v=this._oKey=u.clone(),b=this._iKey=u.clone(),I=v.words,E=b.words,A=0;A<d;A++)I[A]^=1549556828,E[A]^=909522486;v.sigBytes=b.sigBytes=m,this.reset()},reset:function(){var s=this._hasher;s.reset(),s.update(this._iKey)},update:function(s){return this._hasher.update(s),this},finalize:function(s){var u=this._hasher,d=u.finalize(s);u.reset();var m=u.finalize(this._oKey.clone().concat(d));return m}})})()})}(bi)),bi.exports}(function(t,e){(function(r,n,o){t.exports=n(Xr(),Uf(),kf())})(D,function(r){return r.HmacSHA256})})(_a);var Mf=_a.exports,wa={exports:{}};(function(t,e){(function(r,n){t.exports=n(Xr())})(D,function(r){return function(){var n=r,o=n.lib,i=o.WordArray,a=n.enc;a.Base64={stringify:function(h){var s=h.words,u=h.sigBytes,d=this._map;h.clamp();for(var m=[],v=0;v<u;v+=3)for(var b=s[v>>>2]>>>24-v%4*8&255,I=s[v+1>>>2]>>>24-(v+1)%4*8&255,E=s[v+2>>>2]>>>24-(v+2)%4*8&255,A=b<<16|I<<8|E,_=0;_<4&&v+_*.75<u;_++)m.push(d.charAt(A>>>6*(3-_)&63));var O=d.charAt(64);if(O)for(;m.length%4;)m.push(O);return m.join("")},parse:function(h){var s=h.length,u=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var m=0;m<u.length;m++)d[u.charCodeAt(m)]=m}var v=u.charAt(64);if(v){var b=h.indexOf(v);b!==-1&&(s=b)}return c(h,s,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function c(h,s,u){for(var d=[],m=0,v=0;v<s;v++)if(v%4){var b=u[h.charCodeAt(v-1)]<<v%4*2,I=u[h.charCodeAt(v)]>>>6-v%4*2,E=b|I;d[m>>>2]|=E<<24-m%4*8,m++}return i.create(d,m)}}(),r.enc.Base64})})(wa);var $f=wa.exports,Ea={exports:{}};(function(t,e){(function(r,n){t.exports=n(Xr())})(D,function(r){return r.enc.Utf8})})(Ea);var jf=Ea.exports,_o=D&&D.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(j,"__esModule",{value:!0});j.transformPhone=j.sleep=j.printGroupLog=j.throwError=j.printInfo=j.printError=j.printWarn=j.execCallback=j.createPromiseCallback=j.removeParam=j.getHash=j.getQuery=j.toQueryString=j.createSign=j.formatUrl=j.genSeqId=j.isFormData=j.isInstanceOf=j.isNull=j.isPalinObject=j.isUndefined=j.isString=j.isArray=void 0;var Wf=_o(Mf),qf=_o($f),ns=_o(jf),Hn=Yr;function Hf(t){return Object.prototype.toString.call(t)==="[object Array]"}j.isArray=Hf;function Kf(t){return typeof t=="string"}j.isString=Kf;function Gf(t){return typeof t>"u"}j.isUndefined=Gf;function Vf(t){return Object.prototype.toString.call(t)==="[object Object]"}j.isPalinObject=Vf;function Jf(t){return Object.prototype.toString.call(t)==="[object Null]"}j.isNull=Jf;function Yf(t,e){return t instanceof e}j.isInstanceOf=Yf;function Xf(t){return Object.prototype.toString.call(t)==="[object FormData]"}j.isFormData=Xf;function zf(){return Math.random().toString(16).slice(2)}j.genSeqId=zf;function Qf(t,e,r){r===void 0&&(r={});var n=/\?/.test(e),o="";for(var i in r)o===""?!n&&(e+="?"):o+="&",o+=i+"="+encodeURIComponent(r[i]);return e+=o,/^http(s)?\:\/\//.test(e)?e:""+t+e}j.formatUrl=Qf;function Si(t){var e=qf.default.stringify(t);return e=e.replace(/=+$/,""),e=e.replace(/\+/g,"-"),e=e.replace(/\//g,"_"),e}function Zf(t,e){var r={alg:"HS256",typ:"JWT"},n=Si(ns.default.parse(JSON.stringify(r))),o=Si(ns.default.parse(JSON.stringify(t))),i=n+"."+o,a=Si(Wf.default(i,e));return i+"."+a}j.createSign=Zf;function el(t){t===void 0&&(t={});var e=[];for(var r in t)e.push(r+"="+encodeURIComponent(t[r]));return e.join("&")}j.toQueryString=el;function tl(t,e){if(typeof window>"u")return!1;var r=e||window.location.search,n=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),o=r.substr(r.indexOf("?")+1).match(n);return o!=null?o[2]:""}j.getQuery=tl;j.getHash=function(t){if(typeof window>"u")return"";var e=window.location.hash.match(new RegExp("[#?&/]"+t+"=([^&#]*)"));return e?e[1]:""};function rl(t,e){var r=e.split("?")[0],n,o=[],i=e.indexOf("?")!==-1?e.split("?")[1]:"";if(i!==""){o=i.split("&");for(var a=o.length-1;a>=0;a-=1)n=o[a].split("=")[0],n===t&&o.splice(a,1);r=r+"?"+o.join("&")}return r}j.removeParam=rl;function nl(){var t;if(!Promise){t=function(){},t.promise={};var e=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(t.promise,"then",{get:e}),Object.defineProperty(t.promise,"catch",{get:e}),t}var r=new Promise(function(n,o){t=function(i,a){return i?o(i):n(a)}});return t.promise=r,t}j.createPromiseCallback=nl;function il(t,e,r){if(r===void 0&&(r=null),t&&typeof t=="function")return t(e,r);if(e)throw e;return r}j.execCallback=il;function ol(t,e){console.warn("["+Hn.getSdkName()+"]["+t+"]:"+e)}j.printWarn=ol;function sl(t,e){console.error({code:t,msg:"["+Hn.getSdkName()+"]["+t+"]:"+e})}j.printError=sl;function al(t,e){console.log("["+Hn.getSdkName()+"]["+t+"]:"+e)}j.printInfo=al;function ul(t,e){throw new Error(JSON.stringify({code:t,msg:"["+Hn.getSdkName()+"]["+t+"]:"+e}))}j.throwError=ul;function cl(t){var e=t.title,r=t.subtitle,n=r===void 0?"":r,o=t.content,i=o===void 0?[]:o,a=t.printTrace,c=a===void 0?!1:a,h=t.collapsed,s=h===void 0?!1:h;s?console.groupCollapsed(e,n):console.group(e,n);for(var u=0,d=i;u<d.length;u++){var m=d[u],v=m.type,b=m.body;switch(v){case"info":console.log(b);break;case"warn":console.warn(b);break;case"error":console.error(b);break}}c&&console.trace("stack trace:"),console.groupEnd()}j.printGroupLog=cl;j.sleep=function(t){return t===void 0&&(t=0),new Promise(function(e){return setTimeout(e,t)})};function fl(t){return"+86"+t}j.transformPhone=fl;var ll=D&&D.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),He=D&&D.__assign||function(){return He=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},He.apply(this,arguments)},hl=D&&D.__awaiter||function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},dl=D&&D.__generator||function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(hr,"__esModule",{value:!0});hr.WebRequest=hr.genAdapter=void 0;var pl=va,Ai=j,yl=xe,ba=function(t){ll(e,t);function e(r){var n=t.call(this)||this,o=r.timeout,i=r.timeoutMsg,a=r.restrictedMethods;return n._timeout=o||0,n._timeoutMsg=i||"请求超时",n._restrictedMethods=a||["get","post","upload","download"],n}return e.prototype.get=function(r){return this._request(He(He({},r),{method:"get"}),this._restrictedMethods.includes("get"))},e.prototype.post=function(r){return this._request(He(He({},r),{method:"post"}),this._restrictedMethods.includes("post"))},e.prototype.put=function(r){return this._request(He(He({},r),{method:"put"}))},e.prototype.upload=function(r){var n=r.data,o=r.file,i=r.name,a=new FormData;for(var c in n)a.append(c,n[c]);return a.append("key",i),a.append("file",o),this._request(He(He({},r),{data:a,method:"post"}),this._restrictedMethods.includes("upload"))},e.prototype.download=function(r){return hl(this,void 0,void 0,function(){var n,o,i,a;return dl(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.get(He(He({},r),{headers:{},responseType:"blob"}))];case 1:return n=c.sent().data,o=window.URL.createObjectURL(new Blob([n])),i=decodeURIComponent(new URL(r.url).pathname.split("/").pop()||""),a=document.createElement("a"),a.href=o,a.setAttribute("download",i),a.style.display="none",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(o),document.body.removeChild(a),[3,3];case 2:return c.sent(),[3,3];case 3:return[2,new Promise(function(h){h({statusCode:200,tempFilePath:r.url})})]}})})},e.prototype._request=function(r,n){var o=this;n===void 0&&(n=!1);var i=String(r.method).toLowerCase()||"get";return new Promise(function(a){var c=r.url,h=r.headers,s=h===void 0?{}:h,u=r.data,d=r.responseType,m=r.withCredentials,v=r.body,b=r.onUploadProgress,I=Ai.formatUrl(yl.getProtocol(),c,i==="get"?u:{}),E=new XMLHttpRequest;E.open(i,I),d&&(E.responseType=d);for(var A in s)E.setRequestHeader(A,s[A]);var _;b&&E.upload.addEventListener("progress",b),E.onreadystatechange=function(){var T={};if(E.readyState===4){var B=E.getAllResponseHeaders(),P=B.trim().split(/[\r\n]+/),F={};P.forEach(function(q){var H=q.split(": "),oe=H.shift().toLowerCase(),$=H.join(": ");F[oe]=$}),T.header=F,T.statusCode=E.status;try{T.data=d==="blob"?E.response:JSON.parse(E.responseText)}catch{T.data=d==="blob"?E.response:E.responseText}clearTimeout(_),a(T)}},n&&o._timeout&&(_=setTimeout(function(){console.warn(o._timeoutMsg),E.abort()},o._timeout));var O;Ai.isFormData(u)?O=u:s["content-type"]==="application/x-www-form-urlencoded"?O=Ai.toQueryString(u):v?O=v:O=u?JSON.stringify(u):void 0,m&&(E.withCredentials=!0),E.send(O)})},e}(pl.AbstractSDKRequest);hr.WebRequest=ba;function gl(){var t={root:window,reqClass:ba,wsClass:WebSocket,localStorage,sessionStorage};return t}hr.genAdapter=gl;(function(t){var e=D&&D.__createBinding||(Object.create?function(s,u,d,m){m===void 0&&(m=d),Object.defineProperty(s,m,{enumerable:!0,get:function(){return u[d]}})}:function(s,u,d,m){m===void 0&&(m=d),s[m]=u[d]}),r=D&&D.__setModuleDefault||(Object.create?function(s,u){Object.defineProperty(s,"default",{enumerable:!0,value:u})}:function(s,u){s.default=u}),n=D&&D.__importStar||function(s){if(s&&s.__esModule)return s;var u={};if(s!=null)for(var d in s)d!=="default"&&Object.hasOwnProperty.call(s,d)&&e(u,s,d);return r(u,s),u};Object.defineProperty(t,"__esModule",{value:!0}),t.useDefaultAdapter=t.useAdapters=t.RUNTIME=void 0;var o=n(hr),i=j,a;(function(s){s.WEB="web",s.WX_MP="wx_mp"})(a=t.RUNTIME||(t.RUNTIME={}));function c(s){for(var u=i.isArray(s)?s:[s],d=0,m=u;d<m.length;d++){var v=m[d],b=v.isMatch,I=v.genAdapter,E=v.runtime;if(b())return{adapter:I(),runtime:E}}}t.useAdapters=c;function h(){return{adapter:o.genAdapter(),runtime:a.WEB}}t.useDefaultAdapter=h})(ga);var Kn={},cn={},ml=D&&D.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),fn=D&&D.__awaiter||function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},ln=D&&D.__generator||function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(Kn,"__esModule",{value:!0});Kn.CloudbaseCache=void 0;var vl=va,et=j,ot=Yr,hn=function(t){ml(e,t);function e(r){var n=t.call(this)||this;return n._root=r,r.tcbCacheObject||(r.tcbCacheObject={}),n}return e.prototype.setItem=function(r,n){this._root.tcbCacheObject[r]=n},e.prototype.getItem=function(r){return this._root.tcbCacheObject[r]},e.prototype.removeItem=function(r){delete this._root.tcbCacheObject[r]},e.prototype.clear=function(){delete this._root.tcbCacheObject},e}(vl.AbstractStorage);function Ii(t,e){switch(t){case"local":return e.localStorage?e.localStorage:(et.printWarn(ot.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new hn(e.root));case"none":return new hn(e.root);case"session":return e.sessionStorage?e.sessionStorage:(et.printWarn(ot.ERRORS.INVALID_PARAMS,"sessionStorage is not supported on current platform"),new hn(e.root));default:return e.localStorage?e.localStorage:(et.printWarn(ot.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new hn(e.root))}}var _l=function(){function t(e){this.keys={};var r=e.persistence,n=e.platformInfo,o=n===void 0?{}:n,i=e.keys,a=i===void 0?{}:i,c=e.alwaysLocalKeys,h=c===void 0?[]:c;this._platformInfo=o,this._alwaysLocalKeys=h,this._storage||(this._persistence=o.adapter.primaryStorage||r,this._storage=Ii(this._persistence,o.adapter),this.keys=a)}return Object.defineProperty(t.prototype,"mode",{get:function(){return this._storage.mode||"sync"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"persistence",{get:function(){return this._persistence},enumerable:!1,configurable:!0}),t.prototype.updatePersistence=function(e){if(this.mode==="async"){et.printWarn(ot.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use updatePersistenceAsync insteed");return}if(e!==this._persistence){var r=this._persistence==="local";this._persistence=e;var n=Ii(e,this._platformInfo.adapter);for(var o in this.keys){var i=this.keys[o];if(!(r&&this._alwaysLocalKeys.includes(o))){var a=this._storage.getItem(i);!et.isUndefined(a)&&!et.isNull(a)&&(n.setItem(i,a),this._storage.removeItem(i))}}this._storage=n}},t.prototype.updatePersistenceAsync=function(e){return fn(this,void 0,void 0,function(){var r,n,o,i,a,c,h,s;return ln(this,function(u){switch(u.label){case 0:if(e===this._persistence)return[2];r=this._persistence==="local",this._persistence=e,n=Ii(e,this._platformInfo.adapter),o=[];for(i in this.keys)o.push(i);a=0,u.label=1;case 1:return a<o.length?(c=o[a],h=this.keys[c],r&&this._alwaysLocalKeys.includes(c)?[3,4]:[4,this._storage.getItem(h)]):[3,5];case 2:return s=u.sent(),!et.isUndefined(s)&&!et.isNull(s)?(n.setItem(h,s),[4,this._storage.removeItem(h)]):[3,4];case 3:u.sent(),u.label=4;case 4:return a++,[3,1];case 5:return this._storage=n,[2]}})})},t.prototype.setStore=function(e,r,n){if(this.mode==="async"){et.printWarn(ot.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use setStoreAsync insteed");return}if(this._storage)try{var o={version:n||"localCachev1",content:r};this._storage.setItem(e,JSON.stringify(o))}catch(i){throw new Error(JSON.stringify({code:ot.ERRORS.OPERATION_FAIL,msg:"["+ot.getSdkName()+"]["+ot.ERRORS.OPERATION_FAIL+"]setStore failed",info:i}))}},t.prototype.setStoreAsync=function(e,r,n){return fn(this,void 0,void 0,function(){var o;return ln(this,function(i){switch(i.label){case 0:if(!this._storage)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),o={version:n||"localCachev1",content:r},[4,this._storage.setItem(e,JSON.stringify(o))];case 2:return i.sent(),[3,4];case 3:return i.sent(),[2];case 4:return[2]}})})},t.prototype.getStore=function(e,r){var n;if(this.mode==="async"){et.printWarn(ot.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use getStoreAsync insteed");return}try{if(typeof process<"u"&&(!((n=cn)===null||n===void 0)&&n.tcb_token))return cn.tcb_token;if(!this._storage)return""}catch{return""}r=r||"localCachev1";var o=this._storage.getItem(e);if(!o)return"";if(o.indexOf(r)>=0){var i=JSON.parse(o);return i.content}else return""},t.prototype.getStoreAsync=function(e,r){var n;return fn(this,void 0,void 0,function(){var o,i;return ln(this,function(a){switch(a.label){case 0:try{if(typeof process<"u"&&(!((n=cn)===null||n===void 0)&&n.tcb_token))return[2,cn.tcb_token];if(!this._storage)return[2,""]}catch{return[2,""]}return r=r||"localCachev1",[4,this._storage.getItem(e)];case 1:return o=a.sent(),o?o.indexOf(r)>=0?(i=JSON.parse(o),[2,i.content]):[2,""]:[2,""]}})})},t.prototype.removeStore=function(e){if(this.mode==="async"){et.printWarn(ot.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use removeStoreAsync insteed");return}this._storage.removeItem(e)},t.prototype.removeStoreAsync=function(e){return fn(this,void 0,void 0,function(){return ln(this,function(r){switch(r.label){case 0:return[4,this._storage.removeItem(e)];case 1:return r.sent(),[2]}})})},t}();Kn.CloudbaseCache=_l;var De={},wl=D&&D.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),El=D&&D.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)n[o]=i[a];return n};Object.defineProperty(De,"__esModule",{value:!0});De.removeEventListener=De.activateEvent=De.addEventListener=De.CloudbaseEventEmitter=De.IErrorEvent=De.CloudbaseEvent=void 0;var is=j;function bl(t,e,r){r[t]=r[t]||[],r[t].push(e)}function Sl(t,e,r){if(r!=null&&r[t]){var n=r[t].indexOf(e);n!==-1&&r[t].splice(n,1)}}var wo=function(){function t(e,r){this.data=r||null,this.name=e}return t}();De.CloudbaseEvent=wo;var Sa=function(t){wl(e,t);function e(r,n){var o=t.call(this,"error",{error:r,data:n})||this;return o.error=r,o}return e}(wo);De.IErrorEvent=Sa;var Aa=function(){function t(){this._listeners={}}return t.prototype.on=function(e,r){return bl(e,r,this._listeners),this},t.prototype.off=function(e,r){return Sl(e,r,this._listeners),this},t.prototype.fire=function(e,r){if(is.isInstanceOf(e,Sa))return console.error(e.error),this;var n=is.isString(e)?new wo(e,r||{}):e,o=n.name;if(this._listens(o)){n.target=this;for(var i=this._listeners[o]?El(this._listeners[o]):[],a=0,c=i;a<c.length;a++){var h=c[a];h.call(this,n)}}return this},t.prototype._listens=function(e){return this._listeners[e]&&this._listeners[e].length>0},t}();De.CloudbaseEventEmitter=Aa;var Eo=new Aa;function Al(t,e){Eo.on(t,e)}De.addEventListener=Al;function Il(t,e){e===void 0&&(e={}),Eo.fire(t,e)}De.activateEvent=Il;function Tl(t,e){Eo.off(t,e)}De.removeEventListener=Tl;var Ia={},Gn={},Ol=D&&D.__awaiter||function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},xl=D&&D.__generator||function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(Gn,"__esModule",{value:!0});Gn.catchErrorsDecorator=void 0;var os=j,Nl=Yr,jr=!1;typeof navigator<"u"&&navigator.userAgent&&(jr=navigator.userAgent.indexOf("Firefox")!==-1);var Rl=jr?/(\.js\/)?__decorate(\$\d+)?<@.*\d$/:/(\/\w+\.js\.)?__decorate(\$\d+)?\s*\(.*\)$/,Ta=/https?\:\/\/.+\:\d*\/.*\.js\:\d+\:\d+/;function Cl(t){var e=t.mode,r=e===void 0?"async":e,n=t.customInfo,o=n===void 0?{}:n,i=t.title,a=t.messages,c=a===void 0?[]:a;return function(h,s,u){if(Nl.IS_DEBUG_MODE){var d=o.className||h.constructor.name,m=o.methodName||s,v=u.value,b=Pl(new Error);r==="sync"?u.value=function(){for(var I=[],E=0;E<arguments.length;E++)I[E]=arguments[E];var A=ss({err:new Error,className:d,methodName:m,sourceLink:b});try{return v.apply(this,I)}catch(P){var _=P,O=P.message,T={title:i||d+"."+m+" failed",content:[{type:"error",body:P}]};if(O&&/^\{.*\}$/.test(O)){var B=JSON.parse(O);T.subtitle=O,B.code&&(A?(A.code=B.code,A.msg=B.msg):(P.code=B.code,P.message=B.msg),_=A||P,T.content=c.map(function(F){return{type:"info",body:F}}))}throw os.printGroupLog(T),_}}:u.value=function(){for(var I=[],E=0;E<arguments.length;E++)I[E]=arguments[E];return Ol(this,void 0,void 0,function(){var A,_,O,T,B,P;return xl(this,function(F){switch(F.label){case 0:A=ss({err:new Error,className:d,methodName:m,sourceLink:b}),F.label=1;case 1:return F.trys.push([1,3,,4]),[4,v.apply(this,I)];case 2:return[2,F.sent()];case 3:throw _=F.sent(),O=_,T=_.message,B={title:i||d+"."+m+" failed",content:[{type:"error",body:_}]},T&&/^\{.*\}$/.test(T)&&(P=JSON.parse(T),B.subtitle=P,P.code&&(A?(A.code=P.code,A.message=P.msg):(_.code=P.code,_.message=P.msg),O=A||_,B.content=c.map(function(q){return{type:"info",body:q}}))),os.printGroupLog(B),O;case 4:return[2]}})})}}}}Gn.catchErrorsDecorator=Cl;function Pl(t){var e="",r=t.stack.split(`
`),n=r.findIndex(function(i){return Rl.test(i)});if(n!==-1){var o=Ta.exec(r[n+1]||"");e=o?o[0]:""}return e}function ss(t){var e=t.err,r=t.className,n=t.methodName,o=t.sourceLink;if(!o)return null;var i=e.stack.split(`
`),a=jr?/^catchErrorsDecorator\/<\/descriptor.value@.*\d$/:new RegExp(r+"\\.descriptor.value\\s*\\[as\\s"+n+"\\]\\s*\\(.*\\)$"),c=jr?/^catchErrorsDecorator\/<\/descriptor.value/:new RegExp(r+"\\.descriptor.value\\s*\\[as\\s"+n+"\\]"),h=i.findIndex(function(d){return a.test(d)}),s;if(h!==-1){var u=i.filter(function(d,m){return m>h});u.unshift(i[h].replace(c,r+"."+n).replace(Ta,o)),s=new Error,s.stack=(jr?"@debugger":"Error")+`
`+u.join(`
`)}return s}(function(t){var e=D&&D.__createBinding||(Object.create?function(n,o,i,a){a===void 0&&(a=i),Object.defineProperty(n,a,{enumerable:!0,get:function(){return o[i]}})}:function(n,o,i,a){a===void 0&&(a=i),n[a]=o[i]}),r=D&&D.__exportStar||function(n,o){for(var i in n)i!=="default"&&!o.hasOwnProperty(i)&&e(o,n,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(Gn,t)})(Ia);var Bl=D&&D.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Dl=D&&D.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),pr=D&&D.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.hasOwnProperty.call(t,r)&&Bl(e,t,r);return Dl(e,t),e};Object.defineProperty(ke,"__esModule",{value:!0});var Et=ke.helpers=le=ke.utils=bo=ke.events=Oa=ke.cache=Gt=ke.adapters=fe=ke.constants=void 0,Ll=pr(Yr),fe=ke.constants=Ll,Fl=pr(ga),Gt=ke.adapters=Fl,Ul=pr(Kn),Oa=ke.cache=Ul,kl=pr(De),bo=ke.events=kl,Ml=pr(j),le=ke.utils=Ml,$l=pr(Ia);Et=ke.helpers=$l;var jl=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Nn=function(){return Nn=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Nn.apply(this,arguments)},Wl=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},ql=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};function Hl(){if(typeof wx>"u"||typeof Page>"u"||!wx.getSystemInfoSync||!wx.getStorageSync||!wx.setStorageSync||!wx.connectSocket||!wx.request)return!1;try{if(!wx.getSystemInfoSync()||wx.getSystemInfoSync().AppPlatform==="qq")return!1}catch{return!1}return!0}function Kl(){return typeof App>"u"&&typeof getApp>"u"&&!wx.onAppHide&&!wx.offAppHide&&!wx.onAppShow&&!wx.offAppShow}var Gl=function(t){jl(e,t);function e(r){r===void 0&&(r={});var n=t.call(this)||this,o=r.timeout,i=r.timeoutMsg,a=r.restrictedMethods;return n._timeout=o||0,n._timeoutMsg=i||"请求超时",n._restrictedMethods=a||["get","post","upload","download"],n}return e.prototype.post=function(r){var n=this;return new Promise(function(o,i){var a=r.url,c=r.data,h=r.headers,s=wx.request({url:no("https:",a),data:c,timeout:n._timeout,method:"POST",header:h,success:function(u){o(u)},fail:function(u){i(u)},complete:function(u){if(!(!u||!u.errMsg)&&!(!n._timeout||n._restrictedMethods.indexOf("post")===-1)){var d=u.errMsg;if(d==="request:fail timeout"){console.warn(n._timeoutMsg);try{s.abort()}catch{}}}}})})},e.prototype.upload=function(r){var n=this,o=this;return new Promise(function(i){return Wl(n,void 0,void 0,function(){var a,c,h,s,u,d;return ql(this,function(m){return a=r.url,c=r.file,h=r.data,s=r.headers,u=r.onUploadProgress,d=wx.uploadFile({url:a,filePath:c,name:"file",formData:Nn({},h),header:s,timeout:this._timeout,success:function(v){var b={statusCode:v.statusCode,data:v.data||{}};v.statusCode===200&&h.success_action_status&&(b.statusCode=parseInt(h.success_action_status,10)),i(b)},fail:function(v){i(v)},complete:function(v){if(!(!v||!v.errMsg)&&!(!o._timeout||o._restrictedMethods.indexOf("upload")===-1)){var b=v.errMsg;if(b==="request:fail timeout"){console.warn(o._timeoutMsg);try{d.abort()}catch{}}}}}),u&&d.onProgressUpdate(function(v){u(v)}),[2]})})})},e.prototype.download=function(r){var n=this,o=this;return new Promise(function(i,a){var c=r.url,h=r.headers,s=wx.downloadFile({url:no("https:",c),header:h,timeout:n._timeout,success:function(u){u.statusCode===200&&u.tempFilePath?i({statusCode:200,tempFilePath:u.tempFilePath}):i(u)},fail:function(u){a(u)},complete:function(u){if(!(!u||!u.errMsg)&&!(!o._timeout||o._restrictedMethods.indexOf("download")===-1)){var d=u.errMsg;if(d==="request:fail timeout"){console.warn(o._timeoutMsg);try{s.abort()}catch{}}}}})})},e}(ma),Vl={setItem:function(t,e){wx.setStorageSync(t,e)},getItem:function(t){return wx.getStorageSync(t)},removeItem:function(t){wx.removeStorageSync(t)},clear:function(){wx.clearStorageSync()}},Jl=function(){function t(e,r){r===void 0&&(r={});var n=wx.connectSocket(Nn({url:e},r)),o={set onopen(i){n.onOpen(i)},set onmessage(i){n.onMessage(i)},set onclose(i){n.onClose(i)},set onerror(i){n.onError(i)},send:function(i){return n.send({data:i})},close:function(i,a){return n.close({code:i,reason:a})},get readyState(){return n.readyState},CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3};return o}return t}();function Yl(){var t={root:{},reqClass:Gl,wsClass:Jl,localStorage:Vl,primaryStorage:xn.local,getAppSign:function(){var e=wx.getAccountInfoSync();return Kl()?e&&e.plugin?e.plugin.appId:"":e&&e.miniProgram?e.miniProgram.appId:""}};return t}var Xl={genAdapter:Yl,isMatch:Hl,runtime:"wx_mp"},io=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)n[o]=i[a];return n},Rn=fe.ERRORS,as={};function zl(t,e){var r=e.name,n=e.namespace,o=e.entity,i=e.injectEvents,a=e.IIFE,c=a===void 0?!1:a;if(as[r]||n&&t[n])throw new Error(JSON.stringify({code:Rn.INVALID_OPERATION,msg:"Duplicate component "+r}));if(c){if(!o||typeof o!="function")throw new Error(JSON.stringify({code:Rn.INVALID_PARAMS,msg:"IIFE component's entity must be a function"}));o.call(t)}if(as[r]=e,n?t.prototype[n]=o:xa(t.prototype,o),i){var h=i.bus,s=i.events;if(!h||!s||s.length===0)return;var u=t.prototype.fire||function(){};t.prototype.events||(t.prototype.events={});var d=t.prototype.events||{};d[r]?t.prototype.events[r].events=io(t.prototype.events[r].events,s):t.prototype.events[r]={bus:h,events:s},t.prototype.fire=function(m,v){u(m,v);for(var b in this.events){var I=this.events[b],E=I.bus,A=I.events;if(A.includes(m)){E.fire(m,v);break}}}}}function xa(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:var r=e;return new Date(r.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=xa(t[n],e[n]));return t}function Ql(t,e){var r=e.entity,n=e.target;if(!t.prototype.hasOwnProperty(n))throw new Error(JSON.stringify({code:Rn.INVALID_OPERATION,msg:"target:"+n+" is not exist"}));var o=t.prototype[n];if(typeof o!="function")throw new Error(JSON.stringify({code:Rn.INVALID_OPERATION,msg:"target:"+n+" is not a function which is the only type supports hook"}));t.prototype[n]=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];return r.call.apply(r,io([this],i)),o.call.apply(o,io([this],i))}}var Ke={},or=function(){return or=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},or.apply(this,arguments)},Zl="access_token",eh="access_token_expire",th="refresh_token",rh="anonymous_uuid",nh="login_type",ih="user_info",us=Oa.CloudbaseCache,An={},oo={};function cs(t){var e=t.env,r=t.persistence,n=t.platformInfo,o=Zl+"_"+e,i=eh+"_"+e,a=th+"_"+e,c=rh+"_"+e,h=nh+"_"+e,s=ih+"_"+e,u={accessTokenKey:o,accessTokenExpireKey:i,refreshTokenKey:a,anonymousUuidKey:c,loginTypeKey:h,userInfoKey:s};An[e]?An[e].updatePersistence(r):An[e]=new us(or(or({},t),{keys:u,platformInfo:n,alwaysLocalKeys:["anonymousUuidKey"]})),oo[e]=oo[e]||new us(or(or({},t),{keys:u,platformInfo:n,persistence:"local"}))}function Na(t){return An[t]}function Ra(t){return oo[t]}var oh=fe.setSdkName,sh=fe.setProtocol,Ca="",Pa="@cloudbase/js-sdk";function ah(t){Ca=t}function uh(){return Ca}function ch(t){Pa=t,oh(t)}function fh(){return Pa}var lh="2020-01-10",Ba=typeof location<"u"&&location.protocol==="http:"?"http:":"https:",Da=(typeof process<"u","//tcb-api.tencentcloudapi.com/web");function La(t,e){Da=t,e&&(Ba=e,sh(e))}function hh(t,e,r){var n=e?"//"+t+"."+e+".tcb-api.tencentcloudapi.com/web":"//"+t+".ap-shanghai.tcb-api.tencentcloudapi.com/web";La(n,r)}function dh(){return{BASE_URL:Da,PROTOCOL:Ba}}var so;(function(t){t.ANONYMOUS="ANONYMOUS",t.WECHAT="WECHAT",t.CUSTOM="CUSTOM",t.NULL="NULL"})(so||(so={}));var fs={LOGIN_STATE_CHANGED:"loginStateChanged",LOGIN_STATE_EXPIRED:"loginStateExpire",LOGIN_TYPE_CHANGED:"loginTypeChanged",ANONYMOUS_CONVERTED:"anonymousConverted",ACCESS_TOKEN_REFRESHD:"refreshAccessToken"},Ye=function(){return Ye=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Ye.apply(this,arguments)},dt=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},pt=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Ir=fe.ERRORS,ph=le.genSeqId,yh=le.isFormData,gh=le.formatUrl,mh=le.createSign,vh=Gt.RUNTIME,ls=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"];function Ti(t,e,r){var n=t[e];t[e]=function(o){var i={},a={};r.forEach(function(h){var s=h.call(t,o),u=s.data,d=s.headers;Object.assign(i,u),Object.assign(a,d)});var c=o.data;return c&&function(){if(yh(c)){for(var h in i)c.append(h,i[h]);return}o.data=Ye(Ye({},c),i)}(),o.headers=Ye(Ye({},o.headers||{}),a),n.call(t,o)}}function Oi(){var t=ph();return{data:{seqId:t},headers:{"X-SDK-Version":"@cloudbase/js-sdk/"+uh(),"x-seqid":t}}}var _h=function(){function t(e){this._throwWhenRequestFail=!1,this.config=e,this._reqClass=new Ke.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:"[@cloudbase/js-sdk] 请求在"+this.config.timeout/1e3+"s内未完成，已中断",restrictedMethods:["post"]}),this._throwWhenRequestFail=e.throw||!1,this._cache=Na(this.config.env),this._localCache=Ra(this.config.env),Ti(this._reqClass,"post",[Oi]),Ti(this._reqClass,"upload",[Oi]),Ti(this._reqClass,"download",[Oi])}return t.prototype.post=function(e){return dt(this,void 0,void 0,function(){var r;return pt(this,function(n){switch(n.label){case 0:return[4,this._reqClass.post(e)];case 1:return r=n.sent(),[2,r]}})})},t.prototype.upload=function(e){return dt(this,void 0,void 0,function(){var r;return pt(this,function(n){switch(n.label){case 0:return[4,this._reqClass.upload(e)];case 1:return r=n.sent(),[2,r]}})})},t.prototype.download=function(e){return dt(this,void 0,void 0,function(){var r;return pt(this,function(n){switch(n.label){case 0:return[4,this._reqClass.download(e)];case 1:return r=n.sent(),[2,r]}})})},t.prototype.refreshAccessToken=function(){return dt(this,void 0,void 0,function(){var e,r,n;return pt(this,function(o){switch(o.label){case 0:this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken()),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._refreshAccessTokenPromise];case 2:return e=o.sent(),[3,4];case 3:return n=o.sent(),r=n,[3,4];case 4:if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,r)throw r;return[2,e]}})})},t.prototype.getAccessToken=function(){return dt(this,void 0,void 0,function(){var e,r,n,o,i,a,c,h,s,u;return pt(this,function(d){switch(d.label){case 0:return e=this._cache.keys,r=e.accessTokenKey,n=e.accessTokenExpireKey,o=e.refreshTokenKey,[4,this._cache.getStoreAsync(o)];case 1:if(i=d.sent(),!i)throw new Error(JSON.stringify({code:Ir.OPERATION_FAIL,msg:"refresh token is not exist, your local data might be messed up, please retry after clear localStorage or sessionStorage"}));return[4,this._cache.getStoreAsync(r)];case 2:return a=d.sent(),h=Number,[4,this._cache.getStoreAsync(n)];case 3:return c=h.apply(void 0,[d.sent()]),s=!0,u=this._shouldRefreshAccessTokenHook,u?[4,this._shouldRefreshAccessTokenHook(a,c)]:[3,5];case 4:u=!d.sent(),d.label=5;case 5:return u&&(s=!1),(!a||!c||c<Date.now())&&s?[4,this.refreshAccessToken()]:[3,7];case 6:return[2,d.sent()];case 7:return[2,{accessToken:a,accessTokenExpire:c}]}})})},t.prototype.request=function(e,r,n){return dt(this,void 0,void 0,function(){var o,i,a,c,h,s,u,d,d,m,v,b,I,E,A,_,O,T,B,P,F,q,H,oe,$,te,G,Ee;return pt(this,function(Ae){switch(Ae.label){case 0:return o="x-tcb-trace_"+this.config.env,i="application/x-www-form-urlencoded",a=Ye({action:e,dataVersion:lh,env:this.config.env},r),ls.indexOf(e)!==-1?[3,3]:(c=this._cache.keys.refreshTokenKey,[4,this._cache.getStoreAsync(c)]);case 1:return h=Ae.sent(),h?(s=a,[4,this.getAccessToken()]):[3,3];case 2:s.access_token=Ae.sent().accessToken,Ae.label=3;case 3:if(e==="storage.uploadFile"){u=new FormData;for(d in u)u.hasOwnProperty(d)&&u[d]!==void 0&&u.append(d,a[d]);i="multipart/form-data"}else{i="application/json;charset=UTF-8",u={};for(d in a)a[d]!==void 0&&(u[d]=a[d])}return m={headers:{"content-type":i}},n!=null&&n.onUploadProgress&&(m.onUploadProgress=n.onUploadProgress),this.config.region&&(m.headers["X-TCB-Region"]=this.config.region),v=this._localCache.getStore(o),v&&(m.headers["X-TCB-Trace"]=v),Ke.runtime!==vh.WEB&&(b=this.config,I=b.appSign,E=b.appSecret,A=Date.now(),_=E.appAccessKey,O=E.appAccessKeyId,T=mh({data:{},timestamp:A,appAccessKeyId:O,appSign:I},_),m.headers["X-TCB-App-Source"]="timestamp="+A+";appAccessKeyId="+O+";appSign="+I+";sign="+T),B=r.parse,P=r.inQuery,F=r.search,q={env:this.config.env},B&&(q.parse=!0),P&&(q=Ye(Ye({},P),q)),H=dh(),oe=H.BASE_URL,$=H.PROTOCOL,te=gh($,oe,q),F&&(te+=F),[4,this.post(Ye({url:te,data:u},m))];case 4:if(G=Ae.sent(),Ee=G.header&&G.header["x-tcb-trace"],Ee&&this._localCache.setStore(o,Ee),Number(G.status)!==200&&Number(G.statusCode)!==200||!G.data)throw new Error("network request error");return[2,G]}})})},t.prototype.send=function(e,r){return r===void 0&&(r={}),dt(this,void 0,void 0,function(){var n;return pt(this,function(o){switch(o.label){case 0:return[4,this.request(e,r,{onUploadProgress:r.onUploadProgress})];case 1:return n=o.sent(),n.data.code==="ACCESS_TOKEN_EXPIRED"&&ls.indexOf(e)===-1?[4,this.refreshAccessToken()]:[3,4];case 2:return o.sent(),[4,this.request(e,r,{onUploadProgress:r.onUploadProgress})];case 3:n=o.sent(),o.label=4;case 4:if(n.data.code&&this._throwWhenRequestFail)throw new Error(JSON.stringify({code:Ir.OPERATION_FAIL,msg:"["+n.data.code+"] "+n.data.message}));return[2,n.data]}})})},t.prototype._refreshAccessToken=function(e){return e===void 0&&(e=1),dt(this,void 0,void 0,function(){var r,n,o,i,a,c,h,s,u,d,m,v,b,I;return pt(this,function(E){switch(E.label){case 0:return r=this._cache.keys,n=r.accessTokenKey,o=r.accessTokenExpireKey,i=r.refreshTokenKey,a=r.loginTypeKey,c=r.anonymousUuidKey,[4,this._cache.removeStoreAsync(n)];case 1:return E.sent(),[4,this._cache.removeStoreAsync(o)];case 2:return E.sent(),[4,this._cache.getStoreAsync(i)];case 3:if(h=E.sent(),!h)throw new Error(JSON.stringify({code:Ir.INVALID_OPERATION,msg:"not login"}));return s={refresh_token:h},[4,this.request("auth.fetchAccessTokenWithRefreshToken",s)];case 4:return u=E.sent(),u.data.code?(d=u.data.code,d==="SIGN_PARAM_INVALID"||d==="REFRESH_TOKEN_EXPIRED"||d==="INVALID_REFRESH_TOKEN"?[4,this._cache.getStoreAsync(a)]:[3,11]):[3,12];case 5:return m=E.sent()===so.ANONYMOUS,m&&d==="INVALID_REFRESH_TOKEN"?[4,this._cache.getStoreAsync(c)]:[3,9];case 6:return v=E.sent(),[4,this._cache.getStoreAsync(i)];case 7:return b=E.sent(),[4,this.send("auth.signInAnonymously",{anonymous_uuid:v,refresh_token:b})];case 8:if(I=E.sent(),this._setRefreshToken(I.refresh_token),e>=1)return[2,this._refreshAccessToken(--e)];throw new Error(JSON.stringify({code:Ir.OPERATION_FAIL,message:"重试获取 refresh token 失败"}));case 9:return dr.fire(fs.LOGIN_STATE_EXPIRED),[4,this._cache.removeStoreAsync(i)];case 10:E.sent(),E.label=11;case 11:throw new Error(JSON.stringify({code:Ir.NETWORK_ERROR,msg:"refresh access_token failed："+u.data.code}));case 12:return u.data.access_token?(dr.fire(fs.ACCESS_TOKEN_REFRESHD),[4,this._cache.setStoreAsync(n,u.data.access_token)]):[3,15];case 13:return E.sent(),[4,this._cache.setStoreAsync(o,u.data.access_token_expire+Date.now())];case 14:return E.sent(),[2,{accessToken:u.data.access_token,accessTokenExpire:u.data.access_token_expire}];case 15:return u.data.refresh_token?[4,this._cache.removeStoreAsync(i)]:[3,19];case 16:return E.sent(),[4,this._cache.setStoreAsync(i,u.data.refresh_token)];case 17:return E.sent(),[4,this._refreshAccessToken()];case 18:E.sent(),E.label=19;case 19:return[2]}})})},t.prototype._setRefreshToken=function(e){return dt(this,void 0,void 0,function(){var r,n,o,i;return pt(this,function(a){switch(a.label){case 0:return r=this._cache.keys,n=r.accessTokenKey,o=r.accessTokenExpireKey,i=r.refreshTokenKey,[4,this._cache.removeStoreAsync(n)];case 1:return a.sent(),[4,this._cache.removeStoreAsync(o)];case 2:return a.sent(),[4,this._cache.setStoreAsync(i,e)];case 3:return a.sent(),[2]}})})},t}(),Fa={};function wh(t){Fa[t.env]=new _h(Ye(Ye({},t),{throw:!0}))}function Eh(t){return Fa[t]}var Cn=function(){return Cn=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Cn.apply(this,arguments)},hs=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(i=(o<3?a(i):o>3?a(e,r,i):a(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},Zt=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},bh=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},Sh=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Ah=Gt.useAdapters,Ih=Gt.useDefaultAdapter,Th=Gt.RUNTIME,Dt=fe.ERRORS,ds=fe.COMMUNITY_SITE_URL,ps=le.printWarn,ys=Et.catchErrorsDecorator,Oh={timeout:15e3,persistence:"local"},gs=1e3*60*10,ms=100,vs={},xh=function(){function t(e){this._config=e||this._config,this.authInstance=null}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"platform",{get:function(){return Ke},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cache",{get:function(){return Na(this._config.env)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCache",{get:function(){return Ra(this._config.env)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"request",{get:function(){return Eh(this._config.env)},enumerable:!1,configurable:!0}),t.prototype.init=function(e){if(!e.env)throw new Error(JSON.stringify({code:Dt.INVALID_PARAMS,msg:"env must not be specified"}));if(Ke.adapter||this._useDefaultAdapter(),this.requestClient=new Ke.adapter.reqClass({timeout:e.timeout||5e3,timeoutMsg:"["+fh()+"][REQUEST TIMEOUT] request had been abort since didn't finished within"+e.timeout/1e3+"s"}),Ke.runtime!==Th.WEB){if(!e.appSecret)throw new Error(JSON.stringify({code:Dt.INVALID_PARAMS,msg:"invalid appSecret"}));var r=Ke.adapter.getAppSign?Ke.adapter.getAppSign():"";if(e.appSign&&r&&e.appSign!==r)throw new Error(JSON.stringify({code:Dt.INVALID_PARAMS,msg:"invalid appSign"}));if(r&&(e.appSign=r),!e.appSign)throw new Error(JSON.stringify({code:Dt.INVALID_PARAMS,msg:"invalid appSign"}))}this._config=Cn(Cn({},Oh),e),this._config.timeout=this._formatTimeout(this._config.timeout);var n=this._config,o=n.env,i=n.persistence,a=n.debug,c=n.timeout,h=n.appSecret,s=n.appSign;cs({env:o,persistence:i,debug:a,platformInfo:this.platform}),wh({env:o,region:e.region||"",timeout:c,appSecret:h,appSign:s}),e.region&&hh(o,e.region||"");var u=new t(this._config);return u.requestClient=this.requestClient,u},t.prototype.updateConfig=function(e){var r=e.persistence,n=e.debug;this._config.persistence=r,this._config.debug=n,cs({env:this._config.env,persistence:r,debug:n,platformInfo:this.platform})},t.prototype.registerExtension=function(e){vs[e.name]=e},t.prototype.invokeExtension=function(e,r){return bh(this,void 0,void 0,function(){var n;return Sh(this,function(o){switch(o.label){case 0:if(n=vs[e],!n)throw new Error(JSON.stringify({code:Dt.INVALID_PARAMS,msg:"extension:"+e+" must be registered before invoke"}));return[4,n.invoke(r,this)];case 1:return[2,o.sent()]}})})},t.prototype.useAdapters=function(e){var r=Ah(e)||{},n=r.adapter,o=r.runtime;n&&(Ke.adapter=n),o&&(Ke.runtime=o)},t.prototype.registerHook=function(e){Ql(t,e)},t.prototype.registerComponent=function(e){zl(t,e)},t.prototype.registerVersion=function(e){ah(e)},t.prototype.registerSdkName=function(e){ch(e)},t.prototype.registerEndPoint=function(e,r){La(e,r)},t.prototype._useDefaultAdapter=function(){var e=Ih(),r=e.adapter,n=e.runtime;Ke.adapter=r,Ke.runtime=n},t.prototype._formatTimeout=function(e){switch(!0){case e>gs:return ps(Dt.INVALID_PARAMS,"timeout is greater than maximum value[10min]"),gs;case e<ms:return ps(Dt.INVALID_PARAMS,"timeout is less than maximum value[100ms]"),ms;default:return e}},hs([ys({mode:"sync",title:"Cloudbase 初始化失败",messages:["请确认以下各项：","  1 - 调用 cloudbase.init() 的语法或参数是否正确","  2 - 如果是非浏览器环境，是否配置了安全应用来源（https://docs.cloudbase.net/api-reference/webv2/adapter.html#jie-ru-liu-cheng）","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+ds]}),Zt("design:type",Function),Zt("design:paramtypes",[Object]),Zt("design:returntype",t)],t.prototype,"init",null),hs([ys({title:"调用扩展能力失败",messages:["请确认以下各项：","  1 - 调用 invokeExtension() 的语法或参数是否正确","  2 - 被调用的扩展能力是否已经安装并通过 registerExtension() 注册","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+ds]}),Zt("design:type",Function),Zt("design:paramtypes",[String,Object]),Zt("design:returntype",Promise)],t.prototype,"invokeExtension",null),t}(),dr=new xh;dr.useAdapters(Xl);const Nh="@cloudbase/js-sdk",Rh="1.7.2",Ch="cloudbase javascript sdk",Ph="dist/index.cjs.js",Bh="dist/index.esm.js",Dh="miniprogram_dist",Lh="./index.d.ts",Fh={lint:'eslint --fix "./src/**/*.ts" "./database/**/*.ts"',build:"rm -rf dist/ && gulp build","build:cdn":"gulp cdn","build:miniapp":"gulp miniapp","build:e2e":"rm -rf dist/ && NODE_ENV=e2e gulp e2e"},Uh={access:"public"},kh={type:"git",url:"https://github.com/TencentCloudBase/cloudbase-js-sdk"},Mh=["tcb","cloudbase","Cloudbase","serverless","Serverless","javascript","JavaScript"],$h=["miniprogram_dist","**/dist/","/index.d.ts","**/package.json"],jh=["app","auth","database","functions","storage"],Wh="",qh="ISC",Hh={"@cloudbase/analytics":"^1.1.1-alpha.0","@cloudbase/app":"^1.4.1","@cloudbase/auth":"^1.6.1","@cloudbase/database":"0.9.18-next","@cloudbase/functions":"^1.3.4","@cloudbase/realtime":"^1.1.4-alpha.0","@cloudbase/storage":"^1.3.4","@cloudbase/types":"^1.1.3-alpha.0","@cloudbase/utilities":"^1.3.4"},Kh={"@babel/core":"^7.9.0","@babel/plugin-proposal-class-properties":"^7.8.3","@babel/plugin-transform-runtime":"^7.9.0","@babel/preset-env":"^7.9.5","@babel/preset-typescript":"^7.9.0","@typescript-eslint/eslint-plugin":"^3.8.0","@typescript-eslint/parser":"^3.8.0","awesome-typescript-loader":"^5.2.1","babel-loader":"^8.1.0",eslint:"^7.6.0","eslint-config-alloy":"^3.7.4",gulp:"^4.0.2","gulp-clean":"^0.4.0","gulp-rename":"^2.0.0","gulp-sourcemaps":"^2.6.5","gulp-typescript":"^6.0.0-alpha.1","json-loader":"^0.5.7","merge-stream":"^2.0.0","package-json-cleanup-loader":"^1.0.3",typescript:"^3.8.3",webpack:"4.41.3","webpack-cli":"^3.3.11","webpack-node-externals":"^1.7.2","webpack-stream":"^5.2.1","webpack-visualizer-plugin":"^0.1.11"},Gh=["last 2 version","> 1%","not dead","chrome 53"],Vh="29ca0bf24318daa1fbb230910edf0b1545e17e7f",Jh={name:Nh,version:Rh,description:Ch,main:Ph,module:Bh,miniprogram:Dh,typings:Lh,scripts:Fh,publishConfig:Uh,repository:kh,keywords:Mh,files:$h,components:jh,author:Wh,license:qh,dependencies:Hh,devDependencies:Kh,browserslist:Gh,gitHead:Vh};var Yh=Jh.version;dr.registerVersion(Yh);try{window.cloudbase=dr}catch{}var Tr=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},Or=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},yr=function(){function t(e){this._config=e,this._cache=e.cache,this._request=e.request}return t.prototype.checkLocalLoginState=function(){return Tr(this,void 0,void 0,function(){var e,r,n,o,i,a;return Or(this,function(c){switch(c.label){case 0:return e=this._cache.keys,r=e.accessTokenKey,n=e.accessTokenExpireKey,[4,this._cache.getStoreAsync(r)];case 1:return o=c.sent(),[4,this._cache.getStoreAsync(n)];case 2:return i=c.sent(),o?i&&i>Date.now()?(a=new ct({envId:this._config.env,cache:this._cache,request:this._request}),[4,a.checkLocalStateAsync()]):[3,4]:[3,7];case 3:return c.sent(),[2,a];case 4:return[4,this._cache.removeStoreAsync(r)];case 5:return c.sent(),[4,this._cache.removeStoreAsync(n)];case 6:c.sent(),c.label=7;case 7:return[2]}})})},t.prototype.setRefreshToken=function(e){return Tr(this,void 0,void 0,function(){var r,n,o,i;return Or(this,function(a){switch(a.label){case 0:return r=this._cache.keys,n=r.accessTokenKey,o=r.accessTokenExpireKey,i=r.refreshTokenKey,[4,this._cache.removeStoreAsync(n)];case 1:return a.sent(),[4,this._cache.removeStoreAsync(o)];case 2:return a.sent(),[4,this._cache.setStoreAsync(i,e)];case 3:return a.sent(),[2]}})})},t.prototype.setAccessToken=function(e,r){return Tr(this,void 0,void 0,function(){var n,o,i;return Or(this,function(a){switch(a.label){case 0:return n=this._cache.keys,o=n.accessTokenKey,i=n.accessTokenExpireKey,[4,this._cache.setStoreAsync(o,e)];case 1:return a.sent(),[4,this._cache.setStoreAsync(i,r)];case 2:return a.sent(),[2]}})})},t.prototype.refreshUserInfo=function(){return Tr(this,void 0,void 0,function(){var e,r;return Or(this,function(n){switch(n.label){case 0:return e="auth.getUserInfo",[4,this._request.send(e,{})];case 1:return r=n.sent().data,[4,this.setLocalUserInfo(r)];case 2:return n.sent(),[2,r]}})})},t.prototype.setLocalUserInfo=function(e){return Tr(this,void 0,void 0,function(){var r;return Or(this,function(n){switch(n.label){case 0:return r=this._cache.keys.userInfoKey,[4,this._cache.setStoreAsync(r,e)];case 1:return n.sent(),[2]}})})},t}(),pe;(function(t){t.ANONYMOUS="ANONYMOUS",t.WECHAT="WECHAT",t.WECHAT_PUBLIC="WECHAT-PUBLIC",t.WECHAT_OPEN="WECHAT-OPEN",t.CUSTOM="CUSTOM",t.EMAIL="EMAIL",t.USERNAME="USERNAME",t.NULL="NULL",t.PHONE="PHONE"})(pe||(pe={}));var Xh=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),xi=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(i=(o<3?a(i):o>3?a(e,r,i):a(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},yt=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},er=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},tr=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Ni=fe.getSdkName,dn=fe.ERRORS,Ri=fe.COMMUNITY_SITE_URL,_s=Gt.RUNTIME,zh=le.getQuery,Qh=le.getHash,ws=le.removeParam,Zh=le.printWarn,Ci=Et.catchErrorsDecorator,ed=function(t){Xh(e,t);function e(r,n,o,i){var a=t.call(this,r)||this;return a._runtime=r.runtime,a._appid=n,a._scope=o,a._state=i||"weixin",a}return e.prototype.signIn=function(){return er(this,void 0,void 0,function(){return tr(this,function(r){return[2,Zh(dn.OPERATION_FAIL,"API signIn has been deprecated, please use signInWithRedirect insteed")]})})},e.prototype.signInWithRedirect=function(){return er(this,void 0,void 0,function(){return tr(this,function(r){return[2,this._redirect()]})})},e.prototype.getRedirectResult=function(r){return er(this,void 0,void 0,function(){var n;return tr(this,function(o){return n=Es(),n?[2,this._signInWithCode(n,r)]:[2,null]})})},e.prototype.getLinkRedirectResult=function(r){return r===void 0&&(r={}),er(this,void 0,void 0,function(){var n,o,i,a,c,h;return tr(this,function(s){return n=r.withUnionId,o=n===void 0?!1:n,i=Es(),i?(a=this._appid,c=function(u){switch(u){case"snsapi_login":return"WECHAT-OPEN";default:return"WECHAT-PUBLIC"}}(this._scope),h=this._runtime===_s.WX_MP?"1":"0",[2,this._request.send("auth.linkWithWeixinCode",{payload:{appid:a,loginType:c,code:i,hybridMiniapp:h,withUnionId:o}})]):[2,null]})})},e.prototype._redirect=function(){var r=ws("code",location.href);r=ws("state",r),r=encodeURIComponent(r);var n="//open.weixin.qq.com/connect/oauth2/authorize";this._scope==="snsapi_login"&&(n="//open.weixin.qq.com/connect/qrconnect");try{location.href=n+"?appid="+this._appid+"&redirect_uri="+r+"&response_type=code&scope="+this._scope+"&state="+this._state+"#wechat_redirect"}catch(o){throw new Error("["+Ni()+"]["+dn.UNKOWN_ERROR+"]"+o)}},e.prototype._signInWithCode=function(r,n){return er(this,void 0,void 0,function(){var o,i,a,c,h,s,u,d;return tr(this,function(m){switch(m.label){case 0:return o=this._cache.keys,i=o.accessTokenKey,a=o.accessTokenExpireKey,c=o.refreshTokenKey,h=function(v){switch(v){case"snsapi_login":return"WECHAT-OPEN";default:return"WECHAT-PUBLIC"}}(this._scope),[4,this._getRefreshTokenByWXCode(this._appid,h,r,n)];case 1:return s=m.sent(),u=s.refreshToken,[4,this._cache.setStoreAsync(c,u)];case 2:return m.sent(),s.accessToken?[4,this._cache.setStoreAsync(i,s.accessToken)]:[3,4];case 3:m.sent(),m.label=4;case 4:return s.accessTokenExpire?[4,this._cache.setStoreAsync(a,String(s.accessTokenExpire+Date.now()))]:[3,6];case 5:m.sent(),m.label=6;case 6:return ue.fire(re.LOGIN_STATE_CHANGED),ue.fire(re.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.WECHAT,persistence:this._config.persistence}),[4,this.refreshUserInfo()];case 7:return m.sent(),d=new ct({envId:this._config.env,cache:this._cache,request:this._request}),[4,d.checkLocalStateAsync()];case 8:return m.sent(),[2,d]}})})},e.prototype._getRefreshTokenByWXCode=function(r,n,o,i){return i===void 0&&(i={}),er(this,void 0,void 0,function(){var a,c,h,s,u,d,m;return tr(this,function(v){return a=i.withUnionId,c=a===void 0?!1:a,h=i.createUser,s=h===void 0?!0:h,u=this._scope==="snsapi_base"?!1:i.syncUserInfo||!1,d="auth.signIn",m=this._runtime===_s.WX_MP?"1":"0",[2,this._request.send(d,{appid:r,loginType:n,hybridMiniapp:m,syncUserInfo:u,loginCredential:o,withUnionId:c,createUser:s}).then(function(b){if(b.code)throw new Error("["+Ni()+"]["+dn.OPERATION_FAIL+"] failed login via wechat: "+b.code);if(b.refresh_token)return{refreshToken:b.refresh_token,accessToken:b.access_token,accessTokenExpire:b.access_token_expire};throw new Error("["+Ni()+"]["+dn.OPERATION_FAIL+"] action:getJwt not return refreshToken")})]})})},xi([Ci({title:"跳转微信公众号授权失败",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().signInWithRedirect() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Ri]}),yt("design:type",Function),yt("design:paramtypes",[]),yt("design:returntype",Promise)],e.prototype,"signInWithRedirect",null),xi([Ci({title:"微信公众号登录失败",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().getRedirectResult() 的语法或参数是否正确","  2 - 当前环境是否开通了微信公众号登录授权","  3 - 微信公众号的 AppId 与 AppSecret 配置是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Ri]}),yt("design:type",Function),yt("design:paramtypes",[Object]),yt("design:returntype",Promise)],e.prototype,"getRedirectResult",null),xi([Ci({title:"获取微信重定向绑定结果",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().getLinkRedirectResult() 的语法或参数是否正确","  2 - 当前环境是否开通了微信公众号登录授权","  3 - 微信公众号的 AppId 与 AppSecret 配置是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Ri]}),yt("design:type",Function),yt("design:paramtypes",[Object]),yt("design:returntype",Promise)],e.prototype,"getLinkRedirectResult",null),e}(yr);function Es(){return zh("code")||Qh("code")}var td=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),rd=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(i=(o<3?a(i):o>3?a(e,r,i):a(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},Pi=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},xr=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},Nr=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Bi=fe.ERRORS,nd=fe.COMMUNITY_SITE_URL,bs=le.throwError,id=le.isString,od=bo.addEventListener,sd=Et.catchErrorsDecorator,ad=function(t){td(e,t);function e(r){var n=t.call(this,r)||this;return n._onConverted=n._onConverted.bind(n),od(re.ANONYMOUS_CONVERTED,n._onConverted),n}return e.prototype.signIn=function(){return xr(this,void 0,void 0,function(){var r,n,o,i,a,c,h;return Nr(this,function(s){switch(s.label){case 0:return[4,this._cache.updatePersistenceAsync("local")];case 1:return s.sent(),r=this._cache.keys,n=r.anonymousUuidKey,o=r.refreshTokenKey,[4,this._cache.getStoreAsync(n)];case 2:return i=s.sent(),[4,this._cache.getStoreAsync(o)];case 3:return a=s.sent(),[4,this._request.send("auth.signInAnonymously",{anonymous_uuid:i,refresh_token:a})];case 4:return c=s.sent(),c.uuid&&c.refresh_token?[4,this._setAnonymousUUID(c.uuid)]:[3,10];case 5:return s.sent(),[4,this.setRefreshToken(c.refresh_token)];case 6:return s.sent(),[4,this._request.refreshAccessToken()];case 7:return s.sent(),ue.fire(re.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.ANONYMOUS,persistence:"local"}),ue.fire(re.LOGIN_STATE_CHANGED),h=new ct({envId:this._config.env,cache:this._cache,request:this._request}),[4,h.checkLocalStateAsync()];case 8:return s.sent(),[4,h.user.refresh()];case 9:return s.sent(),[2,h];case 10:throw new Error(JSON.stringify({code:Bi.OPERATION_FAIL,msg:JSON.stringify(c)||"anonymous signIn failed"}))}})})},e.prototype.linkAndRetrieveDataWithTicket=function(r){return xr(this,void 0,void 0,function(){var n,o,i,a,c,h,s;return Nr(this,function(u){switch(u.label){case 0:return id(r)||bs(Bi.INVALID_PARAMS,"ticket must be a string"),n=this._cache.keys,o=n.anonymousUuidKey,i=n.refreshTokenKey,[4,this._cache.getStoreAsync(o)];case 1:return a=u.sent(),[4,this._cache.getStoreAsync(i)];case 2:return c=u.sent(),[4,this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:a,refresh_token:c,ticket:r})];case 3:return h=u.sent(),h.refresh_token?[4,this._clearAnonymousUUID()]:[3,8];case 4:return u.sent(),[4,this.setRefreshToken(h.refresh_token)];case 5:return u.sent(),[4,this._request.refreshAccessToken()];case 6:return u.sent(),ue.fire(re.ANONYMOUS_CONVERTED,{env:this._config.env}),ue.fire(re.LOGIN_TYPE_CHANGED,{loginType:pe.CUSTOM,persistence:"local"}),s=new ct({envId:this._config.env,cache:this._cache,request:this._request}),[4,s.checkLocalStateAsync()];case 7:return u.sent(),[2,s];case 8:bs(Bi.OPERATION_FAIL,JSON.stringify(h)||"linkAndRetrieveDataWithTicket failed"),u.label=9;case 9:return[2]}})})},e.prototype._setAnonymousUUID=function(r){return xr(this,void 0,void 0,function(){var n,o,i;return Nr(this,function(a){switch(a.label){case 0:return n=this._cache.keys,o=n.anonymousUuidKey,i=n.loginTypeKey,[4,this._cache.removeStoreAsync(o)];case 1:return a.sent(),[4,this._cache.setStoreAsync(o,r)];case 2:return a.sent(),[4,this._cache.setStoreAsync(i,pe.ANONYMOUS)];case 3:return a.sent(),[2]}})})},e.prototype._clearAnonymousUUID=function(){return xr(this,void 0,void 0,function(){return Nr(this,function(r){switch(r.label){case 0:return[4,this._cache.removeStoreAsync(this._cache.keys.anonymousUuidKey)];case 1:return r.sent(),[2]}})})},e.prototype._onConverted=function(r){return xr(this,void 0,void 0,function(){var n;return Nr(this,function(o){switch(o.label){case 0:return n=r.data.env,n!==this._config.env?[2]:[4,this._cache.updatePersistenceAsync(this._config.persistence)];case 1:return o.sent(),[2]}})})},rd([sd({title:"匿名登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了匿名登录","  2 - 调用 auth().anonymouseProvider().signIn() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+nd]}),Pi("design:type",Function),Pi("design:paramtypes",[]),Pi("design:returntype",Promise)],e.prototype,"signIn",null),e}(yr),ud=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),cd=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(i=(o<3?a(i):o>3?a(e,r,i):a(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},Di=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},fd=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},ld=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Ss=fe.ERRORS,hd=fe.COMMUNITY_SITE_URL,dd=le.isString,pd=Et.catchErrorsDecorator,yd=function(t){ud(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.signIn=function(r){return fd(this,void 0,void 0,function(){var n,o,i,a,c,h,s;return ld(this,function(u){switch(u.label){case 0:if(!dd(r))throw new Error(JSON.stringify({code:Ss.INVALID_PARAMS,msg:"ticket must be a string"}));return n=this._cache.keys.refreshTokenKey,a=(i=this._request).send,c=["auth.signInWithTicket"],h={ticket:r},[4,this._cache.getStoreAsync(n)];case 1:return[4,a.apply(i,c.concat([(h.refresh_token=u.sent()||"",h)]))];case 2:return o=u.sent(),o.refresh_token?[4,this.setRefreshToken(o.refresh_token)]:[3,7];case 3:return u.sent(),[4,this._request.refreshAccessToken()];case 4:return u.sent(),ue.fire(re.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.CUSTOM,persistence:this._config.persistence}),ue.fire(re.LOGIN_STATE_CHANGED),[4,this.refreshUserInfo()];case 5:return u.sent(),s=new ct({envId:this._config.env,cache:this._cache,request:this._request}),[4,s.checkLocalStateAsync()];case 6:return u.sent(),[2,s];case 7:throw new Error(JSON.stringify({code:Ss.OPERATION_FAIL,msg:"custom signIn failed"}))}})})},cd([pd({title:"自定义登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了自定义登录","  2 - 调用 auth().customAuthProvider().signIn() 的语法或参数是否正确","  3 - ticket 是否归属于当前环境","  4 - 创建 ticket 的自定义登录私钥是否过期","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+hd]}),Di("design:type",Function),Di("design:paramtypes",[String]),Di("design:returntype",Promise)],e.prototype,"signIn",null),e}(yr),gd=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rr=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(i=(o<3?a(i):o>3?a(e,r,i):a(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},Te=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Cr=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},Pr=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Li=le.throwError,md=le.isString,Fi=fe.ERRORS,Br=fe.COMMUNITY_SITE_URL,Dr=Et.catchErrorsDecorator,vd=function(t){gd(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.signIn=function(r,n){return Cr(this,void 0,void 0,function(){var o,i,a,c,h;return Pr(this,function(s){switch(s.label){case 0:return md(r)||Li(Fi.INVALID_PARAMS,"email must be a string"),o=this._cache.keys.refreshTokenKey,[4,this._request.send("auth.signIn",{loginType:"EMAIL",email:r,password:n,refresh_token:this._cache.getStore(o)||""})];case 1:return i=s.sent(),a=i.refresh_token,c=i.access_token,h=i.access_token_expire,a?[4,this.setRefreshToken(a)]:[3,8];case 2:return s.sent(),c&&h?[4,this.setAccessToken(c,h)]:[3,4];case 3:return s.sent(),[3,6];case 4:return[4,this._request.refreshAccessToken()];case 5:s.sent(),s.label=6;case 6:return[4,this.refreshUserInfo()];case 7:return s.sent(),ue.fire(re.LOGIN_STATE_CHANGED),ue.fire(re.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.EMAIL,persistence:this._config.persistence}),[2,new ct({envId:this._config.env,cache:this._cache,request:this._request})];case 8:i.code?Li(Fi.OPERATION_FAIL,"Email login fail["+i.code+"] "+i.message):Li(Fi.OPERATION_FAIL,"Email login fail"),s.label=9;case 9:return[2]}})})},e.prototype.signUp=function(r,n){return Cr(this,void 0,void 0,function(){return Pr(this,function(o){return[2,this._request.send("auth.signUpWithEmailAndPassword",{email:r,password:n})]})})},e.prototype.resetPassword=function(r){return Cr(this,void 0,void 0,function(){return Pr(this,function(n){return[2,this._request.send("auth.sendPasswordResetEmail",{email:r})]})})},e.prototype.resetPasswordWithToken=function(r,n){return Cr(this,void 0,void 0,function(){return Pr(this,function(o){return[2,this._request.send("auth.resetPasswordWithToken",{token:r,newPassword:n})]})})},e.prototype.activate=function(r){return Cr(this,void 0,void 0,function(){return Pr(this,function(n){return[2,this._request.send("auth.activateEndUserMail",{token:r})]})})},Rr([Dr({title:"邮箱密码登录失败",messages:["请确认以下各项：","  1 - 调用 auth().emailAuthProvider() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 邮箱地址与密码是否匹配","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Br]}),Te("design:type",Function),Te("design:paramtypes",[String,String]),Te("design:returntype",Promise)],e.prototype,"signIn",null),Rr([Dr({title:"邮箱注册失败",messages:["请确认以下各项：","  1 - 调用 auth().signUpWithEmailAndPassword() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 此邮箱地址是否已经被其他用户占用","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Br]}),Te("design:type",Function),Te("design:paramtypes",[String,String]),Te("design:returntype",Promise)],e.prototype,"signUp",null),Rr([Dr({title:"重置密码失败",messages:["请确认以下各项：","  1 - 调用 auth().sendPasswordResetEmail() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 此邮箱地址是否已经与当前用户绑定","  4 - 此邮箱地址是否已经被其他用户占用","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Br]}),Te("design:type",Function),Te("design:paramtypes",[String]),Te("design:returntype",Promise)],e.prototype,"resetPassword",null),Rr([Dr({title:"重置密码失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Br]}),Te("design:type",Function),Te("design:paramtypes",[String,String]),Te("design:returntype",Promise)],e.prototype,"resetPasswordWithToken",null),Rr([Dr({title:"邮箱激活失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Br]}),Te("design:type",Function),Te("design:paramtypes",[String]),Te("design:returntype",Promise)],e.prototype,"activate",null),e}(yr),_d=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),wd=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(i=(o<3?a(i):o>3?a(e,r,i):a(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},Ui=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Ed=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},bd=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Sd=le.printWarn,pn=fe.ERRORS,Ad=fe.COMMUNITY_SITE_URL,Id=Et.catchErrorsDecorator,Td=function(t){_d(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.signIn=function(r,n){return Ed(this,void 0,void 0,function(){var o,i,a,c,h,s,u,d,m;return bd(this,function(v){switch(v.label){case 0:if(typeof r!="string")throw new Error(JSON.stringify({code:pn.INVALID_PARAMS,msg:"username must be a string"}));return typeof n!="string"&&(n="",Sd(pn.INVALID_PARAMS,"password is empty")),o=this._cache.keys.refreshTokenKey,c=(a=this._request).send,h=["auth.signIn"],s={loginType:pe.USERNAME,username:r,password:n},[4,this._cache.getStoreAsync(o)];case 1:return[4,c.apply(a,h.concat([(s.refresh_token=v.sent()||"",s)]))];case 2:return i=v.sent(),u=i.refresh_token,d=i.access_token_expire,m=i.access_token,u?[4,this.setRefreshToken(u)]:[3,9];case 3:return v.sent(),m&&d?[4,this.setAccessToken(m,d)]:[3,5];case 4:return v.sent(),[3,7];case 5:return[4,this._request.refreshAccessToken()];case 6:v.sent(),v.label=7;case 7:return[4,this.refreshUserInfo()];case 8:return v.sent(),ue.fire(re.LOGIN_STATE_CHANGED),ue.fire(re.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.USERNAME,persistence:this._config.persistence}),[2,new ct({envId:this._config.env,cache:this._cache,request:this._request})];case 9:throw i.code?new Error(JSON.stringify({code:pn.OPERATION_FAIL,msg:"login by username failed:["+i.code+"] "+i.message})):new Error(JSON.stringify({code:pn.OPERATION_FAIL,msg:"login by username failed"}));case 10:return[2]}})})},wd([Id({title:"用户名密码登录失败",messages:["请确认以下各项：","  1 - 调用 auth().signInWithUsernameAndPassword() 的语法或参数是否正确","  2 - 当前环境是否开通了用户名密码登录","  3 - 用户名密码是否匹配","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Ad]}),Ui("design:type",Function),Ui("design:paramtypes",[String,String]),Ui("design:returntype",Promise)],e.prototype,"signIn",null),e}(yr),Od=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),ki=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(i=(o<3?a(i):o>3?a(e,r,i):a(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},gt=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Mi=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},$i=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},yn=le.throwError,ji=le.isString,xd=le.transformPhone,gn=fe.ERRORS,Wi=fe.COMMUNITY_SITE_URL,qi=Et.catchErrorsDecorator,In={SIGNIN:"SIGNIN",SIGNUP:"SIGNUP",FORCERESETPWD:"FORCERESETPWD"},Nd=function(t){Od(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.signIn=function(r){return Mi(this,void 0,void 0,function(){var n,o,i,a,c,h,s,u,d;return $i(this,function(m){switch(m.label){case 0:return n=r.phoneNumber,o=r.phoneCode,i=r.password,a=r.signMethod,ji(n)||yn(gn.INVALID_PARAMS,"phoneNumber must be a string"),!ji(o)&&!ji(i)&&yn(gn.INVALID_PARAMS,"phoneCode or password must be a string"),a||(a=In.SIGNIN),c=this._cache.keys.refreshTokenKey,[4,this._request.send("auth.signIn",{loginType:pe.PHONE,phoneNumber:xd(n),phoneCode:o,password:i,refresh_token:this._cache.getStore(c)||"",signMethod:a})];case 1:return h=m.sent(),s=h.refresh_token,u=h.access_token,d=h.access_token_expire,s?[4,this.setRefreshToken(s)]:[3,8];case 2:return m.sent(),u&&d?[4,this.setAccessToken(u,d)]:[3,4];case 3:return m.sent(),[3,6];case 4:return[4,this._request.refreshAccessToken()];case 5:m.sent(),m.label=6;case 6:return[4,this.refreshUserInfo()];case 7:return m.sent(),ue.fire(re.LOGIN_STATE_CHANGED),ue.fire(re.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.PHONE,persistence:this._config.persistence}),[2,new ct({envId:this._config.env,cache:this._cache,request:this._request})];case 8:h.code?yn(gn.OPERATION_FAIL,"Phone login fail["+h.code+"] "+h.message):yn(gn.OPERATION_FAIL,"Phone login fail"),m.label=9;case 9:return[2]}})})},e.prototype.signUp=function(r,n,o){return Mi(this,void 0,void 0,function(){return $i(this,function(i){return[2,this.signIn({phoneNumber:r,phoneCode:n,password:o,signMethod:In.SIGNUP})]})})},e.prototype.forceResetPwd=function(r,n,o){return Mi(this,void 0,void 0,function(){return $i(this,function(i){return[2,this.signIn({phoneNumber:r,phoneCode:n,password:o,signMethod:In.FORCERESETPWD})]})})},ki([qi({title:"手机号登录失败",messages:["请确认以下各项：","  1 - 调用 auth().SmsAuthProvider() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","  3 - 短信验证码/密码是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Wi]}),gt("design:type",Function),gt("design:paramtypes",[Object]),gt("design:returntype",Promise)],e.prototype,"signIn",null),ki([qi({title:"手机短信注册失败",messages:["请确认以下各项：","  1 - 调用 auth().signUpWithPhoneCode() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Wi]}),gt("design:type",Function),gt("design:paramtypes",[String,String,String]),gt("design:returntype",Promise)],e.prototype,"signUp",null),ki([qi({title:"手机密码重置失败",messages:["请确认以下各项：","  1 - 调用 auth().forceResetPwd() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Wi]}),gt("design:type",Function),gt("design:paramtypes",[String,String,String]),gt("design:returntype",Promise)],e.prototype,"forceResetPwd",null),e}(yr),ge=function(){return ge=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},ge.apply(this,arguments)},ve=function(t,e,r,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,r,n);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(i=(o<3?a(i):o>3?a(e,r,i):a(e,r))||i);return o>3&&i&&Object.defineProperty(e,r,i),i},M=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Z=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},ee=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Rd=bo.CloudbaseEventEmitter,Cd=Gt.RUNTIME,ao=le.printWarn,So=le.throwError,uo=le.transformPhone,cr=fe.ERRORS,_e=fe.COMMUNITY_SITE_URL,we=Et.catchErrorsDecorator,Pd="auth",ue=new Rd,Bd=function(){function t(e){var r=e.cache,n=e.request;this._cache=r,this._request=n,this._setUserInfo()}return t.prototype.checkLocalInfo=function(){return Z(this,void 0,void 0,function(){return ee(this,function(e){return this.uid=this._getLocalUserInfo("uid"),this.loginType=this._getLocalUserInfo("loginType"),this.openid=this._getLocalUserInfo("wxOpenId"),this.wxOpenId=this._getLocalUserInfo("wxOpenId"),this.wxPublicId=this._getLocalUserInfo("wxPublicId"),this.unionId=this._getLocalUserInfo("wxUnionId"),this.qqMiniOpenId=this._getLocalUserInfo("qqMiniOpenId"),this.customUserId=this._getLocalUserInfo("customUserId"),this.nickName=this._getLocalUserInfo("nickName"),this.gender=this._getLocalUserInfo("gender"),this.avatarUrl=this._getLocalUserInfo("avatarUrl"),this.email=this._getLocalUserInfo("email"),this.hasPassword=!!this._getLocalUserInfo("hasPassword"),this.phone=this._getLocalUserInfo("phone"),this.username=this._getLocalUserInfo("username"),this.location={country:this._getLocalUserInfo("country"),province:this._getLocalUserInfo("province"),city:this._getLocalUserInfo("city")},[2]})})},t.prototype.checkLocalInfoAsync=function(){return Z(this,void 0,void 0,function(){var e,r,n,o,i,a,c,h,s,u,d,m,v,b,I,E,A,_;return ee(this,function(O){switch(O.label){case 0:return e=this,[4,this._getLocalUserInfoAsync("uid")];case 1:return e.uid=O.sent(),r=this,[4,this._getLocalUserInfoAsync("loginType")];case 2:return r.loginType=O.sent(),n=this,[4,this._getLocalUserInfoAsync("wxOpenId")];case 3:return n.openid=O.sent(),o=this,[4,this._getLocalUserInfoAsync("wxOpenId")];case 4:return o.wxOpenId=O.sent(),i=this,[4,this._getLocalUserInfoAsync("wxPublicId")];case 5:return i.wxPublicId=O.sent(),a=this,[4,this._getLocalUserInfoAsync("wxUnionId")];case 6:return a.unionId=O.sent(),c=this,[4,this._getLocalUserInfoAsync("qqMiniOpenId")];case 7:return c.qqMiniOpenId=O.sent(),h=this,[4,this._getLocalUserInfoAsync("customUserId")];case 8:return h.customUserId=O.sent(),s=this,[4,this._getLocalUserInfoAsync("nickName")];case 9:return s.nickName=O.sent(),u=this,[4,this._getLocalUserInfoAsync("gender")];case 10:return u.gender=O.sent(),d=this,[4,this._getLocalUserInfoAsync("avatarUrl")];case 11:return d.avatarUrl=O.sent(),m=this,[4,this._getLocalUserInfoAsync("email")];case 12:return m.email=O.sent(),v=this,b=Boolean,[4,this._getLocalUserInfoAsync("hasPassword")];case 13:return v.hasPassword=b.apply(void 0,[O.sent()]),I=this,[4,this._getLocalUserInfoAsync("phone")];case 14:return I.phone=O.sent(),E=this,[4,this._getLocalUserInfoAsync("username")];case 15:return E.username=O.sent(),A=this,_={},[4,this._getLocalUserInfoAsync("country")];case 16:return _.country=O.sent(),[4,this._getLocalUserInfoAsync("province")];case 17:return _.province=O.sent(),[4,this._getLocalUserInfoAsync("city")];case 18:return A.location=(_.city=O.sent(),_),[2]}})})},t.prototype.linkWithTicket=function(e){if(typeof e!="string")throw new Error("ticket must be string");return this._request.send("auth.linkWithTicket",{ticket:e})},t.prototype.linkWithRedirect=function(e){e.signInWithRedirect()},t.prototype.getLinkedUidList=function(){return Z(this,void 0,void 0,function(){var e,r,n,o,i,a;return ee(this,function(c){switch(c.label){case 0:return[4,this._request.send("auth.getLinkedUidList",{})];case 1:for(e=c.sent().data,r=!1,n=e.users,o=0,i=n;o<i.length;o++)if(a=i[o],a.wxOpenId&&a.wxPublicId){r=!0;break}return[2,{users:n,hasPrimaryUid:r}]}})})},t.prototype.setPrimaryUid=function(e){return this._request.send("auth.setPrimaryUid",{uid:e})},t.prototype.unlink=function(e){return this._request.send("auth.unlink",{platform:e})},t.prototype.update=function(e){return Z(this,void 0,void 0,function(){var r,n,o,i,a,c,h;return ee(this,function(s){switch(s.label){case 0:return r=e.nickName,n=e.gender,o=e.avatarUrl,i=e.province,a=e.country,c=e.city,[4,this._request.send("auth.updateUserInfo",{nickName:r,gender:n,avatarUrl:o,province:i,country:a,city:c})];case 1:return h=s.sent().data,this._setLocalUserInfo(h),[2]}})})},t.prototype.updatePassword=function(e,r){return this._request.send("auth.updatePassword",{oldPassword:r,newPassword:e})},t.prototype.updateEmail=function(e,r){return this._request.send("auth.updateEmail",{newEmail:e,password:r})},t.prototype.updateUsername=function(e){return typeof e!="string"&&So(cr.INVALID_PARAMS,"username must be a string"),this._request.send("auth.updateUsername",{username:e})},t.prototype.refresh=function(){return Z(this,void 0,void 0,function(){var e,r;return ee(this,function(n){switch(n.label){case 0:return e="auth.getUserInfo",[4,this._request.send(e,{})];case 1:return r=n.sent().data,this._setLocalUserInfo(r),[2,r]}})})},t.prototype.linkWithPhoneNumber=function(e,r){return Z(this,void 0,void 0,function(){return ee(this,function(n){return[2,this._request.send("auth.linkOrUpdatePhoneNumber",{phoneNumber:uo(e),phoneCode:r})]})})},t.prototype.updatePhoneNumber=function(e,r){return Z(this,void 0,void 0,function(){return ee(this,function(n){return[2,this._request.send("auth.linkOrUpdatePhoneNumber",{phoneNumber:uo(e),phoneCode:r})]})})},t.prototype._getLocalUserInfo=function(e){var r=this._cache.keys.userInfoKey,n=this._cache.getStore(r);return n[e]},t.prototype._getLocalUserInfoAsync=function(e){return Z(this,void 0,void 0,function(){var r,n;return ee(this,function(o){switch(o.label){case 0:return r=this._cache.keys.userInfoKey,[4,this._cache.getStoreAsync(r)];case 1:return n=o.sent(),[2,n[e]]}})})},t.prototype._setUserInfo=function(){var e=this,r=this._cache.keys.userInfoKey,n=this._cache.getStore(r);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl","phone","username"].forEach(function(o){e[o]=n[o]}),this.location={country:n.country,province:n.province,city:n.city}},t.prototype._setLocalUserInfo=function(e){var r=this._cache.keys.userInfoKey;this._cache.setStore(r,e),this._setUserInfo()},ve([we({title:"绑定自定义登录失败",messages:["请确认以下各项：","  1 - 调用 User.linkWithTicket() 的语法或参数是否正确","  2 - 此账户是否已经绑定自定义登录","  3 - ticket 参数是否归属当前环境","  4 - 创建 ticket 的自定义登录私钥是否过期","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[String]),M("design:returntype",Promise)],t.prototype,"linkWithTicket",null),ve([we({title:"绑定第三方登录方式失败",messages:["请确认以下各项：","  1 - 调用 User.linkWithRedirect() 的语法或参数是否正确","  2 - 此账户是否已经绑定此第三方","  3 - 此第三方是否已经授权","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",void 0)],t.prototype,"linkWithRedirect",null),ve([we({title:"获取账户列表失败",messages:["请确认以下各项：","  1 - 调用 User.getLinkedUidList() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Promise)],t.prototype,"getLinkedUidList",null),ve([we({title:"设置微信主账号失败",messages:["请确认以下各项：","  1 - 调用 User.setPrimaryUid() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[String]),M("design:returntype",void 0)],t.prototype,"setPrimaryUid",null),ve([we({title:"接触绑定失败",messages:["请确认以下各项：","  1 - 调用 User.unlink() 的语法或参数是否正确","  2 - 当前账户是否已经与此登录方式解绑","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[String]),M("design:returntype",void 0)],t.prototype,"unlink",null),ve([we({title:"更新用户信息失败",messages:["请确认以下各项：","  1 - 调用 User.update() 的语法或参数是否正确","  2 - 用户信息中是否包含非法值","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[Object]),M("design:returntype",Promise)],t.prototype,"update",null),ve([we({title:"更新密码失败",messages:["请确认以下各项：","  1 - 调用 User.updatePassword() 的语法或参数是否正确","  3 - 新密码中是否包含非法字符","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[String,String]),M("design:returntype",void 0)],t.prototype,"updatePassword",null),ve([we({title:"更新邮箱地址失败",messages:["请确认以下各项：","  1 - 调用 User.updateEmail() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱密码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[String,String]),M("design:returntype",void 0)],t.prototype,"updateEmail",null),ve([we({title:"更新用户名失败",messages:["请确认以下各项：","  1 - 调用 User.updateUsername() 的语法或参数是否正确","  2 - 当前环境是否开通了用户名密码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[String]),M("design:returntype",void 0)],t.prototype,"updateUsername",null),ve([we({title:"刷新本地用户信息失败",messages:["请确认以下各项：","  1 - 调用 User.refresh() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Promise)],t.prototype,"refresh",null),ve([we({title:"绑定手机号失败",messages:["请确认以下各项：","  1 - 调用 auth().linkWithPhoneNumber() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[String,String]),M("design:returntype",Promise)],t.prototype,"linkWithPhoneNumber",null),ve([we({title:"更新手机号失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[String,String]),M("design:returntype",Promise)],t.prototype,"updatePhoneNumber",null),t}(),ct=function(){function t(e){var r=e.envId,n=e.cache,o=e.request;r||So(cr.INVALID_PARAMS,"envId is not defined"),this._cache=n,this.user=new Bd({cache:n,request:o})}return t.prototype.checkLocalState=function(){return Z(this,void 0,void 0,function(){var e,r,n,o,i,a,c;return ee(this,function(h){return e=this._cache.keys,r=e.refreshTokenKey,n=e.accessTokenKey,o=e.accessTokenExpireKey,i=this._cache.getStore(r),a=this._cache.getStore(n),c=this._cache.getStore(o),this.credential={refreshToken:i,accessToken:a,accessTokenExpire:c},this._loginType=this._cache.getStore(this._cache.keys.loginTypeKey),this.user.checkLocalInfo(),[2]})})},t.prototype.checkLocalStateAsync=function(){return Z(this,void 0,void 0,function(){var e,r,n,o,i,a,c,h;return ee(this,function(s){switch(s.label){case 0:return e=this._cache.keys,r=e.refreshTokenKey,n=e.accessTokenKey,o=e.accessTokenExpireKey,[4,this._cache.getStoreAsync(r)];case 1:return i=s.sent(),[4,this._cache.getStoreAsync(n)];case 2:return a=s.sent(),[4,this._cache.getStoreAsync(o)];case 3:return c=s.sent(),this.credential={refreshToken:i,accessToken:a,accessTokenExpire:c},h=this,[4,this._cache.getStoreAsync(this._cache.keys.loginTypeKey)];case 4:return h._loginType=s.sent(),[4,this.user.checkLocalInfoAsync()];case 5:return s.sent(),[2]}})})},Object.defineProperty(t.prototype,"isAnonymousAuth",{get:function(){return this.loginType===pe.ANONYMOUS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCustomAuth",{get:function(){return this.loginType===pe.CUSTOM},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isWeixinAuth",{get:function(){return this.loginType===pe.WECHAT||this.loginType===pe.WECHAT_OPEN||this.loginType===pe.WECHAT_PUBLIC},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUsernameAuth",{get:function(){return this.loginType===pe.USERNAME},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loginType",{get:function(){return this._loginType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPhoneAuth",{get:function(){return this.loginType===pe.PHONE},enumerable:!1,configurable:!0}),t}(),Dd=function(){function t(e){this._config=e,this._cache=e.cache,this._request=e.request,this._runtime=e.runtime||Cd.WEB,ue.on(re.LOGIN_TYPE_CHANGED,this._onLoginTypeChanged.bind(this))}return Object.defineProperty(t.prototype,"currentUser",{get:function(){if(this._cache.mode==="async"){ao(cr.INVALID_OPERATION,"current platform's storage is asynchronous, please use getCurrenUser insteed");return}var e=this.hasLoginState();return e&&e.user||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loginType",{get:function(){return this._cache.getStore(this._cache.keys.loginTypeKey)},enumerable:!1,configurable:!0}),t.prototype.getCurrenUser=function(){return Z(this,void 0,void 0,function(){var e;return ee(this,function(r){switch(r.label){case 0:return[4,this.getLoginState()];case 1:return e=r.sent(),e?[4,e.user.checkLocalInfoAsync()]:[3,3];case 2:return r.sent(),[2,e.user||null];case 3:return[2,null]}})})},t.prototype.getLoginType=function(){return Z(this,void 0,void 0,function(){return ee(this,function(e){switch(e.label){case 0:return[4,this._cache.getStoreAsync(this._cache.keys.loginTypeKey)];case 1:return[2,e.sent()]}})})},t.prototype.getAccessToken=function(){return Z(this,void 0,void 0,function(){var e;return ee(this,function(r){switch(r.label){case 0:return e={},[4,this._request.getAccessToken()];case 1:return[2,(e.accessToken=r.sent().accessToken,e.env=this._config.env,e)]}})})},t.prototype.weixinAuthProvider=function(e){var r=e.appid,n=e.scope,o=e.state;return this._weixinAuthProvider||(this._weixinAuthProvider=new ed(ge(ge({},this._config),{cache:this._cache,request:this._request,runtime:this._runtime}),r,n,o)),this._weixinAuthProvider},t.prototype.anonymousAuthProvider=function(){return this._anonymousAuthProvider||(this._anonymousAuthProvider=new ad(ge(ge({},this._config),{cache:this._cache,request:this._request}))),this._anonymousAuthProvider},t.prototype.customAuthProvider=function(){return this._customAuthProvider||(this._customAuthProvider=new yd(ge(ge({},this._config),{cache:this._cache,request:this._request}))),this._customAuthProvider},t.prototype.emailAuthProvider=function(){return this._emailAuthProvider||(this._emailAuthProvider=new vd(ge(ge({},this._config),{cache:this._cache,request:this._request}))),this._emailAuthProvider},t.prototype.usernameAuthProvider=function(){return this._usernameAuthProvider||(this._usernameAuthProvider=new Td(ge(ge({},this._config),{cache:this._cache,request:this._request}))),this._usernameAuthProvider},t.prototype.phoneAuthProvider=function(){return this._phoneAuthProvider||(this._phoneAuthProvider=new Nd(ge(ge({},this._config),{cache:this._cache,request:this._request}))),this._phoneAuthProvider},t.prototype.signInWithUsernameAndPassword=function(e,r){return Z(this,void 0,void 0,function(){return ee(this,function(n){return[2,this.usernameAuthProvider().signIn(e,r)]})})},t.prototype.isUsernameRegistered=function(e){return Z(this,void 0,void 0,function(){var r;return ee(this,function(n){switch(n.label){case 0:return typeof e!="string"&&So(cr.INVALID_PARAMS,"username must be a string"),[4,this._request.send("auth.isUsernameRegistered",{username:e})];case 1:return r=n.sent().data,[2,r==null?void 0:r.isRegistered]}})})},t.prototype.signInWithEmailAndPassword=function(e,r){return Z(this,void 0,void 0,function(){return ee(this,function(n){return[2,this.emailAuthProvider().signIn(e,r)]})})},t.prototype.signUpWithEmailAndPassword=function(e,r){return Z(this,void 0,void 0,function(){return ee(this,function(n){return[2,this.emailAuthProvider().signUp(e,r)]})})},t.prototype.sendPasswordResetEmail=function(e){return Z(this,void 0,void 0,function(){return ee(this,function(r){return[2,this.emailAuthProvider().resetPassword(e)]})})},t.prototype.signOut=function(){return Z(this,void 0,void 0,function(){var e,r,n,o,i,a,c;return ee(this,function(h){switch(h.label){case 0:return e=this._cache.keys,r=e.refreshTokenKey,n=e.accessTokenKey,o=e.accessTokenExpireKey,i="auth.logout",[4,this._cache.getStoreAsync(r)];case 1:return a=h.sent(),a?[4,this._request.send(i,{refresh_token:a})]:[2];case 2:return c=h.sent(),this._cache.removeStoreAsync(r),this._cache.removeStoreAsync(n),this._cache.removeStoreAsync(o),ue.fire(re.LOGIN_STATE_CHANGED),ue.fire(re.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:pe.NULL,persistence:this._config.persistence}),[2,c]}})})},t.prototype.onLoginStateChanged=function(e){return Z(this,void 0,void 0,function(){var r,n=this;return ee(this,function(o){switch(o.label){case 0:return ue.on(re.LOGIN_STATE_CHANGED,function(){return Z(n,void 0,void 0,function(){var i;return ee(this,function(a){switch(a.label){case 0:return[4,this.getLoginState()];case 1:return i=a.sent(),e.call(this,i),[2]}})})}),[4,this.getLoginState()];case 1:return r=o.sent(),e.call(this,r),[2]}})})},t.prototype.onLoginStateExpired=function(e){ue.on(re.LOGIN_STATE_EXPIRED,e.bind(this))},t.prototype.onAccessTokenRefreshed=function(e){ue.on(re.ACCESS_TOKEN_REFRESHD,e.bind(this))},t.prototype.onAnonymousConverted=function(e){ue.on(re.ANONYMOUS_CONVERTED,e.bind(this))},t.prototype.onLoginTypeChanged=function(e){var r=this;ue.on(re.LOGIN_TYPE_CHANGED,function(){return Z(r,void 0,void 0,function(){var n;return ee(this,function(o){switch(o.label){case 0:return[4,this.getLoginState()];case 1:return n=o.sent(),e.call(this,n),[2]}})})})},t.prototype.hasLoginState=function(){if(this._cache.mode==="async"){ao(cr.INVALID_OPERATION,"current platform's storage is asynchronous, please use getLoginState insteed");return}var e=this._cache.keys.refreshTokenKey,r=this._cache.getStore(e);if(r){var n=new ct({envId:this._config.env,cache:this._cache,request:this._request});return n.checkLocalState(),n}else return null},t.prototype.getLoginState=function(){return Z(this,void 0,void 0,function(){var e,r,n;return ee(this,function(o){switch(o.label){case 0:return e=this._cache.keys.refreshTokenKey,[4,this._cache.getStoreAsync(e)];case 1:return r=o.sent(),r?(n=new ct({envId:this._config.env,cache:this._cache,request:this._request}),[4,n.checkLocalStateAsync()]):[3,3];case 2:return o.sent(),[2,n];case 3:return[2,null]}})})},t.prototype.shouldRefreshAccessToken=function(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)},t.prototype.getUserInfo=function(){return Z(this,void 0,void 0,function(){var e,r;return ee(this,function(n){switch(n.label){case 0:return e="auth.getUserInfo",[4,this._request.send(e,{})];case 1:return r=n.sent(),r.code?[2,r]:[2,ge(ge({},r.data),{requestId:r.seqId})]}})})},t.prototype.getAuthHeader=function(){var e=this._cache.keys,r=e.refreshTokenKey,n=e.accessTokenKey,o=this._cache.getStore(r),i=this._cache.getStore(n);return{"x-cloudbase-credentials":i+"/@@/"+o}},t.prototype.getAuthHeaderAsync=function(){return Z(this,void 0,void 0,function(){var e,r,n,o,i;return ee(this,function(a){switch(a.label){case 0:return[4,this._request.refreshAccessToken()];case 1:return a.sent(),e=this._cache.keys,r=e.refreshTokenKey,n=e.accessTokenKey,[4,this._cache.getStoreAsync(r)];case 2:return o=a.sent(),[4,this._cache.getStoreAsync(n)];case 3:return i=a.sent(),[2,{"x-cloudbase-credentials":i+"/@@/"+o}]}})})},t.prototype.sendPhoneCode=function(e){return Z(this,void 0,void 0,function(){var r;return ee(this,function(n){switch(n.label){case 0:return[4,this._request.send("auth.sendPhoneCode",{phoneNumber:uo(e)})];case 1:return r=n.sent().data,[2,r.SendStatus==="Ok"]}})})},t.prototype.signUpWithPhoneCode=function(e,r,n){return Z(this,void 0,void 0,function(){return ee(this,function(o){return[2,this.phoneAuthProvider().signUp(e,r,n)]})})},t.prototype.signInWithPhoneCodeOrPassword=function(e){return Z(this,void 0,void 0,function(){return ee(this,function(r){return[2,this.phoneAuthProvider().signIn(e)]})})},t.prototype.forceResetPwdByPhoneCode=function(e){return Z(this,void 0,void 0,function(){return ee(this,function(r){return[2,this.phoneAuthProvider().signIn(ge(ge({},e),{signMethod:In.FORCERESETPWD}))]})})},t.prototype._onLoginTypeChanged=function(e){return Z(this,void 0,void 0,function(){var r,n,o,i;return ee(this,function(a){switch(a.label){case 0:return r=e.data,n=r.loginType,o=r.persistence,i=r.env,i!==this._config.env?[2]:[4,this._cache.updatePersistenceAsync(o)];case 1:return a.sent(),[4,this._cache.setStoreAsync(this._cache.keys.loginTypeKey,n)];case 2:return a.sent(),[2]}})})},ve([we({title:"获取用户信息失败",messages:["请确认以下各项：","  1 - 调用 auth().getCurrenUser() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Promise)],t.prototype,"getCurrenUser",null),ve([we({title:"获取用户是否被占用失败",messages:["请确认以下各项：","  1 - 调用 auth().isUsernameRegistered() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[String]),M("design:returntype",Promise)],t.prototype,"isUsernameRegistered",null),ve([we({title:"用户登出失败",messages:["请确认以下各项：","  1 - 调用 auth().signOut() 的语法或参数是否正确","  2 - 当前用户是否为匿名登录（匿名登录不支持signOut）","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Promise)],t.prototype,"signOut",null),ve([we({title:"获取本地登录态失败",messages:["请确认以下各项：","  1 - 调用 auth().getLoginState() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Promise)],t.prototype,"getLoginState",null),ve([we({title:"获取用户信息失败",messages:["请确认以下各项：","  1 - 是否已登录","  2 - 调用 auth().getUserInfo() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Promise)],t.prototype,"getUserInfo",null),ve([we({title:"发送短信验证码失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+_e]}),M("design:type",Function),M("design:paramtypes",[String]),M("design:returntype",Promise)],t.prototype,"sendPhoneCode",null),t}(),re={LOGIN_STATE_CHANGED:"loginStateChanged",LOGIN_STATE_EXPIRED:"loginStateExpire",LOGIN_TYPE_CHANGED:"loginTypeChanged",ANONYMOUS_CONVERTED:"anonymousConverted",ACCESS_TOKEN_REFRESHD:"refreshAccessToken"},Ld={name:Pd,namespace:"auth",injectEvents:{bus:ue,events:[re.LOGIN_TYPE_CHANGED,re.LOGIN_STATE_EXPIRED,re.LOGIN_STATE_CHANGED,re.ACCESS_TOKEN_REFRESHD,re.ANONYMOUS_CONVERTED]},entity:function(t){if(t===void 0&&(t={region:"",persistence:"local"}),this.authInstance)return ao(cr.INVALID_OPERATION,"every cloudbase instance should has only one auth object"),this.authInstance;var e=this.platform,r=e.adapter,n=e.runtime,o=t.persistence||r.primaryStorage;o&&o!==this.config.persistence&&this.updateConfig({persistence:o});var i=this.config,a=i.env,c=i.persistence,h=i.debug;return this.authInstance=new Dd({env:a,region:t.region,persistence:c,debug:h,cache:this.cache,request:this.request,runtime:n}),this.authInstance}};try{cloudbase.registerComponent(Ld)}catch{}var Lt,mt;(function(t){t.DocIDError="文档ID不合法",t.CollNameError="集合名称不合法",t.OpStrError="操作符不合法",t.DirectionError="排序字符不合法",t.IntergerError="must be integer",t.QueryParamTypeError="查询参数必须为对象",t.QueryParamValueError="查询参数对象值不能均为undefined"})(mt||(mt={}));var se={String:"String",Number:"Number",Object:"Object",Array:"Array",Boolean:"Boolean",Null:"Null",GeoPoint:"GeoPoint",GeoLineString:"GeoLineString",GeoPolygon:"GeoPolygon",GeoMultiPoint:"GeoMultiPoint",GeoMultiLineString:"GeoMultiLineString",GeoMultiPolygon:"GeoMultiPolygon",Timestamp:"Date",Command:"Command",ServerDate:"ServerDate",BsonDate:"BsonDate"},Fd=["desc","asc"],Ud=["<","<=","==",">=",">"],kt;(function(t){t.lt="<",t.gt=">",t.lte="<=",t.gte=">=",t.eq="=="})(kt||(kt={}));Lt={},Lt[kt.eq]="$eq",Lt[kt.lt]="$lt",Lt[kt.lte]="$lte",Lt[kt.gt]="$gt",Lt[kt.gte]="$gte";var ut;(function(t){t.WHERE="WHERE",t.DOC="DOC"})(ut||(ut={}));var kd=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),mn=[],As={},Md=function(){function t(e){Object.defineProperties(this,{target:{enumerable:!1,writable:!1,configurable:!1,value:e}})}return t}(),$e=function(t){kd(e,t);function e(r,n){var o=this;if(n!==As)throw new TypeError("InternalSymbol cannot be constructed with new operator");return o=t.call(this,r)||this,o}return e.for=function(r){for(var n=0,o=mn.length;n<o;n++)if(mn[n].target===r)return mn[n].instance;var i=new e(r,As);return mn.push({target:r,instance:i}),i},e}(Md),Wr=$e.for("UNSET_FIELD_NAME"),Ua=$e.for("UPDATE_COMMAND"),ka=$e.for("QUERY_COMMAND"),Ma=$e.for("LOGIC_COMMAND"),$a=$e.for("GEO_POINT"),$d=$e.for("SYMBOL_GEO_LINE_STRING"),jd=$e.for("SYMBOL_GEO_POLYGON"),Wd=$e.for("SYMBOL_GEO_MULTI_POINT"),qd=$e.for("SYMBOL_GEO_MULTI_LINE_STRING"),Hd=$e.for("SYMBOL_GEO_MULTI_POLYGON"),ja=$e.for("SERVER_DATE"),Wa=$e.for("REGEXP"),qa=function(){function t(e){var r=(e===void 0?{}:e).offset,n=r===void 0?0:r;this.offset=n}return Object.defineProperty(t.prototype,"_internalType",{get:function(){return ja},enumerable:!0,configurable:!0}),t.prototype.parse=function(){return{$date:{offset:this.offset}}},t}();function Kd(t){return new qa(t)}var Hi=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return i},Vn=function(){function t(){}return t.formatResDocumentData=function(e){return e.map(function(r){return t.formatField(r)})},t.formatField=function(e){var r=Object.keys(e),n={};return Array.isArray(e)&&(n=[]),r.forEach(function(o){var i=e[o],a=t.whichType(i),c;switch(a){case se.GeoPoint:c=new Ue(i.coordinates[0],i.coordinates[1]);break;case se.GeoLineString:c=new st(i.coordinates.map(function(h){return new Ue(h[0],h[1])}));break;case se.GeoPolygon:c=new jt(i.coordinates.map(function(h){return new st(h.map(function(s){var u=Hi(s,2),d=u[0],m=u[1];return new Ue(d,m)}))}));break;case se.GeoMultiPoint:c=new Pn(i.coordinates.map(function(h){return new Ue(h[0],h[1])}));break;case se.GeoMultiLineString:c=new Bn(i.coordinates.map(function(h){return new st(h.map(function(s){var u=Hi(s,2),d=u[0],m=u[1];return new Ue(d,m)}))}));break;case se.GeoMultiPolygon:c=new qr(i.coordinates.map(function(h){return new jt(h.map(function(s){return new st(s.map(function(u){var d=Hi(u,2),m=d[0],v=d[1];return new Ue(m,v)}))}))}));break;case se.Timestamp:c=new Date(i.$timestamp*1e3);break;case se.Object:case se.Array:c=t.formatField(i);break;case se.ServerDate:c=new Date(i.$date);break;default:c=i}Array.isArray(n)?n.push(c):n[o]=c}),n},t.whichType=function(e){var r=Object.prototype.toString.call(e).slice(8,-1);if(r===se.Timestamp)return se.BsonDate;if(r===se.Object){if(e instanceof Ue)return se.GeoPoint;if(e instanceof Date)return se.Timestamp;if(e instanceof qa)return se.ServerDate;e.$timestamp?r=se.Timestamp:e.$date?r=se.ServerDate:Ue.validate(e)?r=se.GeoPoint:st.validate(e)?r=se.GeoLineString:jt.validate(e)?r=se.GeoPolygon:Pn.validate(e)?r=se.GeoMultiPoint:Bn.validate(e)?r=se.GeoMultiLineString:qr.validate(e)&&(r=se.GeoMultiPolygon)}return r},t.generateDocId=function(){for(var e="ABCDEFabcdef0123456789",r="",n=0;n<24;n++)r+=e.charAt(Math.floor(Math.random()*e.length));return r},t}(),At=function(){function t(){}return t.isGeopoint=function(e,r){if(Vn.whichType(r)!==se.Number)throw new Error("Geo Point must be number type");var n=Math.abs(r);if(e==="latitude"&&n>90)throw new Error("latitude should be a number ranges from -90 to 90");if(e==="longitude"&&n>180)throw new Error("longitude should be a number ranges from -180 to 180");return!0},t.isInteger=function(e,r){if(!Number.isInteger(r))throw new Error(e+mt.IntergerError);return!0},t.isFieldOrder=function(e){if(Fd.indexOf(e)===-1)throw new Error(mt.DirectionError);return!0},t.isFieldPath=function(e){if(!/^[a-zA-Z0-9-_\.]/.test(e))throw new Error;return!0},t.isOperator=function(e){if(Ud.indexOf(e)===-1)throw new Error(mt.OpStrError);return!0},t.isCollName=function(e){if(!/^[a-zA-Z0-9]([a-zA-Z0-9-_]){1,32}$/.test(e))throw new Error(mt.CollNameError);return!0},t.isDocID=function(e){if(!/^([a-fA-F0-9]){24}$/.test(e))throw new Error(mt.DocIDError);return!0},t}(),ft=function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},Tt=function(t){return ft(t)==="object"},Gd=function(t){return ft(t)==="string"},Xe=function(t){return ft(t)==="number"},de=function(t){return Array.isArray(t)},Ha=function(t){return ft(t)==="date"},Ao=function(t){return ft(t)==="regexp"},Ka=function(t){return t&&t._internalType instanceof $e},Ue=function(){function t(e,r){At.isGeopoint("longitude",e),At.isGeopoint("latitude",r),this.longitude=e,this.latitude=r}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"Point",coordinates:[this.longitude,this.latitude]},r},t.prototype.toJSON=function(){return{type:"Point",coordinates:[this.longitude,this.latitude]}},t.prototype.toReadableString=function(){return"["+this.longitude+","+this.latitude+"]"},t.validate=function(e){return e.type==="Point"&&de(e.coordinates)&&At.isGeopoint("longitude",e.coordinates[0])&&At.isGeopoint("latitude",e.coordinates[1])},Object.defineProperty(t.prototype,"_internalType",{get:function(){return $a},enumerable:!0,configurable:!0}),t}(),Vd=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},st=function(){function t(e){if(!de(e))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e);if(e.length<2)throw new Error('"points" must contain 2 points at least');e.forEach(function(r){if(!(r instanceof Ue))throw new TypeError('"points" must be of type Point[]. Received type '+typeof r+"[]")}),this.points=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"LineString",coordinates:this.points.map(function(n){return n.toJSON().coordinates})},r},t.prototype.toJSON=function(){return{type:"LineString",coordinates:this.points.map(function(e){return e.toJSON().coordinates})}},t.validate=function(e){var r,n;if(e.type!=="LineString"||!de(e.coordinates))return!1;try{for(var o=Vd(e.coordinates),i=o.next();!i.done;i=o.next()){var a=i.value;if(!Xe(a[0])||!Xe(a[1]))return!1}}catch(c){r={error:c}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!0},t.isClosed=function(e){var r=e.points[0],n=e.points[e.points.length-1];if(r.latitude===n.latitude&&r.longitude===n.longitude)return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return $d},enumerable:!0,configurable:!0}),t}(),Is=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},jt=function(){function t(e){if(!de(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e);if(e.length===0)throw new Error("Polygon must contain 1 linestring at least");e.forEach(function(r){if(!(r instanceof st))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof r+"[]");if(!st.isClosed(r))throw new Error("LineString "+r.points.map(function(n){return n.toReadableString()})+" is not a closed cycle")}),this.lines=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"Polygon",coordinates:this.lines.map(function(n){return n.points.map(function(o){return[o.longitude,o.latitude]})})},r},t.prototype.toJSON=function(){return{type:"Polygon",coordinates:this.lines.map(function(e){return e.points.map(function(r){return[r.longitude,r.latitude]})})}},t.validate=function(e){var r,n,o,i;if(e.type!=="Polygon"||!de(e.coordinates))return!1;try{for(var a=Is(e.coordinates),c=a.next();!c.done;c=a.next()){var h=c.value;if(!this.isCloseLineString(h))return!1;try{for(var s=(o=void 0,Is(h)),u=s.next();!u.done;u=s.next()){var d=u.value;if(!Xe(d[0])||!Xe(d[1]))return!1}}catch(m){o={error:m}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}}}catch(m){r={error:m}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return!0},t.isCloseLineString=function(e){var r=e[0],n=e[e.length-1];return!(r[0]!==n[0]||r[1]!==n[1])},Object.defineProperty(t.prototype,"_internalType",{get:function(){return Hd},enumerable:!0,configurable:!0}),t}(),Jd=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Pn=function(){function t(e){if(!de(e))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e);if(e.length===0)throw new Error('"points" must contain 1 point at least');e.forEach(function(r){if(!(r instanceof Ue))throw new TypeError('"points" must be of type Point[]. Received type '+typeof r+"[]")}),this.points=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"MultiPoint",coordinates:this.points.map(function(n){return n.toJSON().coordinates})},r},t.prototype.toJSON=function(){return{type:"MultiPoint",coordinates:this.points.map(function(e){return e.toJSON().coordinates})}},t.validate=function(e){var r,n;if(e.type!=="MultiPoint"||!de(e.coordinates))return!1;try{for(var o=Jd(e.coordinates),i=o.next();!i.done;i=o.next()){var a=i.value;if(!Xe(a[0])||!Xe(a[1]))return!1}}catch(c){r={error:c}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return Wd},enumerable:!0,configurable:!0}),t}(),Ts=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Bn=function(){function t(e){if(!de(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e);if(e.length===0)throw new Error("Polygon must contain 1 linestring at least");e.forEach(function(r){if(!(r instanceof st))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof r+"[]")}),this.lines=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"MultiLineString",coordinates:this.lines.map(function(n){return n.points.map(function(o){return[o.longitude,o.latitude]})})},r},t.prototype.toJSON=function(){return{type:"MultiLineString",coordinates:this.lines.map(function(e){return e.points.map(function(r){return[r.longitude,r.latitude]})})}},t.validate=function(e){var r,n,o,i;if(e.type!=="MultiLineString"||!de(e.coordinates))return!1;try{for(var a=Ts(e.coordinates),c=a.next();!c.done;c=a.next()){var h=c.value;try{for(var s=(o=void 0,Ts(h)),u=s.next();!u.done;u=s.next()){var d=u.value;if(!Xe(d[0])||!Xe(d[1]))return!1}}catch(m){o={error:m}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}}}catch(m){r={error:m}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return qd},enumerable:!0,configurable:!0}),t}(),vn=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},qr=function(){function t(e){var r,n;if(!de(e))throw new TypeError('"polygons" must be of type Polygon[]. Received type '+typeof e);if(e.length===0)throw new Error("MultiPolygon must contain 1 polygon at least");try{for(var o=vn(e),i=o.next();!i.done;i=o.next()){var a=i.value;if(!(a instanceof jt))throw new TypeError('"polygon" must be of type Polygon[]. Received type '+typeof a+"[]")}}catch(c){r={error:c}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}this.polygons=e}return t.prototype.parse=function(e){var r;return r={},r[e]={type:"MultiPolygon",coordinates:this.polygons.map(function(n){return n.lines.map(function(o){return o.points.map(function(i){return[i.longitude,i.latitude]})})})},r},t.prototype.toJSON=function(){return{type:"MultiPolygon",coordinates:this.polygons.map(function(e){return e.lines.map(function(r){return r.points.map(function(n){return[n.longitude,n.latitude]})})})}},t.validate=function(e){var r,n,o,i,a,c;if(e.type!=="MultiPolygon"||!de(e.coordinates))return!1;try{for(var h=vn(e.coordinates),s=h.next();!s.done;s=h.next()){var u=s.value;try{for(var d=(o=void 0,vn(u)),m=d.next();!m.done;m=d.next()){var v=m.value;try{for(var b=(a=void 0,vn(v)),I=b.next();!I.done;I=b.next()){var E=I.value;if(!Xe(E[0])||!Xe(E[1]))return!1}}catch(A){a={error:A}}finally{try{I&&!I.done&&(c=b.return)&&c.call(b)}finally{if(a)throw a.error}}}}catch(A){o={error:A}}finally{try{m&&!m.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}}}catch(A){r={error:A}}finally{try{s&&!s.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}return!0},Object.defineProperty(t.prototype,"_internalType",{get:function(){return jd},enumerable:!0,configurable:!0}),t}();const Yd=Object.freeze(Object.defineProperty({__proto__:null,LineString:st,MultiLineString:Bn,MultiPoint:Pn,MultiPolygon:qr,Point:Ue,Polygon:jt},Symbol.toStringTag,{value:"Module"}));var vt=function(){var t;if(!Promise){t=function(){},t.promise={};var e=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(t.promise,"then",{get:e}),Object.defineProperty(t.promise,"catch",{get:e}),t}var r=new Promise(function(n,o){t=function(i,a){return i?o(i):n(a)}});return t.promise=r,t},J;(function(t){t.SET="set",t.REMOVE="remove",t.INC="inc",t.MUL="mul",t.PUSH="push",t.PULL="pull",t.PULL_ALL="pullAll",t.POP="pop",t.SHIFT="shift",t.UNSHIFT="unshift",t.ADD_TO_SET="addToSet",t.BIT="bit",t.RENAME="rename",t.MAX="max",t.MIN="min"})(J||(J={}));var ye=function(){function t(e,r,n){this._internalType=Ua,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=r,this.fieldName=n||Wr}return t.prototype._setFieldName=function(e){var r=new t(this.operator,this.operands,e);return r},t}();function Os(t){return t&&t instanceof ye&&t._internalType===Ua}var Me;(function(t){t.AND="and",t.OR="or",t.NOT="not",t.NOR="nor"})(Me||(Me={}));var $t=function(){function t(e,r,n){if(this._internalType=Ma,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=r,this.fieldName=n||Wr,this.fieldName!==Wr)if(Array.isArray(r)){r=r.slice(),this.operands=r;for(var o=0,i=r.length;o<i;o++){var a=r[o];(Dn(a)||Ln(a))&&(r[o]=a._setFieldName(this.fieldName))}}else{var a=r;(Dn(a)||Ln(a))&&(r=a._setFieldName(this.fieldName))}}return t.prototype._setFieldName=function(e){var r=this.operands.map(function(o){return o instanceof t?o._setFieldName(e):o}),n=new t(this.operator,r,e);return n},t.prototype.and=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return e.unshift(this),new t(Me.AND,e,this.fieldName)},t.prototype.or=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return e.unshift(this),new t(Me.OR,e,this.fieldName)},t}();function Dn(t){return t&&t instanceof $t&&t._internalType===Ma}var Xd=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),W;(function(t){t.EQ="eq",t.NEQ="neq",t.GT="gt",t.GTE="gte",t.LT="lt",t.LTE="lte",t.IN="in",t.NIN="nin",t.ALL="all",t.ELEM_MATCH="elemMatch",t.EXISTS="exists",t.SIZE="size",t.MOD="mod",t.GEO_NEAR="geoNear",t.GEO_WITHIN="geoWithin",t.GEO_INTERSECTS="geoIntersects"})(W||(W={}));var me=function(t){Xd(e,t);function e(r,n,o){var i=t.call(this,r,n,o)||this;return i.operator=r,i._internalType=ka,i}return e.prototype.toJSON=function(){var r,n;switch(this.operator){case W.IN:case W.NIN:return r={},r["$"+this.operator]=this.operands,r;default:return n={},n["$"+this.operator]=this.operands[0],n}},e.prototype._setFieldName=function(r){var n=new e(this.operator,this.operands,r);return n},e.prototype.eq=function(r){var n=new e(W.EQ,[r],this.fieldName);return this.and(n)},e.prototype.neq=function(r){var n=new e(W.NEQ,[r],this.fieldName);return this.and(n)},e.prototype.gt=function(r){var n=new e(W.GT,[r],this.fieldName);return this.and(n)},e.prototype.gte=function(r){var n=new e(W.GTE,[r],this.fieldName);return this.and(n)},e.prototype.lt=function(r){var n=new e(W.LT,[r],this.fieldName);return this.and(n)},e.prototype.lte=function(r){var n=new e(W.LTE,[r],this.fieldName);return this.and(n)},e.prototype.in=function(r){var n=new e(W.IN,r,this.fieldName);return this.and(n)},e.prototype.nin=function(r){var n=new e(W.NIN,r,this.fieldName);return this.and(n)},e.prototype.geoNear=function(r){if(!(r.geometry instanceof Ue))throw new TypeError('"geometry" must be of type Point. Received type '+typeof r.geometry);if(r.maxDistance!==void 0&&!Xe(r.maxDistance))throw new TypeError('"maxDistance" must be of type Number. Received type '+typeof r.maxDistance);if(r.minDistance!==void 0&&!Xe(r.minDistance))throw new TypeError('"minDistance" must be of type Number. Received type '+typeof r.minDistance);var n=new e(W.GEO_NEAR,[r],this.fieldName);return this.and(n)},e.prototype.geoWithin=function(r){if(!(r.geometry instanceof qr)&&!(r.geometry instanceof jt))throw new TypeError('"geometry" must be of type Polygon or MultiPolygon. Received type '+typeof r.geometry);var n=new e(W.GEO_WITHIN,[r],this.fieldName);return this.and(n)},e.prototype.geoIntersects=function(r){if(!(r.geometry instanceof Ue)&&!(r.geometry instanceof st)&&!(r.geometry instanceof jt)&&!(r.geometry instanceof Pn)&&!(r.geometry instanceof Bn)&&!(r.geometry instanceof qr))throw new TypeError('"geometry" must be of type Point, LineString, Polygon, MultiPoint, MultiLineString or MultiPolygon. Received type '+typeof r.geometry);var n=new e(W.GEO_INTERSECTS,[r],this.fieldName);return this.and(n)},e}($t);function Ln(t){return t&&t instanceof me&&t._internalType===ka}function xs(t){return Ln(t)}var xt={};for(var Ot in W)xt[Ot]="$"+Ot;for(var Ot in Me)xt[Ot]="$"+Ot;for(var Ot in J)xt[Ot]="$"+Ot;xt[W.NEQ]="$ne";xt[J.REMOVE]="$unset";xt[J.SHIFT]="$pop";xt[J.UNSHIFT]="$push";function sr(t){return xt[t]||"$"+t}var co=function(){return co=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},co.apply(this,arguments)},zd=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return i},Ns=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(zd(arguments[e]));return t};function Hr(t){return fo(t,[t])}function fo(t,e){if(Ka(t))switch(t._internalType){case $a:return t.toJSON();case ja:return t.parse();case Wa:return t.parse();default:return t.toJSON?t.toJSON():t}else{if(Ha(t))return{$date:+t};if(Ao(t))return{$regex:t.source,$options:t.flags};if(de(t))return t.map(function(o){if(e.indexOf(o)>-1)throw new Error("Cannot convert circular structure to JSON");return fo(o,Ns(e,[o]))});if(Tt(t)){var r=co({},t);for(var n in r){if(e.indexOf(r[n])>-1)throw new Error("Cannot convert circular structure to JSON");r[n]=fo(r[n],Ns(e,[r[n]]))}return r}else return t}}var lo=function(){return lo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},lo.apply(this,arguments)},Qd=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return i},Rs=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Qd(arguments[e]));return t};function Ga(t,e,r,n){var o=lo({},t);for(var i in t)if(!/^\$/.test(i)){var a=t[i];if(a&&Tt(a)&&!e(a)){if(n.indexOf(a)>-1)throw new Error("Cannot convert circular structure to JSON");var c=Rs(r,[i]),h=Rs(n,[a]),s=Ga(a,e,c,h);o[i]=s;var u=!1;for(var d in s)/^\$/.test(d)?u=!0:(o[i+"."+d]=s[d],delete o[i][d]);u||delete o[i]}}return o}function Va(t){return Ga(t,ho,[],[t])}function Cs(t,e,r){e[r]||delete t[r];for(var n in e)t[n]?de(t[n])?t[n].push(e[n]):Tt(t[n])?Tt(e[n])?Object.assign(t[n],e[n]):(console.warn("unmergable condition, query is object but condition is "+ft(e)+", can only overwrite",e,r),t[n]=e[n]):(console.warn("to-merge query is of type "+ft(t)+", can only overwrite",t,e,r),t[n]=e[n]):t[n]=e[n]}function ho(t){return Ka(t)||Ha(t)||Ao(t)}function It(t){return Hr(t)}var Io=function(){function t(){}return t.encode=function(e){var r=new t;return r.encodeUpdate(e)},t.prototype.encodeUpdate=function(e){return Os(e)?this.encodeUpdateCommand(e):ft(e)==="object"?this.encodeUpdateObject(e):e},t.prototype.encodeUpdateCommand=function(e){if(e.fieldName===Wr)throw new Error("Cannot encode a comparison command with unset field name");switch(e.operator){case J.PUSH:case J.PULL:case J.PULL_ALL:case J.POP:case J.SHIFT:case J.UNSHIFT:case J.ADD_TO_SET:return this.encodeArrayUpdateCommand(e);default:return this.encodeFieldUpdateCommand(e)}},t.prototype.encodeFieldUpdateCommand=function(e){var r,n,o,i,a=sr(e.operator);switch(e.operator){case J.REMOVE:return r={},r[a]=(n={},n[e.fieldName]="",n),r;default:return o={},o[a]=(i={},i[e.fieldName]=e.operands[0],i),o}},t.prototype.encodeArrayUpdateCommand=function(e){var r,n,o,i,a,c,h,s,u,d,m=sr(e.operator);switch(e.operator){case J.PUSH:{var v=void 0;return de(e.operands)?v={$each:e.operands.map(It)}:v=e.operands,r={},r[m]=(n={},n[e.fieldName]=v,n),r}case J.UNSHIFT:{var v={$each:e.operands.map(It),$position:0};return o={},o[m]=(i={},i[e.fieldName]=v,i),o}case J.POP:return a={},a[m]=(c={},c[e.fieldName]=1,c),a;case J.SHIFT:return h={},h[m]=(s={},s[e.fieldName]=-1,s),h;default:return u={},u[m]=(d={},d[e.fieldName]=It(e.operands),d),u}},t.prototype.encodeUpdateObject=function(e){var r=Va(e);for(var n in r)if(!/^\$/.test(n)){var o=r[n];if(Os(o)){r[n]=o._setFieldName(n);var i=this.encodeUpdateCommand(r[n]);Cs(r,i,n)}else{r[n]=o=It(o);var a=new ye(J.SET,[o],n),i=this.encodeUpdateCommand(a);Cs(r,i,n)}}return r},t}(),Ki={};function Ja(t){if(!Oe.wsClientClass)throw new Error("to use realtime you must import realtime module first");var e=t.config.env;return Ki[e]||(Ki[e]=new Oe.wsClientClass({context:{appConfig:{docSizeLimit:1e3,realtimePingInterval:1e4,realtimePongWaitTimeout:5e3,request:new Oe.reqClass(t.config)}}})),Ki[e]}var Fn=function(){return Fn=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Fn.apply(this,arguments)},Ps=function(){function t(e,r,n,o){var i=this;o===void 0&&(o={}),this.watch=function(a){var c=Ja(i._db);return c.watch(Fn(Fn({},a),{envId:i._db.config.env,collectionName:i._coll,query:JSON.stringify({_id:i.id})}))},this._db=e,this._coll=r,this.id=n,this.request=new Oe.reqClass(this._db.config),this.projection=o}return t.prototype.create=function(e,r){r=r||vt();var n={collectionName:this._coll,data:Hr(e)};return this.id&&(n._id=this.id),this.request.send("database.addDocument",n).then(function(o){o.code?r(0,o):r(0,{id:o.data._id,requestId:o.requestId})}).catch(function(o){r(o)}),r.promise},t.prototype.set=function(e,r){if(r=r||vt(),!this.id)return Promise.resolve({code:"INVALID_PARAM",message:"docId不能为空"});if(!e||typeof e!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n=!1,o=function(c){if(typeof c=="object")for(var h in c)c[h]instanceof ye?n=!0:typeof c[h]=="object"&&o(c[h])};if(o(e),n)return Promise.resolve({code:"DATABASE_REQUEST_FAILED",message:"update operator complicit"});var i=!1,a={collectionName:this._coll,queryType:ut.DOC,data:Hr(e),multi:!1,merge:i,upsert:!0};return this.id&&(a.query={_id:this.id}),this.request.send("database.updateDocument",a).then(function(c){c.code?r(0,c):r(0,{updated:c.data.updated,upsertedId:c.data.upserted_id,requestId:c.requestId})}).catch(function(c){r(c)}),r.promise},t.prototype.update=function(e,r){if(r=r||vt(),!e||typeof e!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n={_id:this.id},o=!0,i={collectionName:this._coll,data:Io.encode(e),query:n,queryType:ut.DOC,multi:!1,merge:o,upsert:!1};return this.request.send("database.updateDocument",i).then(function(a){a.code?r(0,a):r(0,{updated:a.data.updated,upsertedId:a.data.upserted_id,requestId:a.requestId})}).catch(function(a){r(a)}),r.promise},t.prototype.remove=function(e){e=e||vt();var r={_id:this.id},n={collectionName:this._coll,query:r,queryType:ut.DOC,multi:!1};return this.request.send("database.deleteDocument",n).then(function(o){o.code?e(0,o):e(0,{deleted:o.data.deleted,requestId:o.requestId})}).catch(function(o){e(o)}),e.promise},t.prototype.get=function(e){e=e||vt();var r={_id:this.id},n={collectionName:this._coll,query:r,queryType:ut.DOC,multi:!1,projection:this.projection};return this.request.send("database.queryDocument",n).then(function(o){if(o.code)e(0,o);else{var i=Vn.formatResDocumentData(o.data.list);e(0,{data:i,requestId:o.requestId,total:o.TotalCount,limit:o.Limit,offset:o.Offset})}}).catch(function(o){e(o)}),e.promise},t.prototype.field=function(e){for(var r in e)e[r]?e[r]=1:e[r]=0;return new t(this._db,this._coll,this.id,e)},t}(),po=function(){function t(){}return t.encode=function(e){var r=new Zd;return r.encodeQuery(e)},t}(),Zd=function(){function t(){}return t.prototype.encodeQuery=function(e,r){var n;return ho(e)?Dn(e)?this.encodeLogicCommand(e):Ln(e)?this.encodeQueryCommand(e):(n={},n[r]=this.encodeQueryObject(e),n):Tt(e)?this.encodeQueryObject(e):e},t.prototype.encodeRegExp=function(e){return{$regex:e.source,$options:e.flags}},t.prototype.encodeLogicCommand=function(e){var r,n,o,i,a,c,h,s=this;switch(e.operator){case Me.NOR:case Me.AND:case Me.OR:{var u=sr(e.operator),d=e.operands.map(function(b){return s.encodeQuery(b,e.fieldName)});return r={},r[u]=d,r}case Me.NOT:{var u=sr(e.operator),m=e.operands[0];if(Ao(m))return n={},n[e.fieldName]=(o={},o[u]=this.encodeRegExp(m),o),n;var d=this.encodeQuery(m)[e.fieldName];return i={},i[e.fieldName]=(a={},a[u]=d,a),i}default:{var u=sr(e.operator);if(e.operands.length===1){var v=this.encodeQuery(e.operands[0]);return c={},c[u]=v,c}else{var d=e.operands.map(this.encodeQuery.bind(this));return h={},h[u]=d,h}}}},t.prototype.encodeQueryCommand=function(e){return xs(e)?this.encodeComparisonCommand(e):this.encodeComparisonCommand(e)},t.prototype.encodeComparisonCommand=function(e){var r,n,o,i,a,c,h,s,u;if(e.fieldName===Wr)throw new Error("Cannot encode a comparison command with unset field name");var d=sr(e.operator);switch(e.operator){case W.EQ:case W.NEQ:case W.LT:case W.LTE:case W.GT:case W.GTE:case W.ELEM_MATCH:case W.EXISTS:case W.SIZE:case W.MOD:return r={},r[e.fieldName]=(n={},n[d]=It(e.operands[0]),n),r;case W.IN:case W.NIN:case W.ALL:return o={},o[e.fieldName]=(i={},i[d]=It(e.operands),i),o;case W.GEO_NEAR:{var m=e.operands[0];return a={},a[e.fieldName]={$nearSphere:{$geometry:m.geometry.toJSON(),$maxDistance:m.maxDistance,$minDistance:m.minDistance}},a}case W.GEO_WITHIN:{var m=e.operands[0];return c={},c[e.fieldName]={$geoWithin:{$geometry:m.geometry.toJSON()}},c}case W.GEO_INTERSECTS:{var m=e.operands[0];return h={},h[e.fieldName]={$geoIntersects:{$geometry:m.geometry.toJSON()}},h}default:return s={},s[e.fieldName]=(u={},u[d]=It(e.operands[0]),u),s}},t.prototype.encodeQueryObject=function(e){var r=Va(e);for(var n in r){var o=r[n];if(Dn(o)){r[n]=o._setFieldName(n);var i=this.encodeLogicCommand(r[n]);this.mergeConditionAfterEncode(r,i,n)}else if(xs(o)){r[n]=o._setFieldName(n);var i=this.encodeComparisonCommand(r[n]);this.mergeConditionAfterEncode(r,i,n)}else ho(o)&&(r[n]=It(o))}return r},t.prototype.mergeConditionAfterEncode=function(e,r,n){r[n]||delete e[n];for(var o in r)e[o]?de(e[o])?e[o]=e[o].concat(r[o]):Tt(e[o])?Tt(r[o])?Object.assign(e,r):(console.warn("unmergable condition, query is object but condition is "+ft(r)+", can only overwrite",r,n),e[o]=r[o]):(console.warn("to-merge query is of type "+ft(e)+", can only overwrite",e,r,n),e[o]=r[o]):e[o]=r[o]},t}(),Mt=function(){return Mt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Mt.apply(this,arguments)},ep=function(){function t(e,r,n,o,i){var a=this;this.watch=function(c){var h=Ja(a._db);return h.watch(Mt(Mt({},c),{envId:a._db.config.env,collectionName:a._coll,query:JSON.stringify(a._fieldFilters||{}),limit:a._queryOptions.limit,orderBy:a._fieldOrders?a._fieldOrders.reduce(function(s,u){return s[u.field]=u.direction,s},{}):void 0}))},this._db=e,this._coll=r,this._fieldFilters=n,this._fieldOrders=o||[],this._queryOptions=i||{},this._request=new Oe.reqClass(this._db.config)}return t.prototype.get=function(e){e=e||vt();var r=[];this._fieldOrders&&this._fieldOrders.forEach(function(o){r.push(o)});var n={collectionName:this._coll,queryType:ut.WHERE};return this._fieldFilters&&(n.query=this._fieldFilters),r.length>0&&(n.order=r),this._queryOptions.offset&&(n.offset=this._queryOptions.offset),this._queryOptions.limit?n.limit=this._queryOptions.limit<1e3?this._queryOptions.limit:1e3:n.limit=100,this._queryOptions.projection&&(n.projection=this._queryOptions.projection),this._request.send("database.queryDocument",n).then(function(o){if(o.code)e(0,o);else{var i=Vn.formatResDocumentData(o.data.list),a={data:i,requestId:o.requestId};o.TotalCount&&(a.total=o.TotalCount),o.Limit&&(a.limit=o.Limit),o.Offset&&(a.offset=o.Offset),e(0,a)}}).catch(function(o){e(o)}),e.promise},t.prototype.count=function(e){e=e||vt();var r={collectionName:this._coll,queryType:ut.WHERE};return this._fieldFilters&&(r.query=this._fieldFilters),this._request.send("database.countDocument",r).then(function(n){n.code?e(0,n):e(0,{requestId:n.requestId,total:n.data.total})}).catch(function(n){e(n)}),e.promise},t.prototype.where=function(e){if(Object.prototype.toString.call(e).slice(8,-1)!=="Object")throw Error(mt.QueryParamTypeError);var r=Object.keys(e),n=r.some(function(o){return e[o]!==void 0});if(r.length&&!n)throw Error(mt.QueryParamValueError);return new t(this._db,this._coll,po.encode(e),this._fieldOrders,this._queryOptions)},t.prototype.orderBy=function(e,r){At.isFieldPath(e),At.isFieldOrder(r);var n={field:e,direction:r},o=this._fieldOrders.concat(n);return new t(this._db,this._coll,this._fieldFilters,o,this._queryOptions)},t.prototype.limit=function(e){At.isInteger("limit",e);var r=Mt({},this._queryOptions);return r.limit=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,r)},t.prototype.skip=function(e){At.isInteger("offset",e);var r=Mt({},this._queryOptions);return r.offset=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,r)},t.prototype.update=function(e,r){if(r=r||vt(),!e||typeof e!="object")return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n={collectionName:this._coll,query:this._fieldFilters,queryType:ut.WHERE,multi:!0,merge:!0,upsert:!1,data:Io.encode(e)};return this._request.send("database.updateDocument",n).then(function(o){o.code?r(0,o):r(0,{requestId:o.requestId,updated:o.data.updated,upsertId:o.data.upsert_id})}).catch(function(o){r(o)}),r.promise},t.prototype.field=function(e){for(var r in e)e[r]?typeof e[r]!="object"&&(e[r]=1):e[r]=0;var n=Mt({},this._queryOptions);return n.projection=e,new t(this._db,this._coll,this._fieldFilters,this._fieldOrders,n)},t.prototype.remove=function(e){e=e||vt(),Object.keys(this._queryOptions).length>0&&console.warn("`offset`, `limit` and `projection` are not supported in remove() operation"),this._fieldOrders.length>0&&console.warn("`orderBy` is not supported in remove() operation");var r={collectionName:this._coll,query:po.encode(this._fieldFilters),queryType:ut.WHERE,multi:!0};return this._request.send("database.deleteDocument",r).then(function(n){n.code?e(0,n):e(0,{requestId:n.requestId,deleted:n.data.deleted})}).catch(function(n){e(n)}),e.promise},t}();function tp(t,e){return e={exports:{}},t(e,e.exports),e.exports}var rp=ap,np=cp,ip=hp,at=[],Ve=[],op=typeof Uint8Array<"u"?Uint8Array:Array,Gi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var rr=0,sp=Gi.length;rr<sp;++rr)at[rr]=Gi[rr],Ve[Gi.charCodeAt(rr)]=rr;Ve[45]=62;Ve[95]=63;function Ya(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function ap(t){var e=Ya(t),r=e[0],n=e[1];return(r+n)*3/4-n}function up(t,e,r){return(e+r)*3/4-r}function cp(t){var e,r=Ya(t),n=r[0],o=r[1],i=new op(up(t,n,o)),a=0,c=o>0?n-4:n,h;for(h=0;h<c;h+=4)e=Ve[t.charCodeAt(h)]<<18|Ve[t.charCodeAt(h+1)]<<12|Ve[t.charCodeAt(h+2)]<<6|Ve[t.charCodeAt(h+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return o===2&&(e=Ve[t.charCodeAt(h)]<<2|Ve[t.charCodeAt(h+1)]>>4,i[a++]=e&255),o===1&&(e=Ve[t.charCodeAt(h)]<<10|Ve[t.charCodeAt(h+1)]<<4|Ve[t.charCodeAt(h+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function fp(t){return at[t>>18&63]+at[t>>12&63]+at[t>>6&63]+at[t&63]}function lp(t,e,r){for(var n,o=[],i=e;i<r;i+=3)n=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(t[i+2]&255),o.push(fp(n));return o.join("")}function hp(t){for(var e,r=t.length,n=r%3,o=[],i=16383,a=0,c=r-n;a<c;a+=i)o.push(lp(t,a,a+i>c?c:a+i));return n===1?(e=t[r-1],o.push(at[e>>2]+at[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],o.push(at[e>>10]+at[e>>4&63]+at[e<<2&63]+"=")),o.join("")}var Vi={byteLength:rp,toByteArray:np,fromByteArray:ip};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var dp=function(e,r,n,o,i){var a,c,h=i*8-o-1,s=(1<<h)-1,u=s>>1,d=-7,m=n?i-1:0,v=n?-1:1,b=e[r+m];for(m+=v,a=b&(1<<-d)-1,b>>=-d,d+=h;d>0;a=a*256+e[r+m],m+=v,d-=8);for(c=a&(1<<-d)-1,a>>=-d,d+=o;d>0;c=c*256+e[r+m],m+=v,d-=8);if(a===0)a=1-u;else{if(a===s)return c?NaN:(b?-1:1)*(1/0);c=c+Math.pow(2,o),a=a-u}return(b?-1:1)*c*Math.pow(2,a-o)},pp=function(e,r,n,o,i,a){var c,h,s,u=a*8-i-1,d=(1<<u)-1,m=d>>1,v=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=o?0:a-1,I=o?1:-1,E=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(h=isNaN(r)?1:0,c=d):(c=Math.floor(Math.log(r)/Math.LN2),r*(s=Math.pow(2,-c))<1&&(c--,s*=2),c+m>=1?r+=v/s:r+=v*Math.pow(2,1-m),r*s>=2&&(c++,s/=2),c+m>=d?(h=0,c=d):c+m>=1?(h=(r*s-1)*Math.pow(2,i),c=c+m):(h=r*Math.pow(2,m-1)*Math.pow(2,i),c=0));i>=8;e[n+b]=h&255,b+=I,h/=256,i-=8);for(c=c<<i|h,u+=i;u>0;e[n+b]=c&255,b+=I,c/=256,u-=8);e[n+b-I]|=E*128},nr={read:dp,write:pp},Jn=tp(function(t,e){var r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=a,e.SlowBuffer=A,e.INSPECT_MAX_BYTES=50;var n=2147483647;e.kMaxLength=n,a.TYPED_ARRAY_SUPPORT=o(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{var y=new Uint8Array(1),f={foo:function(){return 42}};return Object.setPrototypeOf(f,Uint8Array.prototype),Object.setPrototypeOf(y,f),y.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function i(y){if(y>n)throw new RangeError('The value "'+y+'" is invalid for option "size"');var f=new Uint8Array(y);return Object.setPrototypeOf(f,a.prototype),f}function a(y,f,l){if(typeof y=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return u(y)}return c(y,f,l)}a.poolSize=8192;function c(y,f,l){if(typeof y=="string")return d(y,f);if(ArrayBuffer.isView(y))return v(y);if(y==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(y));if(We(y,ArrayBuffer)||y&&We(y.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(We(y,SharedArrayBuffer)||y&&We(y.buffer,SharedArrayBuffer)))return b(y,f,l);if(typeof y=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var g=y.valueOf&&y.valueOf();if(g!=null&&g!==y)return a.from(g,f,l);var w=I(y);if(w)return w;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof y[Symbol.toPrimitive]=="function")return a.from(y[Symbol.toPrimitive]("string"),f,l);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(y))}a.from=function(y,f,l){return c(y,f,l)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function h(y){if(typeof y!="number")throw new TypeError('"size" argument must be of type number');if(y<0)throw new RangeError('The value "'+y+'" is invalid for option "size"')}function s(y,f,l){return h(y),y<=0?i(y):f!==void 0?typeof l=="string"?i(y).fill(f,l):i(y).fill(f):i(y)}a.alloc=function(y,f,l){return s(y,f,l)};function u(y){return h(y),i(y<0?0:E(y)|0)}a.allocUnsafe=function(y){return u(y)},a.allocUnsafeSlow=function(y){return u(y)};function d(y,f){if((typeof f!="string"||f==="")&&(f="utf8"),!a.isEncoding(f))throw new TypeError("Unknown encoding: "+f);var l=_(y,f)|0,g=i(l),w=g.write(y,f);return w!==l&&(g=g.slice(0,w)),g}function m(y){for(var f=y.length<0?0:E(y.length)|0,l=i(f),g=0;g<f;g+=1)l[g]=y[g]&255;return l}function v(y){if(We(y,Uint8Array)){var f=new Uint8Array(y);return b(f.buffer,f.byteOffset,f.byteLength)}return m(y)}function b(y,f,l){if(f<0||y.byteLength<f)throw new RangeError('"offset" is outside of buffer bounds');if(y.byteLength<f+(l||0))throw new RangeError('"length" is outside of buffer bounds');var g;return f===void 0&&l===void 0?g=new Uint8Array(y):l===void 0?g=new Uint8Array(y,f):g=new Uint8Array(y,f,l),Object.setPrototypeOf(g,a.prototype),g}function I(y){if(a.isBuffer(y)){var f=E(y.length)|0,l=i(f);return l.length===0||y.copy(l,0,0,f),l}if(y.length!==void 0)return typeof y.length!="number"||wr(y.length)?i(0):m(y);if(y.type==="Buffer"&&Array.isArray(y.data))return m(y.data)}function E(y){if(y>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return y|0}function A(y){return+y!=y&&(y=0),a.alloc(+y)}a.isBuffer=function(f){return f!=null&&f._isBuffer===!0&&f!==a.prototype},a.compare=function(f,l){if(We(f,Uint8Array)&&(f=a.from(f,f.offset,f.byteLength)),We(l,Uint8Array)&&(l=a.from(l,l.offset,l.byteLength)),!a.isBuffer(f)||!a.isBuffer(l))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(f===l)return 0;for(var g=f.length,w=l.length,N=0,R=Math.min(g,w);N<R;++N)if(f[N]!==l[N]){g=f[N],w=l[N];break}return g<w?-1:w<g?1:0},a.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(f,l){if(!Array.isArray(f))throw new TypeError('"list" argument must be an Array of Buffers');if(f.length===0)return a.alloc(0);var g;if(l===void 0)for(l=0,g=0;g<f.length;++g)l+=f[g].length;var w=a.allocUnsafe(l),N=0;for(g=0;g<f.length;++g){var R=f[g];if(We(R,Uint8Array))N+R.length>w.length?a.from(R).copy(w,N):Uint8Array.prototype.set.call(w,R,N);else if(a.isBuffer(R))R.copy(w,N);else throw new TypeError('"list" argument must be an Array of Buffers');N+=R.length}return w};function _(y,f){if(a.isBuffer(y))return y.length;if(ArrayBuffer.isView(y)||We(y,ArrayBuffer))return y.byteLength;if(typeof y!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers.typeof(y));var l=y.length,g=arguments.length>2&&arguments[2]===!0;if(!g&&l===0)return 0;for(var w=!1;;)switch(f){case"ascii":case"latin1":case"binary":return l;case"utf8":case"utf-8":return _r(y).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l*2;case"hex":return l>>>1;case"base64":return en(y).length;default:if(w)return g?-1:_r(y).length;f=(""+f).toLowerCase(),w=!0}}a.byteLength=_;function O(y,f,l){var g=!1;if((f===void 0||f<0)&&(f=0),f>this.length||((l===void 0||l>this.length)&&(l=this.length),l<=0)||(l>>>=0,f>>>=0,l<=f))return"";for(y||(y="utf8");;)switch(y){case"hex":return Ie(this,f,l);case"utf8":case"utf-8":return G(this,f,l);case"ascii":return rt(this,f,l);case"latin1":case"binary":return ne(this,f,l);case"base64":return te(this,f,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,f,l);default:if(g)throw new TypeError("Unknown encoding: "+y);y=(y+"").toLowerCase(),g=!0}}a.prototype._isBuffer=!0;function T(y,f,l){var g=y[f];y[f]=y[l],y[l]=g}a.prototype.swap16=function(){var f=this.length;if(f%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var l=0;l<f;l+=2)T(this,l,l+1);return this},a.prototype.swap32=function(){var f=this.length;if(f%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var l=0;l<f;l+=4)T(this,l,l+3),T(this,l+1,l+2);return this},a.prototype.swap64=function(){var f=this.length;if(f%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var l=0;l<f;l+=8)T(this,l,l+7),T(this,l+1,l+6),T(this,l+2,l+5),T(this,l+3,l+4);return this},a.prototype.toString=function(){var f=this.length;return f===0?"":arguments.length===0?G(this,0,f):O.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(f){if(!a.isBuffer(f))throw new TypeError("Argument must be a Buffer");return this===f?!0:a.compare(this,f)===0},a.prototype.inspect=function(){var f="",l=e.INSPECT_MAX_BYTES;return f=this.toString("hex",0,l).replace(/(.{2})/g,"$1 ").trim(),this.length>l&&(f+=" ... "),"<Buffer "+f+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(f,l,g,w,N){if(We(f,Uint8Array)&&(f=a.from(f,f.offset,f.byteLength)),!a.isBuffer(f))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers.typeof(f));if(l===void 0&&(l=0),g===void 0&&(g=f?f.length:0),w===void 0&&(w=0),N===void 0&&(N=this.length),l<0||g>f.length||w<0||N>this.length)throw new RangeError("out of range index");if(w>=N&&l>=g)return 0;if(w>=N)return-1;if(l>=g)return 1;if(l>>>=0,g>>>=0,w>>>=0,N>>>=0,this===f)return 0;for(var R=N-w,V=g-l,Q=Math.min(R,V),X=this.slice(w,N),he=f.slice(l,g),ae=0;ae<Q;++ae)if(X[ae]!==he[ae]){R=X[ae],V=he[ae];break}return R<V?-1:V<R?1:0};function B(y,f,l,g,w){if(y.length===0)return-1;if(typeof l=="string"?(g=l,l=0):l>2147483647?l=2147483647:l<-2147483648&&(l=-2147483648),l=+l,wr(l)&&(l=w?0:y.length-1),l<0&&(l=y.length+l),l>=y.length){if(w)return-1;l=y.length-1}else if(l<0)if(w)l=0;else return-1;if(typeof f=="string"&&(f=a.from(f,g)),a.isBuffer(f))return f.length===0?-1:P(y,f,l,g,w);if(typeof f=="number")return f=f&255,typeof Uint8Array.prototype.indexOf=="function"?w?Uint8Array.prototype.indexOf.call(y,f,l):Uint8Array.prototype.lastIndexOf.call(y,f,l):P(y,[f],l,g,w);throw new TypeError("val must be string, number or Buffer")}function P(y,f,l,g,w){var N=1,R=y.length,V=f.length;if(g!==void 0&&(g=String(g).toLowerCase(),g==="ucs2"||g==="ucs-2"||g==="utf16le"||g==="utf-16le")){if(y.length<2||f.length<2)return-1;N=2,R/=2,V/=2,l/=2}function Q(Er,br){return N===1?Er[br]:Er.readUInt16BE(br*N)}var X;if(w){var he=-1;for(X=l;X<R;X++)if(Q(y,X)===Q(f,he===-1?0:X-he)){if(he===-1&&(he=X),X-he+1===V)return he*N}else he!==-1&&(X-=X-he),he=-1}else for(l+V>R&&(l=R-V),X=l;X>=0;X--){for(var ae=!0,Rt=0;Rt<V;Rt++)if(Q(y,X+Rt)!==Q(f,Rt)){ae=!1;break}if(ae)return X}return-1}a.prototype.includes=function(f,l,g){return this.indexOf(f,l,g)!==-1},a.prototype.indexOf=function(f,l,g){return B(this,f,l,g,!0)},a.prototype.lastIndexOf=function(f,l,g){return B(this,f,l,g,!1)};function F(y,f,l,g){l=Number(l)||0;var w=y.length-l;g?(g=Number(g),g>w&&(g=w)):g=w;var N=f.length;g>N/2&&(g=N/2);for(var R=0;R<g;++R){var V=parseInt(f.substr(R*2,2),16);if(wr(V))return R;y[l+R]=V}return R}function q(y,f,l,g){return Nt(_r(f,y.length-l),y,l,g)}function H(y,f,l,g){return Nt(ui(f),y,l,g)}function oe(y,f,l,g){return Nt(en(f),y,l,g)}function $(y,f,l,g){return Nt(ci(f,y.length-l),y,l,g)}a.prototype.write=function(f,l,g,w){if(l===void 0)w="utf8",g=this.length,l=0;else if(g===void 0&&typeof l=="string")w=l,g=this.length,l=0;else if(isFinite(l))l=l>>>0,isFinite(g)?(g=g>>>0,w===void 0&&(w="utf8")):(w=g,g=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var N=this.length-l;if((g===void 0||g>N)&&(g=N),f.length>0&&(g<0||l<0)||l>this.length)throw new RangeError("Attempt to write outside buffer bounds");w||(w="utf8");for(var R=!1;;)switch(w){case"hex":return F(this,f,l,g);case"utf8":case"utf-8":return q(this,f,l,g);case"ascii":case"latin1":case"binary":return H(this,f,l,g);case"base64":return oe(this,f,l,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,f,l,g);default:if(R)throw new TypeError("Unknown encoding: "+w);w=(""+w).toLowerCase(),R=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function te(y,f,l){return f===0&&l===y.length?Vi.fromByteArray(y):Vi.fromByteArray(y.slice(f,l))}function G(y,f,l){l=Math.min(y.length,l);for(var g=[],w=f;w<l;){var N=y[w],R=null,V=N>239?4:N>223?3:N>191?2:1;if(w+V<=l){var Q,X,he,ae;switch(V){case 1:N<128&&(R=N);break;case 2:Q=y[w+1],(Q&192)===128&&(ae=(N&31)<<6|Q&63,ae>127&&(R=ae));break;case 3:Q=y[w+1],X=y[w+2],(Q&192)===128&&(X&192)===128&&(ae=(N&15)<<12|(Q&63)<<6|X&63,ae>2047&&(ae<55296||ae>57343)&&(R=ae));break;case 4:Q=y[w+1],X=y[w+2],he=y[w+3],(Q&192)===128&&(X&192)===128&&(he&192)===128&&(ae=(N&15)<<18|(Q&63)<<12|(X&63)<<6|he&63,ae>65535&&ae<1114112&&(R=ae))}}R===null?(R=65533,V=1):R>65535&&(R-=65536,g.push(R>>>10&1023|55296),R=56320|R&1023),g.push(R),w+=V}return Ae(g)}var Ee=4096;function Ae(y){var f=y.length;if(f<=Ee)return String.fromCharCode.apply(String,y);for(var l="",g=0;g<f;)l+=String.fromCharCode.apply(String,y.slice(g,g+=Ee));return l}function rt(y,f,l){var g="";l=Math.min(y.length,l);for(var w=f;w<l;++w)g+=String.fromCharCode(y[w]&127);return g}function ne(y,f,l){var g="";l=Math.min(y.length,l);for(var w=f;w<l;++w)g+=String.fromCharCode(y[w]);return g}function Ie(y,f,l){var g=y.length;(!f||f<0)&&(f=0),(!l||l<0||l>g)&&(l=g);for(var w="",N=f;N<l;++N)w+=tn[y[N]];return w}function Y(y,f,l){for(var g=y.slice(f,l),w="",N=0;N<g.length-1;N+=2)w+=String.fromCharCode(g[N]+g[N+1]*256);return w}a.prototype.slice=function(f,l){var g=this.length;f=~~f,l=l===void 0?g:~~l,f<0?(f+=g,f<0&&(f=0)):f>g&&(f=g),l<0?(l+=g,l<0&&(l=0)):l>g&&(l=g),l<f&&(l=f);var w=this.subarray(f,l);return Object.setPrototypeOf(w,a.prototype),w};function L(y,f,l){if(y%1!==0||y<0)throw new RangeError("offset is not uint");if(y+f>l)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(f,l,g){f=f>>>0,l=l>>>0,g||L(f,l,this.length);for(var w=this[f],N=1,R=0;++R<l&&(N*=256);)w+=this[f+R]*N;return w},a.prototype.readUintBE=a.prototype.readUIntBE=function(f,l,g){f=f>>>0,l=l>>>0,g||L(f,l,this.length);for(var w=this[f+--l],N=1;l>0&&(N*=256);)w+=this[f+--l]*N;return w},a.prototype.readUint8=a.prototype.readUInt8=function(f,l){return f=f>>>0,l||L(f,1,this.length),this[f]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(f,l){return f=f>>>0,l||L(f,2,this.length),this[f]|this[f+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(f,l){return f=f>>>0,l||L(f,2,this.length),this[f]<<8|this[f+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(f,l){return f=f>>>0,l||L(f,4,this.length),(this[f]|this[f+1]<<8|this[f+2]<<16)+this[f+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(f,l){return f=f>>>0,l||L(f,4,this.length),this[f]*16777216+(this[f+1]<<16|this[f+2]<<8|this[f+3])},a.prototype.readIntLE=function(f,l,g){f=f>>>0,l=l>>>0,g||L(f,l,this.length);for(var w=this[f],N=1,R=0;++R<l&&(N*=256);)w+=this[f+R]*N;return N*=128,w>=N&&(w-=Math.pow(2,8*l)),w},a.prototype.readIntBE=function(f,l,g){f=f>>>0,l=l>>>0,g||L(f,l,this.length);for(var w=l,N=1,R=this[f+--w];w>0&&(N*=256);)R+=this[f+--w]*N;return N*=128,R>=N&&(R-=Math.pow(2,8*l)),R},a.prototype.readInt8=function(f,l){return f=f>>>0,l||L(f,1,this.length),this[f]&128?(255-this[f]+1)*-1:this[f]},a.prototype.readInt16LE=function(f,l){f=f>>>0,l||L(f,2,this.length);var g=this[f]|this[f+1]<<8;return g&32768?g|4294901760:g},a.prototype.readInt16BE=function(f,l){f=f>>>0,l||L(f,2,this.length);var g=this[f+1]|this[f]<<8;return g&32768?g|4294901760:g},a.prototype.readInt32LE=function(f,l){return f=f>>>0,l||L(f,4,this.length),this[f]|this[f+1]<<8|this[f+2]<<16|this[f+3]<<24},a.prototype.readInt32BE=function(f,l){return f=f>>>0,l||L(f,4,this.length),this[f]<<24|this[f+1]<<16|this[f+2]<<8|this[f+3]},a.prototype.readFloatLE=function(f,l){return f=f>>>0,l||L(f,4,this.length),nr.read(this,f,!0,23,4)},a.prototype.readFloatBE=function(f,l){return f=f>>>0,l||L(f,4,this.length),nr.read(this,f,!1,23,4)},a.prototype.readDoubleLE=function(f,l){return f=f>>>0,l||L(f,8,this.length),nr.read(this,f,!0,52,8)},a.prototype.readDoubleBE=function(f,l){return f=f>>>0,l||L(f,8,this.length),nr.read(this,f,!1,52,8)};function Se(y,f,l,g,w,N){if(!a.isBuffer(y))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>w||f<N)throw new RangeError('"value" argument is out of bounds');if(l+g>y.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(f,l,g,w){if(f=+f,l=l>>>0,g=g>>>0,!w){var N=Math.pow(2,8*g)-1;Se(this,f,l,g,N,0)}var R=1,V=0;for(this[l]=f&255;++V<g&&(R*=256);)this[l+V]=f/R&255;return l+g},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(f,l,g,w){if(f=+f,l=l>>>0,g=g>>>0,!w){var N=Math.pow(2,8*g)-1;Se(this,f,l,g,N,0)}var R=g-1,V=1;for(this[l+R]=f&255;--R>=0&&(V*=256);)this[l+R]=f/V&255;return l+g},a.prototype.writeUint8=a.prototype.writeUInt8=function(f,l,g){return f=+f,l=l>>>0,g||Se(this,f,l,1,255,0),this[l]=f&255,l+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(f,l,g){return f=+f,l=l>>>0,g||Se(this,f,l,2,65535,0),this[l]=f&255,this[l+1]=f>>>8,l+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(f,l,g){return f=+f,l=l>>>0,g||Se(this,f,l,2,65535,0),this[l]=f>>>8,this[l+1]=f&255,l+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(f,l,g){return f=+f,l=l>>>0,g||Se(this,f,l,4,4294967295,0),this[l+3]=f>>>24,this[l+2]=f>>>16,this[l+1]=f>>>8,this[l]=f&255,l+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(f,l,g){return f=+f,l=l>>>0,g||Se(this,f,l,4,4294967295,0),this[l]=f>>>24,this[l+1]=f>>>16,this[l+2]=f>>>8,this[l+3]=f&255,l+4},a.prototype.writeIntLE=function(f,l,g,w){if(f=+f,l=l>>>0,!w){var N=Math.pow(2,8*g-1);Se(this,f,l,g,N-1,-N)}var R=0,V=1,Q=0;for(this[l]=f&255;++R<g&&(V*=256);)f<0&&Q===0&&this[l+R-1]!==0&&(Q=1),this[l+R]=(f/V>>0)-Q&255;return l+g},a.prototype.writeIntBE=function(f,l,g,w){if(f=+f,l=l>>>0,!w){var N=Math.pow(2,8*g-1);Se(this,f,l,g,N-1,-N)}var R=g-1,V=1,Q=0;for(this[l+R]=f&255;--R>=0&&(V*=256);)f<0&&Q===0&&this[l+R+1]!==0&&(Q=1),this[l+R]=(f/V>>0)-Q&255;return l+g},a.prototype.writeInt8=function(f,l,g){return f=+f,l=l>>>0,g||Se(this,f,l,1,127,-128),f<0&&(f=255+f+1),this[l]=f&255,l+1},a.prototype.writeInt16LE=function(f,l,g){return f=+f,l=l>>>0,g||Se(this,f,l,2,32767,-32768),this[l]=f&255,this[l+1]=f>>>8,l+2},a.prototype.writeInt16BE=function(f,l,g){return f=+f,l=l>>>0,g||Se(this,f,l,2,32767,-32768),this[l]=f>>>8,this[l+1]=f&255,l+2},a.prototype.writeInt32LE=function(f,l,g){return f=+f,l=l>>>0,g||Se(this,f,l,4,2147483647,-2147483648),this[l]=f&255,this[l+1]=f>>>8,this[l+2]=f>>>16,this[l+3]=f>>>24,l+4},a.prototype.writeInt32BE=function(f,l,g){return f=+f,l=l>>>0,g||Se(this,f,l,4,2147483647,-2147483648),f<0&&(f=4294967295+f+1),this[l]=f>>>24,this[l+1]=f>>>16,this[l+2]=f>>>8,this[l+3]=f&255,l+4};function Qr(y,f,l,g,w,N){if(l+g>y.length)throw new RangeError("Index out of range");if(l<0)throw new RangeError("Index out of range")}function je(y,f,l,g,w){return f=+f,l=l>>>0,w||Qr(y,f,l,4),nr.write(y,f,l,g,23,4),l+4}a.prototype.writeFloatLE=function(f,l,g){return je(this,f,l,!0,g)},a.prototype.writeFloatBE=function(f,l,g){return je(this,f,l,!1,g)};function vr(y,f,l,g,w){return f=+f,l=l>>>0,w||Qr(y,f,l,8),nr.write(y,f,l,g,52,8),l+8}a.prototype.writeDoubleLE=function(f,l,g){return vr(this,f,l,!0,g)},a.prototype.writeDoubleBE=function(f,l,g){return vr(this,f,l,!1,g)},a.prototype.copy=function(f,l,g,w){if(!a.isBuffer(f))throw new TypeError("argument should be a Buffer");if(g||(g=0),!w&&w!==0&&(w=this.length),l>=f.length&&(l=f.length),l||(l=0),w>0&&w<g&&(w=g),w===g||f.length===0||this.length===0)return 0;if(l<0)throw new RangeError("targetStart out of bounds");if(g<0||g>=this.length)throw new RangeError("Index out of range");if(w<0)throw new RangeError("sourceEnd out of bounds");w>this.length&&(w=this.length),f.length-l<w-g&&(w=f.length-l+g);var N=w-g;return this===f&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(l,g,w):Uint8Array.prototype.set.call(f,this.subarray(g,w),l),N},a.prototype.fill=function(f,l,g,w){if(typeof f=="string"){if(typeof l=="string"?(w=l,l=0,g=this.length):typeof g=="string"&&(w=g,g=this.length),w!==void 0&&typeof w!="string")throw new TypeError("encoding must be a string");if(typeof w=="string"&&!a.isEncoding(w))throw new TypeError("Unknown encoding: "+w);if(f.length===1){var N=f.charCodeAt(0);(w==="utf8"&&N<128||w==="latin1")&&(f=N)}}else typeof f=="number"?f=f&255:typeof f=="boolean"&&(f=Number(f));if(l<0||this.length<l||this.length<g)throw new RangeError("Out of range index");if(g<=l)return this;l=l>>>0,g=g===void 0?this.length:g>>>0,f||(f=0);var R;if(typeof f=="number")for(R=l;R<g;++R)this[R]=f;else{var V=a.isBuffer(f)?f:a.from(f,w),Q=V.length;if(Q===0)throw new TypeError('The value "'+f+'" is invalid for argument "value"');for(R=0;R<g-l;++R)this[R+l]=V[R%Q]}return this};var Zr=/[^+/0-9A-Za-z-_]/g;function ai(y){if(y=y.split("=")[0],y=y.trim().replace(Zr,""),y.length<2)return"";for(;y.length%4!==0;)y=y+"=";return y}function _r(y,f){f=f||1/0;for(var l,g=y.length,w=null,N=[],R=0;R<g;++R){if(l=y.charCodeAt(R),l>55295&&l<57344){if(!w){if(l>56319){(f-=3)>-1&&N.push(239,191,189);continue}else if(R+1===g){(f-=3)>-1&&N.push(239,191,189);continue}w=l;continue}if(l<56320){(f-=3)>-1&&N.push(239,191,189),w=l;continue}l=(w-55296<<10|l-56320)+65536}else w&&(f-=3)>-1&&N.push(239,191,189);if(w=null,l<128){if((f-=1)<0)break;N.push(l)}else if(l<2048){if((f-=2)<0)break;N.push(l>>6|192,l&63|128)}else if(l<65536){if((f-=3)<0)break;N.push(l>>12|224,l>>6&63|128,l&63|128)}else if(l<1114112){if((f-=4)<0)break;N.push(l>>18|240,l>>12&63|128,l>>6&63|128,l&63|128)}else throw new Error("Invalid code point")}return N}function ui(y){for(var f=[],l=0;l<y.length;++l)f.push(y.charCodeAt(l)&255);return f}function ci(y,f){for(var l,g,w,N=[],R=0;R<y.length&&!((f-=2)<0);++R)l=y.charCodeAt(R),g=l>>8,w=l%256,N.push(w),N.push(g);return N}function en(y){return Vi.toByteArray(ai(y))}function Nt(y,f,l,g){for(var w=0;w<g&&!(w+l>=f.length||w>=y.length);++w)f[w+l]=y[w];return w}function We(y,f){return y instanceof f||y!=null&&y.constructor!=null&&y.constructor.name!=null&&y.constructor.name===f.name}function wr(y){return y!==y}var tn=function(){for(var y="0123456789abcdef",f=new Array(256),l=0;l<16;++l)for(var g=l*16,w=0;w<16;++w)f[g+w]=y[l]+y[w];return f}()}),z=Jn.Buffer;Jn.SlowBuffer;Jn.INSPECT_MAX_BYTES;Jn.kMaxLength;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var yo=function(e,r){return yo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},yo(e,r)};function Yn(t,e){yo(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Wt=function(t){Yn(e,t);function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return Object.defineProperty(e.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),e}(Error),ce=function(t){Yn(e,t);function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return Object.defineProperty(e.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),e}(TypeError);function _n(t){return t&&t.Math==Math&&t}function Xa(){return _n(typeof globalThis=="object"&&globalThis)||_n(typeof window=="object"&&window)||_n(typeof self=="object"&&self)||_n(typeof global=="object"&&global)||Function("return this")()}function yp(){var t=Xa();return typeof t.navigator=="object"&&t.navigator.product==="ReactNative"}var gp=function(e){var r=yp()?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";console.warn(r);for(var n=z.alloc(e),o=0;o<e;++o)n[o]=Math.floor(Math.random()*256);return n},mp=function(){{if(typeof window<"u"){var t=window.crypto||window.msCrypto;if(t&&t.getRandomValues)return function(e){return t.getRandomValues(z.alloc(e))}}return typeof global<"u"&&global.crypto&&global.crypto.getRandomValues?function(e){return global.crypto.getRandomValues(z.alloc(e))}:gp}},za=mp();function vp(t){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(t))}function To(t){return Object.prototype.toString.call(t)==="[object Uint8Array]"}function _p(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function wp(t){return zr(t)&&Object.prototype.toString.call(t)==="[object Date]"}function zr(t){return typeof t=="object"&&t!==null}function Xn(t,e){var r=!1;function n(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return r||(console.warn(e),r=!0),t.apply(this,o)}return n}function Un(t){if(ArrayBuffer.isView(t))return z.from(t.buffer,t.byteOffset,t.byteLength);if(vp(t))return z.from(t);throw new ce("Must use either Buffer or TypedArray")}var Ep=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,Qa=function(t){return typeof t=="string"&&Ep.test(t)},go=function(t){if(!Qa(t))throw new ce('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var e=t.replace(/-/g,"");return z.from(e,"hex")},Bs=function(t,e){return e===void 0&&(e=!0),e?t.toString("hex",0,4)+"-"+t.toString("hex",4,6)+"-"+t.toString("hex",6,8)+"-"+t.toString("hex",8,10)+"-"+t.toString("hex",10,16):t.toString("hex")},bp=Math.pow(2,53),Sp=-Math.pow(2,53),Za=4,qt=function(){function t(e,r){if(!(this instanceof t))return new t(e,r);if(e!=null&&typeof e!="string"&&!ArrayBuffer.isView(e)&&!(e instanceof ArrayBuffer)&&!Array.isArray(e))throw new ce("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=r??t.BSON_BINARY_SUBTYPE_DEFAULT,e==null?(this.buffer=z.alloc(t.BUFFER_SIZE),this.position=0):(typeof e=="string"?this.buffer=z.from(e,"binary"):Array.isArray(e)?this.buffer=z.from(e):this.buffer=Un(e),this.position=this.buffer.byteLength)}return t.prototype.put=function(e){if(typeof e=="string"&&e.length!==1)throw new ce("only accepts single character String");if(typeof e!="number"&&e.length!==1)throw new ce("only accepts single character Uint8Array or Array");var r;if(typeof e=="string"?r=e.charCodeAt(0):typeof e=="number"?r=e:r=e[0],r<0||r>255)throw new ce("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=r;else{var n=z.alloc(t.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=r}},t.prototype.write=function(e,r){if(r=typeof r=="number"?r:this.position,this.buffer.length<r+e.length){var n=z.alloc(this.buffer.length+e.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n}ArrayBuffer.isView(e)?(this.buffer.set(Un(e),r),this.position=r+e.byteLength>this.position?r+e.length:this.position):typeof e=="string"&&(this.buffer.write(e,r,e.length,"binary"),this.position=r+e.length>this.position?r+e.length:this.position)},t.prototype.read=function(e,r){return r=r&&r>0?r:this.position,this.buffer.slice(e,e+r)},t.prototype.value=function(e){return e=!!e,e&&this.buffer.length===this.position?this.buffer:e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},t.prototype.length=function(){return this.position},t.prototype.toJSON=function(){return this.buffer.toString("base64")},t.prototype.toString=function(e){return this.buffer.toString(e)},t.prototype.toExtendedJSON=function(e){e=e||{};var r=this.buffer.toString("base64"),n=Number(this.sub_type).toString(16);return e.legacy?{$binary:r,$type:n.length===1?"0"+n:n}:{$binary:{base64:r,subType:n.length===1?"0"+n:n}}},t.prototype.toUUID=function(){if(this.sub_type===t.SUBTYPE_UUID)return new Ds(this.buffer.slice(0,this.position));throw new Wt('Binary sub_type "'.concat(this.sub_type,'" is not supported for converting to UUID. Only "').concat(t.SUBTYPE_UUID,'" is currently supported.'))},t.fromExtendedJSON=function(e,r){r=r||{};var n,o;if("$binary"in e?r.legacy&&typeof e.$binary=="string"&&"$type"in e?(o=e.$type?parseInt(e.$type,16):0,n=z.from(e.$binary,"base64")):typeof e.$binary!="string"&&(o=e.$binary.subType?parseInt(e.$binary.subType,16):0,n=z.from(e.$binary.base64,"base64")):"$uuid"in e&&(o=4,n=go(e.$uuid)),!n)throw new ce("Unexpected Binary Extended JSON format ".concat(JSON.stringify(e)));return o===Za?new Ds(n):new t(n,o)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.value(!0);return'new Binary(Buffer.from("'.concat(e.toString("hex"),'", "hex"), ').concat(this.sub_type,")")},t.BSON_BINARY_SUBTYPE_DEFAULT=0,t.BUFFER_SIZE=256,t.SUBTYPE_DEFAULT=0,t.SUBTYPE_FUNCTION=1,t.SUBTYPE_BYTE_ARRAY=2,t.SUBTYPE_UUID_OLD=3,t.SUBTYPE_UUID=4,t.SUBTYPE_MD5=5,t.SUBTYPE_ENCRYPTED=6,t.SUBTYPE_COLUMN=7,t.SUBTYPE_USER_DEFINED=128,t}();Object.defineProperty(qt.prototype,"_bsontype",{value:"Binary"});var Ji=16,Ds=function(t){Yn(e,t);function e(r){var n=this,o,i;if(r==null)o=e.generate();else if(r instanceof e)o=z.from(r.buffer),i=r.__id;else if(ArrayBuffer.isView(r)&&r.byteLength===Ji)o=Un(r);else if(typeof r=="string")o=go(r);else throw new ce("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");return n=t.call(this,o,Za)||this,n.__id=i,n}return Object.defineProperty(e.prototype,"id",{get:function(){return this.buffer},set:function(r){this.buffer=r,e.cacheHexString&&(this.__id=Bs(r))},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(r){if(r===void 0&&(r=!0),e.cacheHexString&&this.__id)return this.__id;var n=Bs(this.id,r);return e.cacheHexString&&(this.__id=n),n},e.prototype.toString=function(r){return r?this.id.toString(r):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(r){if(!r)return!1;if(r instanceof e)return r.id.equals(this.id);try{return new e(r).id.equals(this.id)}catch{return!1}},e.prototype.toBinary=function(){return new qt(this.id,qt.SUBTYPE_UUID)},e.generate=function(){var r=za(Ji);return r[6]=r[6]&15|64,r[8]=r[8]&63|128,z.from(r)},e.isValid=function(r){return r?r instanceof e?!0:typeof r=="string"?Qa(r):To(r)?r.length!==Ji?!1:(r[6]&240)===64&&(r[8]&128)===128:!1:!1},e.createFromHexString=function(r){var n=go(r);return new e(n)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new UUID("'.concat(this.toHexString(),'")')},e}(qt),zn=function(){function t(e,r){if(!(this instanceof t))return new t(e,r);this.code=e,this.scope=r}return t.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},t.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},t.fromExtendedJSON=function(e){return new t(e.$code,e.$scope)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.toJSON();return'new Code("'.concat(String(e.code),'"').concat(e.scope?", ".concat(JSON.stringify(e.scope)):"",")")},t}();Object.defineProperty(zn.prototype,"_bsontype",{value:"Code"});function Ap(t){return zr(t)&&t.$id!=null&&typeof t.$ref=="string"&&(t.$db==null||typeof t.$db=="string")}var Kr=function(){function t(e,r,n,o){if(!(this instanceof t))return new t(e,r,n,o);var i=e.split(".");i.length===2&&(n=i.shift(),e=i.shift()),this.collection=e,this.oid=r,this.db=n,this.fields=o||{}}return Object.defineProperty(t.prototype,"namespace",{get:function(){return this.collection},set:function(e){this.collection=e},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){var e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return this.db!=null&&(e.$db=this.db),e},t.prototype.toExtendedJSON=function(e){e=e||{};var r={$ref:this.collection,$id:this.oid};return e.legacy||(this.db&&(r.$db=this.db),r=Object.assign(r,this.fields)),r},t.fromExtendedJSON=function(e){var r=Object.assign({},e);return delete r.$ref,delete r.$id,delete r.$db,new t(e.$ref,e.$id,e.$db,r)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.oid===void 0||this.oid.toString===void 0?this.oid:this.oid.toString();return'new DBRef("'.concat(this.namespace,'", new ObjectId("').concat(String(e),'")').concat(this.db?', "'.concat(this.db,'"'):"",")")},t}();Object.defineProperty(Kr.prototype,"_bsontype",{value:"DBRef"});var qe=void 0;try{qe=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var Ls=65536,Ip=1<<24,ar=Ls*Ls,eu=ar*ar,Fs=eu/2,Us={},ks={},k=function(){function t(e,r,n){if(e===void 0&&(e=0),!(this instanceof t))return new t(e,r,n);typeof e=="bigint"?Object.assign(this,t.fromBigInt(e,!!r)):typeof e=="string"?Object.assign(this,t.fromString(e,!!r)):(this.low=e|0,this.high=r|0,this.unsigned=!!n),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return t.fromBits=function(e,r,n){return new t(e,r,n)},t.fromInt=function(e,r){var n,o,i;return r?(e>>>=0,(i=0<=e&&e<256)&&(o=ks[e],o)?o:(n=t.fromBits(e,(e|0)<0?-1:0,!0),i&&(ks[e]=n),n)):(e|=0,(i=-128<=e&&e<128)&&(o=Us[e],o)?o:(n=t.fromBits(e,e<0?-1:0,!1),i&&(Us[e]=n),n))},t.fromNumber=function(e,r){if(isNaN(e))return r?t.UZERO:t.ZERO;if(r){if(e<0)return t.UZERO;if(e>=eu)return t.MAX_UNSIGNED_VALUE}else{if(e<=-Fs)return t.MIN_VALUE;if(e+1>=Fs)return t.MAX_VALUE}return e<0?t.fromNumber(-e,r).neg():t.fromBits(e%ar|0,e/ar|0,r)},t.fromBigInt=function(e,r){return t.fromString(e.toString(),r)},t.fromString=function(e,r,n){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t.ZERO;if(typeof r=="number"?(n=r,r=!1):r=!!r,n=n||10,n<2||36<n)throw RangeError("radix");var o;if((o=e.indexOf("-"))>0)throw Error("interior hyphen");if(o===0)return t.fromString(e.substring(1),r,n).neg();for(var i=t.fromNumber(Math.pow(n,8)),a=t.ZERO,c=0;c<e.length;c+=8){var h=Math.min(8,e.length-c),s=parseInt(e.substring(c,c+h),n);if(h<8){var u=t.fromNumber(Math.pow(n,h));a=a.mul(u).add(t.fromNumber(s))}else a=a.mul(i),a=a.add(t.fromNumber(s))}return a.unsigned=r,a},t.fromBytes=function(e,r,n){return n?t.fromBytesLE(e,r):t.fromBytesBE(e,r)},t.fromBytesLE=function(e,r){return new t(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)},t.fromBytesBE=function(e,r){return new t(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)},t.isLong=function(e){return zr(e)&&e.__isLong__===!0},t.fromValue=function(e,r){return typeof e=="number"?t.fromNumber(e,r):typeof e=="string"?t.fromString(e,r):t.fromBits(e.low,e.high,typeof r=="boolean"?r:e.unsigned)},t.prototype.add=function(e){t.isLong(e)||(e=t.fromValue(e));var r=this.high>>>16,n=this.high&65535,o=this.low>>>16,i=this.low&65535,a=e.high>>>16,c=e.high&65535,h=e.low>>>16,s=e.low&65535,u=0,d=0,m=0,v=0;return v+=i+s,m+=v>>>16,v&=65535,m+=o+h,d+=m>>>16,m&=65535,d+=n+c,u+=d>>>16,d&=65535,u+=r+a,u&=65535,t.fromBits(m<<16|v,u<<16|d,this.unsigned)},t.prototype.and=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},t.prototype.compare=function(e){if(t.isLong(e)||(e=t.fromValue(e)),this.eq(e))return 0;var r=this.isNegative(),n=e.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},t.prototype.comp=function(e){return this.compare(e)},t.prototype.divide=function(e){if(t.isLong(e)||(e=t.fromValue(e)),e.isZero())throw Error("division by zero");if(qe){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var r=(this.unsigned?qe.div_u:qe.div_s)(this.low,this.high,e.low,e.high);return t.fromBits(r,qe.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?t.UZERO:t.ZERO;var n,o,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return t.UZERO;if(e.gt(this.shru(1)))return t.UONE;i=t.UZERO}else{if(this.eq(t.MIN_VALUE)){if(e.eq(t.ONE)||e.eq(t.NEG_ONE))return t.MIN_VALUE;if(e.eq(t.MIN_VALUE))return t.ONE;var a=this.shr(1);return n=a.div(e).shl(1),n.eq(t.ZERO)?e.isNegative()?t.ONE:t.NEG_ONE:(o=this.sub(e.mul(n)),i=n.add(o.div(e)),i)}else if(e.eq(t.MIN_VALUE))return this.unsigned?t.UZERO:t.ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=t.ZERO}for(o=this;o.gte(e);){n=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var c=Math.ceil(Math.log(n)/Math.LN2),h=c<=48?1:Math.pow(2,c-48),s=t.fromNumber(n),u=s.mul(e);u.isNegative()||u.gt(o);)n-=h,s=t.fromNumber(n,this.unsigned),u=s.mul(e);s.isZero()&&(s=t.ONE),i=i.add(s),o=o.sub(u)}return i},t.prototype.div=function(e){return this.divide(e)},t.prototype.equals=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},t.prototype.eq=function(e){return this.equals(e)},t.prototype.getHighBits=function(){return this.high},t.prototype.getHighBitsUnsigned=function(){return this.high>>>0},t.prototype.getLowBits=function(){return this.low},t.prototype.getLowBitsUnsigned=function(){return this.low>>>0},t.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(t.MIN_VALUE)?64:this.neg().getNumBitsAbs();var e=this.high!==0?this.high:this.low,r;for(r=31;r>0&&!(e&1<<r);r--);return this.high!==0?r+33:r+1},t.prototype.greaterThan=function(e){return this.comp(e)>0},t.prototype.gt=function(e){return this.greaterThan(e)},t.prototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},t.prototype.gte=function(e){return this.greaterThanOrEqual(e)},t.prototype.ge=function(e){return this.greaterThanOrEqual(e)},t.prototype.isEven=function(){return(this.low&1)===0},t.prototype.isNegative=function(){return!this.unsigned&&this.high<0},t.prototype.isOdd=function(){return(this.low&1)===1},t.prototype.isPositive=function(){return this.unsigned||this.high>=0},t.prototype.isZero=function(){return this.high===0&&this.low===0},t.prototype.lessThan=function(e){return this.comp(e)<0},t.prototype.lt=function(e){return this.lessThan(e)},t.prototype.lessThanOrEqual=function(e){return this.comp(e)<=0},t.prototype.lte=function(e){return this.lessThanOrEqual(e)},t.prototype.modulo=function(e){if(t.isLong(e)||(e=t.fromValue(e)),qe){var r=(this.unsigned?qe.rem_u:qe.rem_s)(this.low,this.high,e.low,e.high);return t.fromBits(r,qe.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},t.prototype.mod=function(e){return this.modulo(e)},t.prototype.rem=function(e){return this.modulo(e)},t.prototype.multiply=function(e){if(this.isZero())return t.ZERO;if(t.isLong(e)||(e=t.fromValue(e)),qe){var r=qe.mul(this.low,this.high,e.low,e.high);return t.fromBits(r,qe.get_high(),this.unsigned)}if(e.isZero())return t.ZERO;if(this.eq(t.MIN_VALUE))return e.isOdd()?t.MIN_VALUE:t.ZERO;if(e.eq(t.MIN_VALUE))return this.isOdd()?t.MIN_VALUE:t.ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(t.TWO_PWR_24)&&e.lt(t.TWO_PWR_24))return t.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,o=this.high&65535,i=this.low>>>16,a=this.low&65535,c=e.high>>>16,h=e.high&65535,s=e.low>>>16,u=e.low&65535,d=0,m=0,v=0,b=0;return b+=a*u,v+=b>>>16,b&=65535,v+=i*u,m+=v>>>16,v&=65535,v+=a*s,m+=v>>>16,v&=65535,m+=o*u,d+=m>>>16,m&=65535,m+=i*s,d+=m>>>16,m&=65535,m+=a*h,d+=m>>>16,m&=65535,d+=n*u+o*s+i*h+a*c,d&=65535,t.fromBits(v<<16|b,d<<16|m,this.unsigned)},t.prototype.mul=function(e){return this.multiply(e)},t.prototype.negate=function(){return!this.unsigned&&this.eq(t.MIN_VALUE)?t.MIN_VALUE:this.not().add(t.ONE)},t.prototype.neg=function(){return this.negate()},t.prototype.not=function(){return t.fromBits(~this.low,~this.high,this.unsigned)},t.prototype.notEquals=function(e){return!this.equals(e)},t.prototype.neq=function(e){return this.notEquals(e)},t.prototype.ne=function(e){return this.notEquals(e)},t.prototype.or=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},t.prototype.shiftLeft=function(e){return t.isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?t.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):t.fromBits(0,this.low<<e-32,this.unsigned)},t.prototype.shl=function(e){return this.shiftLeft(e)},t.prototype.shiftRight=function(e){return t.isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?t.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):t.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},t.prototype.shr=function(e){return this.shiftRight(e)},t.prototype.shiftRightUnsigned=function(e){if(t.isLong(e)&&(e=e.toInt()),e&=63,e===0)return this;var r=this.high;if(e<32){var n=this.low;return t.fromBits(n>>>e|r<<32-e,r>>>e,this.unsigned)}else return e===32?t.fromBits(r,0,this.unsigned):t.fromBits(r>>>e-32,0,this.unsigned)},t.prototype.shr_u=function(e){return this.shiftRightUnsigned(e)},t.prototype.shru=function(e){return this.shiftRightUnsigned(e)},t.prototype.subtract=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.add(e.neg())},t.prototype.sub=function(e){return this.subtract(e)},t.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},t.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*ar+(this.low>>>0):this.high*ar+(this.low>>>0)},t.prototype.toBigInt=function(){return BigInt(this.toString())},t.prototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},t.prototype.toBytesLE=function(){var e=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},t.prototype.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,r>>>24,r>>>16&255,r>>>8&255,r&255]},t.prototype.toSigned=function(){return this.unsigned?t.fromBits(this.low,this.high,!1):this},t.prototype.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(t.MIN_VALUE)){var r=t.fromNumber(e),n=this.div(r),o=n.mul(r).sub(this);return n.toString(e)+o.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=t.fromNumber(Math.pow(e,6),this.unsigned),a=this,c="";;){var h=a.div(i),s=a.sub(h.mul(i)).toInt()>>>0,u=s.toString(e);if(a=h,a.isZero())return u+c;for(;u.length<6;)u="0"+u;c=""+u+c}},t.prototype.toUnsigned=function(){return this.unsigned?this:t.fromBits(this.low,this.high,!0)},t.prototype.xor=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},t.prototype.eqz=function(){return this.isZero()},t.prototype.le=function(e){return this.lessThanOrEqual(e)},t.prototype.toExtendedJSON=function(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}},t.fromExtendedJSON=function(e,r){var n=t.fromString(e.$numberLong);return r&&r.relaxed?n.toNumber():n},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new Long("'.concat(this.toString(),'"').concat(this.unsigned?", true":"",")")},t.TWO_PWR_24=t.fromInt(Ip),t.MAX_UNSIGNED_VALUE=t.fromBits(-1,-1,!0),t.ZERO=t.fromInt(0),t.UZERO=t.fromInt(0,!0),t.ONE=t.fromInt(1),t.UONE=t.fromInt(1,!0),t.NEG_ONE=t.fromInt(-1),t.MAX_VALUE=t.fromBits(-1,2147483647,!1),t.MIN_VALUE=t.fromBits(0,-2147483648,!1),t}();Object.defineProperty(k.prototype,"__isLong__",{value:!0});Object.defineProperty(k.prototype,"_bsontype",{value:"Long"});var Tp=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,Op=/^(\+|-)?(Infinity|inf)$/i,xp=/^(\+|-)?NaN$/i,Lr=6111,Yi=-6176,Ms=6176,Np=34,Xi=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),$s=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),js=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Rp=/^([-+])?(\d+)?$/,Cp=31,Ws=16383,Pp=30,Bp=31;function qs(t){return!isNaN(parseInt(t,10))}function Dp(t){var e=k.fromNumber(1e9),r=k.fromNumber(0);if(!t.parts[0]&&!t.parts[1]&&!t.parts[2]&&!t.parts[3])return{quotient:t,rem:r};for(var n=0;n<=3;n++)r=r.shiftLeft(32),r=r.add(new k(t.parts[n],0)),t.parts[n]=r.div(e).low,r=r.modulo(e);return{quotient:t,rem:r}}function Lp(t,e){if(!t&&!e)return{high:k.fromNumber(0),low:k.fromNumber(0)};var r=t.shiftRightUnsigned(32),n=new k(t.getLowBits(),0),o=e.shiftRightUnsigned(32),i=new k(e.getLowBits(),0),a=r.multiply(o),c=r.multiply(i),h=n.multiply(o),s=n.multiply(i);return a=a.add(c.shiftRightUnsigned(32)),c=new k(c.getLowBits(),0).add(h).add(s.shiftRightUnsigned(32)),a=a.add(c.shiftRightUnsigned(32)),s=c.shiftLeft(32).add(new k(s.getLowBits(),0)),{high:a,low:s}}function Fp(t,e){var r=t.high>>>0,n=e.high>>>0;if(r<n)return!0;if(r===n){var o=t.low>>>0,i=e.low>>>0;if(o<i)return!0}return!1}function ir(t,e){throw new ce('"'.concat(t,'" is not a valid Decimal128 string - ').concat(e))}var Oo=function(){function t(e){if(!(this instanceof t))return new t(e);if(typeof e=="string")this.bytes=t.fromString(e).bytes;else if(To(e)){if(e.byteLength!==16)throw new ce("Decimal128 must take a Buffer of 16 bytes");this.bytes=e}else throw new ce("Decimal128 must take a Buffer or string")}return t.fromString=function(e){var r=!1,n=!1,o=!1,i=0,a=0,c=0,h=0,s=0,u=[0],d=0,m=0,v=0,b=0,I=0,E=0,A=new k(0,0),_=new k(0,0),O=0,T=0;if(e.length>=7e3)throw new ce(""+e+" not a valid Decimal128 string");var B=e.match(Tp),P=e.match(Op),F=e.match(xp);if(!B&&!P&&!F||e.length===0)throw new ce(""+e+" not a valid Decimal128 string");if(B){var q=B[2],H=B[4],oe=B[5],$=B[6];H&&$===void 0&&ir(e,"missing exponent power"),H&&q===void 0&&ir(e,"missing exponent base"),H===void 0&&(oe||$)&&ir(e,"missing e before exponent")}if((e[T]==="+"||e[T]==="-")&&(r=e[T++]==="-"),!qs(e[T])&&e[T]!=="."){if(e[T]==="i"||e[T]==="I")return new t(z.from(r?$s:js));if(e[T]==="N")return new t(z.from(Xi))}for(;qs(e[T])||e[T]===".";){if(e[T]==="."){n&&ir(e,"contains multiple periods"),n=!0,T=T+1;continue}d<34&&(e[T]!=="0"||o)&&(o||(s=a),o=!0,u[m++]=parseInt(e[T],10),d=d+1),o&&(c=c+1),n&&(h=h+1),a=a+1,T=T+1}if(n&&!a)throw new ce(""+e+" not a valid Decimal128 string");if(e[T]==="e"||e[T]==="E"){var te=e.substr(++T).match(Rp);if(!te||!te[2])return new t(z.from(Xi));I=parseInt(te[0],10),T=T+te[0].length}if(e[T])return new t(z.from(Xi));if(v=0,!d)v=0,b=0,u[0]=0,c=1,d=1,i=0;else if(b=d-1,i=c,i!==1)for(;u[s+i-1]===0;)i=i-1;for(I<=h&&h-I>16384?I=Yi:I=I-h;I>Lr;){if(b=b+1,b-v>Np){var G=u.join("");if(G.match(/^0+$/)){I=Lr;break}ir(e,"overflow")}I=I-1}for(;I<Yi||d<c;){if(b===0&&i<d){I=Yi,i=0;break}if(d<c?c=c-1:b=b-1,I<Lr)I=I+1;else{var G=u.join("");if(G.match(/^0+$/)){I=Lr;break}ir(e,"overflow")}}if(b-v+1<i){var Ee=a;n&&(s=s+1,Ee=Ee+1),r&&(s=s+1,Ee=Ee+1);var Ae=parseInt(e[s+b+1],10),rt=0;if(Ae>=5&&(rt=1,Ae===5)){for(rt=u[b]%2===1?1:0,E=s+b+2;E<Ee;E++)if(parseInt(e[E],10)){rt=1;break}}if(rt){for(var ne=b;ne>=0;ne--)if(++u[ne]>9&&(u[ne]=0,ne===0))if(I<Lr)I=I+1,u[ne]=1;else return new t(z.from(r?$s:js))}}if(A=k.fromNumber(0),_=k.fromNumber(0),i===0)A=k.fromNumber(0),_=k.fromNumber(0);else if(b-v<17){var ne=v;for(_=k.fromNumber(u[ne++]),A=new k(0,0);ne<=b;ne++)_=_.multiply(k.fromNumber(10)),_=_.add(k.fromNumber(u[ne]))}else{var ne=v;for(A=k.fromNumber(u[ne++]);ne<=b-17;ne++)A=A.multiply(k.fromNumber(10)),A=A.add(k.fromNumber(u[ne]));for(_=k.fromNumber(u[ne++]);ne<=b;ne++)_=_.multiply(k.fromNumber(10)),_=_.add(k.fromNumber(u[ne]))}var Ie=Lp(A,k.fromString("100000000000000000"));Ie.low=Ie.low.add(_),Fp(Ie.low,_)&&(Ie.high=Ie.high.add(k.fromNumber(1))),O=I+Ms;var Y={low:k.fromNumber(0),high:k.fromNumber(0)};Ie.high.shiftRightUnsigned(49).and(k.fromNumber(1)).equals(k.fromNumber(1))?(Y.high=Y.high.or(k.fromNumber(3).shiftLeft(61)),Y.high=Y.high.or(k.fromNumber(O).and(k.fromNumber(16383).shiftLeft(47))),Y.high=Y.high.or(Ie.high.and(k.fromNumber(0x7fffffffffff)))):(Y.high=Y.high.or(k.fromNumber(O&16383).shiftLeft(49)),Y.high=Y.high.or(Ie.high.and(k.fromNumber(562949953421311)))),Y.low=Ie.low,r&&(Y.high=Y.high.or(k.fromString("9223372036854775808")));var L=z.alloc(16);return T=0,L[T++]=Y.low.low&255,L[T++]=Y.low.low>>8&255,L[T++]=Y.low.low>>16&255,L[T++]=Y.low.low>>24&255,L[T++]=Y.low.high&255,L[T++]=Y.low.high>>8&255,L[T++]=Y.low.high>>16&255,L[T++]=Y.low.high>>24&255,L[T++]=Y.high.low&255,L[T++]=Y.high.low>>8&255,L[T++]=Y.high.low>>16&255,L[T++]=Y.high.low>>24&255,L[T++]=Y.high.high&255,L[T++]=Y.high.high>>8&255,L[T++]=Y.high.high>>16&255,L[T++]=Y.high.high>>24&255,new t(L)},t.prototype.toString=function(){for(var e,r=0,n=new Array(36),o=0;o<n.length;o++)n[o]=0;var i=0,a=!1,c,h={parts:[0,0,0,0]},s,u,d=[];i=0;var m=this.bytes,v=m[i++]|m[i++]<<8|m[i++]<<16|m[i++]<<24,b=m[i++]|m[i++]<<8|m[i++]<<16|m[i++]<<24,I=m[i++]|m[i++]<<8|m[i++]<<16|m[i++]<<24,E=m[i++]|m[i++]<<8|m[i++]<<16|m[i++]<<24;i=0;var A={low:new k(v,b),high:new k(I,E)};A.high.lessThan(k.ZERO)&&d.push("-");var _=E>>26&Cp;if(_>>3===3){if(_===Pp)return d.join("")+"Infinity";if(_===Bp)return"NaN";e=E>>15&Ws,c=8+(E>>14&1)}else c=E>>14&7,e=E>>17&Ws;var O=e-Ms;if(h.parts[0]=(E&16383)+((c&15)<<14),h.parts[1]=I,h.parts[2]=b,h.parts[3]=v,h.parts[0]===0&&h.parts[1]===0&&h.parts[2]===0&&h.parts[3]===0)a=!0;else for(u=3;u>=0;u--){var T=0,B=Dp(h);if(h=B.quotient,T=B.rem.low,!!T)for(s=8;s>=0;s--)n[u*9+s]=T%10,T=Math.floor(T/10)}if(a)r=1,n[i]=0;else for(r=36;!n[i];)r=r-1,i=i+1;var P=r-1+O;if(P>=34||P<=-7||O>0){if(r>34)return d.push("".concat(0)),O>0?d.push("E+".concat(O)):O<0&&d.push("E".concat(O)),d.join("");d.push("".concat(n[i++])),r=r-1,r&&d.push(".");for(var o=0;o<r;o++)d.push("".concat(n[i++]));d.push("E"),P>0?d.push("+".concat(P)):d.push("".concat(P))}else if(O>=0)for(var o=0;o<r;o++)d.push("".concat(n[i++]));else{var F=r+O;if(F>0)for(var o=0;o<F;o++)d.push("".concat(n[i++]));else d.push("0");for(d.push(".");F++<0;)d.push("0");for(var o=0;o<r-Math.max(F-1,0);o++)d.push("".concat(n[i++]))}return d.join("")},t.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},t.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},t.fromExtendedJSON=function(e){return t.fromString(e.$numberDecimal)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new Decimal128("'.concat(this.toString(),'")')},t}();Object.defineProperty(Oo.prototype,"_bsontype",{value:"Decimal128"});var Qn=function(){function t(e){if(!(this instanceof t))return new t(e);e instanceof Number&&(e=e.valueOf()),this.value=+e}return t.prototype.valueOf=function(){return this.value},t.prototype.toJSON=function(){return this.value},t.prototype.toString=function(e){return this.value.toString(e)},t.prototype.toExtendedJSON=function(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-".concat(this.value.toFixed(1))}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}},t.fromExtendedJSON=function(e,r){var n=parseFloat(e.$numberDouble);return r&&r.relaxed?n:new t(n)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var e=this.toExtendedJSON();return"new Double(".concat(e.$numberDouble,")")},t}();Object.defineProperty(Qn.prototype,"_bsontype",{value:"Double"});var Zn=function(){function t(e){if(!(this instanceof t))return new t(e);e instanceof Number&&(e=e.valueOf()),this.value=+e|0}return t.prototype.valueOf=function(){return this.value},t.prototype.toString=function(e){return this.value.toString(e)},t.prototype.toJSON=function(){return this.value},t.prototype.toExtendedJSON=function(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}},t.fromExtendedJSON=function(e,r){return r&&r.relaxed?parseInt(e.$numberInt,10):new t(e.$numberInt)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Int32(".concat(this.valueOf(),")")},t}();Object.defineProperty(Zn.prototype,"_bsontype",{value:"Int32"});var xo=function(){function t(){if(!(this instanceof t))return new t}return t.prototype.toExtendedJSON=function(){return{$maxKey:1}},t.fromExtendedJSON=function(){return new t},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new MaxKey()"},t}();Object.defineProperty(xo.prototype,"_bsontype",{value:"MaxKey"});var No=function(){function t(){if(!(this instanceof t))return new t}return t.prototype.toExtendedJSON=function(){return{$minKey:1}},t.fromExtendedJSON=function(){return new t},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new MinKey()"},t}();Object.defineProperty(No.prototype,"_bsontype",{value:"MinKey"});var Up=new RegExp("^[0-9a-fA-F]{24}$"),Ft=null,nt=Symbol("id"),ze=function(){function t(e){if(!(this instanceof t))return new t(e);var r;if(typeof e=="object"&&e&&"id"in e){if(typeof e.id!="string"&&!ArrayBuffer.isView(e.id))throw new ce("Argument passed in must have an id that is of type string or Buffer");"toHexString"in e&&typeof e.toHexString=="function"?r=z.from(e.toHexString(),"hex"):r=e.id}else r=e;if(r==null||typeof r=="number")this[nt]=t.generate(typeof r=="number"?r:void 0);else if(ArrayBuffer.isView(r)&&r.byteLength===12)this[nt]=r instanceof z?r:Un(r);else if(typeof r=="string")if(r.length===12){var n=z.from(r);if(n.byteLength===12)this[nt]=n;else throw new ce("Argument passed in must be a string of 12 bytes")}else if(r.length===24&&Up.test(r))this[nt]=z.from(r,"hex");else throw new ce("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");else throw new ce("Argument passed in does not match the accepted types");t.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(t.prototype,"id",{get:function(){return this[nt]},set:function(e){this[nt]=e,t.cacheHexString&&(this.__id=e.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(e){this.id.writeUInt32BE(e,0)},enumerable:!1,configurable:!0}),t.prototype.toHexString=function(){if(t.cacheHexString&&this.__id)return this.__id;var e=this.id.toString("hex");return t.cacheHexString&&!this.__id&&(this.__id=e),e},t.getInc=function(){return t.index=(t.index+1)%16777215},t.generate=function(e){typeof e!="number"&&(e=Math.floor(Date.now()/1e3));var r=t.getInc(),n=z.alloc(12);return n.writeUInt32BE(e,0),Ft===null&&(Ft=za(5)),n[4]=Ft[0],n[5]=Ft[1],n[6]=Ft[2],n[7]=Ft[3],n[8]=Ft[4],n[11]=r&255,n[10]=r>>8&255,n[9]=r>>16&255,n},t.prototype.toString=function(e){return e?this.id.toString(e):this.toHexString()},t.prototype.toJSON=function(){return this.toHexString()},t.prototype.equals=function(e){if(e==null)return!1;if(e instanceof t)return this[nt][11]===e[nt][11]&&this[nt].equals(e[nt]);if(typeof e=="string"&&t.isValid(e)&&e.length===12&&To(this.id))return e===z.prototype.toString.call(this.id,"latin1");if(typeof e=="string"&&t.isValid(e)&&e.length===24)return e.toLowerCase()===this.toHexString();if(typeof e=="string"&&t.isValid(e)&&e.length===12)return z.from(e).equals(this.id);if(typeof e=="object"&&"toHexString"in e&&typeof e.toHexString=="function"){var r=e.toHexString(),n=this.toHexString().toLowerCase();return typeof r=="string"&&r.toLowerCase()===n}return!1},t.prototype.getTimestamp=function(){var e=new Date,r=this.id.readUInt32BE(0);return e.setTime(Math.floor(r)*1e3),e},t.createPk=function(){return new t},t.createFromTime=function(e){var r=z.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r.writeUInt32BE(e,0),new t(r)},t.createFromHexString=function(e){if(typeof e>"u"||e!=null&&e.length!==24)throw new ce("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new t(z.from(e,"hex"))},t.isValid=function(e){if(e==null)return!1;try{return new t(e),!0}catch{return!1}},t.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},t.fromExtendedJSON=function(e){return new t(e.$oid)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new ObjectId("'.concat(this.toHexString(),'")')},t.index=Math.floor(Math.random()*16777215),t}();Object.defineProperty(ze.prototype,"generate",{value:Xn(function(t){return ze.generate(t)},"Please use the static `ObjectId.generate(time)` instead")});Object.defineProperty(ze.prototype,"getInc",{value:Xn(function(){return ze.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(ze.prototype,"get_inc",{value:Xn(function(){return ze.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(ze,"get_inc",{value:Xn(function(){return ze.getInc()},"Please use the static `ObjectId.getInc()` instead")});Object.defineProperty(ze.prototype,"_bsontype",{value:"ObjectID"});function kp(t){return t.split("").sort().join("")}var Gr=function(){function t(e,r){if(!(this instanceof t))return new t(e,r);if(this.pattern=e,this.options=kp(r??""),this.pattern.indexOf("\0")!==-1)throw new Wt("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));if(this.options.indexOf("\0")!==-1)throw new Wt("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));for(var n=0;n<this.options.length;n++)if(!(this.options[n]==="i"||this.options[n]==="m"||this.options[n]==="x"||this.options[n]==="l"||this.options[n]==="s"||this.options[n]==="u"))throw new Wt("The regular expression option [".concat(this.options[n],"] is not supported"))}return t.parseOptions=function(e){return e?e.split("").sort().join(""):""},t.prototype.toExtendedJSON=function(e){return e=e||{},e.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},t.fromExtendedJSON=function(e){if("$regex"in e)if(typeof e.$regex!="string"){if(e.$regex._bsontype==="BSONRegExp")return e}else return new t(e.$regex,t.parseOptions(e.$options));if("$regularExpression"in e)return new t(e.$regularExpression.pattern,t.parseOptions(e.$regularExpression.options));throw new ce("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(e)))},t}();Object.defineProperty(Gr.prototype,"_bsontype",{value:"BSONRegExp"});var Ro=function(){function t(e){if(!(this instanceof t))return new t(e);this.value=e}return t.prototype.valueOf=function(){return this.value},t.prototype.toString=function(){return this.value},t.prototype.inspect=function(){return'new BSONSymbol("'.concat(this.value,'")')},t.prototype.toJSON=function(){return this.value},t.prototype.toExtendedJSON=function(){return{$symbol:this.value}},t.fromExtendedJSON=function(e){return new t(e.$symbol)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t}();Object.defineProperty(Ro.prototype,"_bsontype",{value:"Symbol"});var Mp=k,tu=function(t){Yn(e,t);function e(r,n){var o=this;return o instanceof e?(k.isLong(r)?o=t.call(this,r.low,r.high,!0)||this:zr(r)&&typeof r.t<"u"&&typeof r.i<"u"?o=t.call(this,r.i,r.t,!0)||this:o=t.call(this,r,n,!0)||this,Object.defineProperty(o,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),o):new e(r,n)}return e.prototype.toJSON=function(){return{$timestamp:this.toString()}},e.fromInt=function(r){return new e(k.fromInt(r,!0))},e.fromNumber=function(r){return new e(k.fromNumber(r,!0))},e.fromBits=function(r,n){return new e(r,n)},e.fromString=function(r,n){return new e(k.fromString(r,!0,n))},e.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},e.fromExtendedJSON=function(r){return new e(r.$timestamp)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Timestamp({ t: ".concat(this.getHighBits(),", i: ").concat(this.getLowBits()," })")},e.MAX_VALUE=k.MAX_UNSIGNED_VALUE,e}(Mp);function $p(t){return zr(t)&&Reflect.has(t,"_bsontype")&&typeof t._bsontype=="string"}var ru=2147483647,nu=-2147483648,iu=9223372036854776e3,ou=-9223372036854776e3,jp={$oid:ze,$binary:qt,$uuid:qt,$symbol:Ro,$numberInt:Zn,$numberDecimal:Oo,$numberDouble:Qn,$numberLong:k,$minKey:No,$maxKey:xo,$regex:Gr,$regularExpression:Gr,$timestamp:tu};function su(t,e){if(e===void 0&&(e={}),typeof t=="number"){if(e.relaxed||e.legacy)return t;if(Math.floor(t)===t){if(t>=nu&&t<=ru)return new Zn(t);if(t>=ou&&t<=iu)return k.fromNumber(t)}return new Qn(t)}if(t==null||typeof t!="object")return t;if(t.$undefined)return null;for(var r=Object.keys(t).filter(function(d){return d.startsWith("$")&&t[d]!=null}),n=0;n<r.length;n++){var o=jp[r[n]];if(o)return o.fromExtendedJSON(t,e)}if(t.$date!=null){var i=t.$date,a=new Date;return e.legacy?typeof i=="number"?a.setTime(i):typeof i=="string"&&a.setTime(Date.parse(i)):typeof i=="string"?a.setTime(Date.parse(i)):k.isLong(i)?a.setTime(i.toNumber()):typeof i=="number"&&e.relaxed&&a.setTime(i),a}if(t.$code!=null){var c=Object.assign({},t);return t.$scope&&(c.$scope=su(t.$scope)),zn.fromExtendedJSON(t)}if(Ap(t)||t.$dbPointer){var h=t.$ref?t:t.$dbPointer;if(h instanceof Kr)return h;var s=Object.keys(h).filter(function(d){return d.startsWith("$")}),u=!0;if(s.forEach(function(d){["$ref","$id","$db"].indexOf(d)===-1&&(u=!1)}),u)return Kr.fromExtendedJSON(h)}return t}function Wp(t,e){return t.map(function(r,n){e.seenObjects.push({propertyName:"index ".concat(n),obj:null});try{return St(r,e)}finally{e.seenObjects.pop()}})}function Hs(t){var e=t.toISOString();return t.getUTCMilliseconds()!==0?e:e.slice(0,-5)+"Z"}function St(t,e){if((typeof t=="object"||typeof t=="function")&&t!==null){var r=e.seenObjects.findIndex(function(A){return A.obj===t});if(r!==-1){var n=e.seenObjects.map(function(A){return A.propertyName}),o=n.slice(0,r).map(function(A){return"".concat(A," -> ")}).join(""),i=n[r],a=" -> "+n.slice(r+1,n.length-1).map(function(A){return"".concat(A," -> ")}).join(""),c=n[n.length-1],h=" ".repeat(o.length+i.length/2),s="-".repeat(a.length+(i.length+c.length)/2-1);throw new ce(`Converting circular structure to EJSON:
`+"    ".concat(o).concat(i).concat(a).concat(c,`
`)+"    ".concat(h,"\\").concat(s,"/"))}e.seenObjects[e.seenObjects.length-1].obj=t}if(Array.isArray(t))return Wp(t,e);if(t===void 0)return null;if(t instanceof Date||wp(t)){var u=t.getTime(),d=u>-1&&u<2534023188e5;return e.legacy?e.relaxed&&d?{$date:t.getTime()}:{$date:Hs(t)}:e.relaxed&&d?{$date:Hs(t)}:{$date:{$numberLong:t.getTime().toString()}}}if(typeof t=="number"&&(!e.relaxed||!isFinite(t))){if(Math.floor(t)===t){var m=t>=nu&&t<=ru,v=t>=ou&&t<=iu;if(m)return{$numberInt:t.toString()};if(v)return{$numberLong:t.toString()}}return{$numberDouble:t.toString()}}if(t instanceof RegExp||_p(t)){var b=t.flags;if(b===void 0){var I=t.toString().match(/[gimuy]*$/);I&&(b=I[0])}var E=new Gr(t.source,b);return E.toExtendedJSON(e)}return t!=null&&typeof t=="object"?Hp(t,e):t}var qp={Binary:function(t){return new qt(t.value(),t.sub_type)},Code:function(t){return new zn(t.code,t.scope)},DBRef:function(t){return new Kr(t.collection||t.namespace,t.oid,t.db,t.fields)},Decimal128:function(t){return new Oo(t.bytes)},Double:function(t){return new Qn(t.value)},Int32:function(t){return new Zn(t.value)},Long:function(t){return k.fromBits(t.low!=null?t.low:t.low_,t.low!=null?t.high:t.high_,t.low!=null?t.unsigned:t.unsigned_)},MaxKey:function(){return new xo},MinKey:function(){return new No},ObjectID:function(t){return new ze(t)},ObjectId:function(t){return new ze(t)},BSONRegExp:function(t){return new Gr(t.pattern,t.options)},Symbol:function(t){return new Ro(t.value)},Timestamp:function(t){return tu.fromBits(t.low,t.high)}};function Hp(t,e){if(t==null||typeof t!="object")throw new Wt("not an object instance");var r=t._bsontype;if(typeof r>"u"){var n={};for(var o in t){e.seenObjects.push({propertyName:o,obj:null});try{var i=St(t[o],e);o==="__proto__"?Object.defineProperty(n,o,{value:i,writable:!0,enumerable:!0,configurable:!0}):n[o]=i}finally{e.seenObjects.pop()}}return n}else if($p(t)){var a=t;if(typeof a.toExtendedJSON!="function"){var c=qp[t._bsontype];if(!c)throw new ce("Unrecognized or invalid _bsontype: "+t._bsontype);a=c(a)}return r==="Code"&&a.scope?a=new zn(a.code,St(a.scope,e)):r==="DBRef"&&a.oid&&(a=new Kr(St(a.collection,e),St(a.oid,e),St(a.db,e),St(a.fields,e))),a.toExtendedJSON(e)}else throw new Wt("_bsontype must be a string, but was: "+typeof r)}var Fe;(function(t){function e(i,a){var c=Object.assign({},{relaxed:!0,legacy:!1},a);return typeof c.relaxed=="boolean"&&(c.strict=!c.relaxed),typeof c.strict=="boolean"&&(c.relaxed=!c.strict),JSON.parse(i,function(h,s){if(h.indexOf("\0")!==-1)throw new Wt("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(h)));return su(s,c)})}t.parse=e;function r(i,a,c,h){c!=null&&typeof c=="object"&&(h=c,c=0),a!=null&&typeof a=="object"&&!Array.isArray(a)&&(h=a,a=void 0,c=0);var s=Object.assign({relaxed:!0,legacy:!1},h,{seenObjects:[{propertyName:"(root)",obj:null}]}),u=St(i,s);return JSON.stringify(u,a,c)}t.stringify=r;function n(i,a){return a=a||{},JSON.parse(r(i,a))}t.serialize=n;function o(i,a){return a=a||{},e(JSON.stringify(i),a)}t.deserialize=o})(Fe||(Fe={}));var Ks=Xa();Ks.Map?Ks.Map:function(){function t(e){e===void 0&&(e=[]),this._keys=[],this._values={};for(var r=0;r<e.length;r++)if(e[r]!=null){var n=e[r],o=n[0],i=n[1];this._keys.push(o),this._values[o]={v:i,i:this._keys.length-1}}}return t.prototype.clear=function(){this._keys=[],this._values={}},t.prototype.delete=function(e){var r=this._values[e];return r==null?!1:(delete this._values[e],this._keys.splice(r.i,1),!0)},t.prototype.entries=function(){var e=this,r=0;return{next:function(){var n=e._keys[r++];return{value:n!==void 0?[n,e._values[n].v]:void 0,done:n===void 0}}}},t.prototype.forEach=function(e,r){r=r||this;for(var n=0;n<this._keys.length;n++){var o=this._keys[n];e.call(r,this._values[o].v,o,r)}},t.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},t.prototype.has=function(e){return this._values[e]!=null},t.prototype.keys=function(){var e=this,r=0;return{next:function(){var n=e._keys[r++];return{value:n!==void 0?n:void 0,done:n===void 0}}}},t.prototype.set=function(e,r){return this._values[e]?(this._values[e].v=r,this):(this._keys.push(e),this._values[e]={v:r,i:this._keys.length-1},this)},t.prototype.values=function(){var e=this,r=0;return{next:function(){var n=e._keys[r++];return{value:n!==void 0?e._values[n].v:void 0,done:n===void 0}}}},Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0}),t}();k.fromNumber(bp);k.fromNumber(Sp);var zi=new Uint8Array(8);new DataView(zi.buffer,zi.byteOffset,zi.byteLength);var Kp=1024*1024*17;z.alloc(Kp);var Gp=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},Vp=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},au=function(){function t(e,r){this._stages=[],e&&r&&(this._db=e,this._request=new Oe.reqClass(this._db.config),this._collectionName=r)}return t.prototype.end=function(){return Gp(this,void 0,void 0,function(){var e;return Vp(this,function(r){switch(r.label){case 0:if(!this._collectionName||!this._db)throw new Error("Aggregation pipeline cannot send request");return[4,this._request.send("database.aggregate",{collectionName:this._collectionName,stages:this._stages})];case 1:return e=r.sent(),e&&e.data&&e.data.list?[2,{requestId:e.requestId,data:JSON.parse(e.data.list).map(Fe.parse)}]:[2,e]}})})},t.prototype.unwrap=function(){return this._stages},t.prototype.done=function(){return this._stages.map(function(e){var r,n=e.stageKey,o=e.stageValue;return r={},r[n]=JSON.parse(o),r})},t.prototype._pipe=function(e,r){return this._stages.push({stageKey:"$"+e,stageValue:JSON.stringify(r)}),this},t.prototype.addFields=function(e){return this._pipe("addFields",e)},t.prototype.bucket=function(e){return this._pipe("bucket",e)},t.prototype.bucketAuto=function(e){return this._pipe("bucketAuto",e)},t.prototype.count=function(e){return this._pipe("count",e)},t.prototype.geoNear=function(e){return this._pipe("geoNear",e)},t.prototype.group=function(e){return this._pipe("group",e)},t.prototype.limit=function(e){return this._pipe("limit",e)},t.prototype.match=function(e){return this._pipe("match",po.encode(e))},t.prototype.project=function(e){return this._pipe("project",e)},t.prototype.lookup=function(e){return this._pipe("lookup",e)},t.prototype.replaceRoot=function(e){return this._pipe("replaceRoot",e)},t.prototype.sample=function(e){return this._pipe("sample",e)},t.prototype.skip=function(e){return this._pipe("skip",e)},t.prototype.sort=function(e){return this._pipe("sort",e)},t.prototype.sortByCount=function(e){return this._pipe("sortByCount",e)},t.prototype.unwind=function(e){return this._pipe("unwind",e)},t}(),Jp=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Yp=function(t){Jp(e,t);function e(r,n){return t.call(this,r,n)||this}return Object.defineProperty(e.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),e.prototype.doc=function(r){if(typeof r!="string"&&typeof r!="number")throw new Error("docId必须为字符串或数字");return new Ps(this._db,this._coll,r)},e.prototype.add=function(r,n){var o=new Ps(this._db,this._coll,void 0);return o.create(r,n)},e.prototype.aggregate=function(){return new au(this._db,this._coll)},e}(ep),Xp={eq:function(t){return new me(W.EQ,[t])},neq:function(t){return new me(W.NEQ,[t])},lt:function(t){return new me(W.LT,[t])},lte:function(t){return new me(W.LTE,[t])},gt:function(t){return new me(W.GT,[t])},gte:function(t){return new me(W.GTE,[t])},in:function(t){return new me(W.IN,t)},nin:function(t){return new me(W.NIN,t)},all:function(t){return new me(W.ALL,t)},elemMatch:function(t){return new me(W.ELEM_MATCH,[t])},exists:function(t){return new me(W.EXISTS,[t])},size:function(t){return new me(W.SIZE,[t])},mod:function(t){return new me(W.MOD,[t])},geoNear:function(t){return new me(W.GEO_NEAR,[t])},geoWithin:function(t){return new me(W.GEO_WITHIN,[t])},geoIntersects:function(t){return new me(W.GEO_INTERSECTS,[t])},and:function(){var t=de(arguments[0])?arguments[0]:Array.from(arguments);return new $t(Me.AND,t)},nor:function(){var t=de(arguments[0])?arguments[0]:Array.from(arguments);return new $t(Me.NOR,t)},or:function(){var t=de(arguments[0])?arguments[0]:Array.from(arguments);return new $t(Me.OR,t)},not:function(){var t=de(arguments[0])?arguments[0]:Array.from(arguments);return new $t(Me.NOT,t)},set:function(t){return new ye(J.SET,[t])},remove:function(){return new ye(J.REMOVE,[])},inc:function(t){return new ye(J.INC,[t])},mul:function(t){return new ye(J.MUL,[t])},push:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r;if(Tt(t[0])&&t[0].hasOwnProperty("each")){var n=t[0];r={$each:n.each,$position:n.position,$sort:n.sort,$slice:n.slice}}else de(t[0])?r=t[0]:r=Array.from(t);return new ye(J.PUSH,r)},pull:function(t){return new ye(J.PULL,t)},pullAll:function(t){return new ye(J.PULL_ALL,t)},pop:function(){return new ye(J.POP,[])},shift:function(){return new ye(J.SHIFT,[])},unshift:function(){var t=de(arguments[0])?arguments[0]:Array.from(arguments);return new ye(J.UNSHIFT,t)},addToSet:function(t){return new ye(J.ADD_TO_SET,t)},rename:function(t){return new ye(J.RENAME,[t])},bit:function(t){return new ye(J.BIT,[t])},max:function(t){return new ye(J.MAX,[t])},min:function(t){return new ye(J.MIN,[t])},expr:function(t){return{$expr:t}},jsonSchema:function(t){return{$jsonSchema:t}},text:function(t){return Gd(t)?{$search:t.search}:{$search:t.search,$language:t.language,$caseSensitive:t.caseSensitive,$diacriticSensitive:t.diacriticSensitive}},aggregate:{pipeline:function(){return new au},abs:function(t){return new C("abs",t)},add:function(t){return new C("add",t)},ceil:function(t){return new C("ceil",t)},divide:function(t){return new C("divide",t)},exp:function(t){return new C("exp",t)},floor:function(t){return new C("floor",t)},ln:function(t){return new C("ln",t)},log:function(t){return new C("log",t)},log10:function(t){return new C("log10",t)},mod:function(t){return new C("mod",t)},multiply:function(t){return new C("multiply",t)},pow:function(t){return new C("pow",t)},sqrt:function(t){return new C("sqrt",t)},subtract:function(t){return new C("subtract",t)},trunc:function(t){return new C("trunc",t)},arrayElemAt:function(t){return new C("arrayElemAt",t)},arrayToObject:function(t){return new C("arrayToObject",t)},concatArrays:function(t){return new C("concatArrays",t)},filter:function(t){return new C("filter",t)},in:function(t){return new C("in",t)},indexOfArray:function(t){return new C("indexOfArray",t)},isArray:function(t){return new C("isArray",t)},map:function(t){return new C("map",t)},range:function(t){return new C("range",t)},reduce:function(t){return new C("reduce",t)},reverseArray:function(t){return new C("reverseArray",t)},size:function(t){return new C("size",t)},slice:function(t){return new C("slice",t)},zip:function(t){return new C("zip",t)},and:function(t){return new C("and",t)},not:function(t){return new C("not",t)},or:function(t){return new C("or",t)},cmp:function(t){return new C("cmp",t)},eq:function(t){return new C("eq",t)},gt:function(t){return new C("gt",t)},gte:function(t){return new C("gte",t)},lt:function(t){return new C("lt",t)},lte:function(t){return new C("lte",t)},neq:function(t){return new C("ne",t)},cond:function(t){return new C("cond",t)},ifNull:function(t){return new C("ifNull",t)},switch:function(t){return new C("switch",t)},dateFromParts:function(t){return new C("dateFromParts",t)},dateFromString:function(t){return new C("dateFromString",t)},dayOfMonth:function(t){return new C("dayOfMonth",t)},dayOfWeek:function(t){return new C("dayOfWeek",t)},dayOfYear:function(t){return new C("dayOfYear",t)},isoDayOfWeek:function(t){return new C("isoDayOfWeek",t)},isoWeek:function(t){return new C("isoWeek",t)},isoWeekYear:function(t){return new C("isoWeekYear",t)},millisecond:function(t){return new C("millisecond",t)},minute:function(t){return new C("minute",t)},month:function(t){return new C("month",t)},second:function(t){return new C("second",t)},hour:function(t){return new C("hour",t)},week:function(t){return new C("week",t)},year:function(t){return new C("year",t)},literal:function(t){return new C("literal",t)},mergeObjects:function(t){return new C("mergeObjects",t)},objectToArray:function(t){return new C("objectToArray",t)},allElementsTrue:function(t){return new C("allElementsTrue",t)},anyElementTrue:function(t){return new C("anyElementTrue",t)},setDifference:function(t){return new C("setDifference",t)},setEquals:function(t){return new C("setEquals",t)},setIntersection:function(t){return new C("setIntersection",t)},setIsSubset:function(t){return new C("setIsSubset",t)},setUnion:function(t){return new C("setUnion",t)},concat:function(t){return new C("concat",t)},dateToString:function(t){return new C("dateToString",t)},indexOfBytes:function(t){return new C("indexOfBytes",t)},indexOfCP:function(t){return new C("indexOfCP",t)},split:function(t){return new C("split",t)},strLenBytes:function(t){return new C("strLenBytes",t)},strLenCP:function(t){return new C("strLenCP",t)},strcasecmp:function(t){return new C("strcasecmp",t)},substr:function(t){return new C("substr",t)},substrBytes:function(t){return new C("substrBytes",t)},substrCP:function(t){return new C("substrCP",t)},toLower:function(t){return new C("toLower",t)},toUpper:function(t){return new C("toUpper",t)},meta:function(t){return new C("meta",t)},addToSet:function(t){return new C("addToSet",t)},avg:function(t){return new C("avg",t)},first:function(t){return new C("first",t)},last:function(t){return new C("last",t)},max:function(t){return new C("max",t)},min:function(t){return new C("min",t)},push:function(t){return new C("push",t)},stdDevPop:function(t){return new C("stdDevPop",t)},stdDevSamp:function(t){return new C("stdDevSamp",t)},sum:function(t){return new C("sum",t)},let:function(t){return new C("let",t)}},project:{slice:function(t){return new Gs("slice",t)},elemMatch:function(t){return new Gs("elemMatch",t)}}},C=function(){function t(e,r){this["$"+e]=r}return t}(),Gs=function(){function t(e,r){this["$"+e]=r}return t}(),zp=function(){function t(e){var r=e.regexp,n=e.options;if(!r)throw new TypeError("regexp must be a string");this.$regex=r,this.$options=n}return t.prototype.parse=function(){return{$regex:this.$regex,$options:this.$options}},Object.defineProperty(t.prototype,"_internalType",{get:function(){return Wa},enumerable:!0,configurable:!0}),t}();function Qp(t){return new zp(t)}var uu={CREATE_WATCH_NET_ERROR:{code:"CREATE_WATCH_NET_ERROR",message:"create watch network error"},CREATE_WACTH_EXCEED_ERROR:{code:"CREATE_WACTH_EXCEED_ERROR",message:"maximum connections exceed"},CREATE_WATCH_SERVER_ERROR:{code:"CREATE_WATCH_SERVER_ERROR",message:"create watch server error"},CONN_ERROR:{code:"CONN_ERROR",message:"connection error"},INVALID_PARAM:{code:"INVALID_PARAM",message:"Invalid request param"},INSERT_DOC_FAIL:{code:"INSERT_DOC_FAIL",message:"insert document failed"},DATABASE_TRANSACTION_CONFLICT:{code:"DATABASE_TRANSACTION_CONFLICT",message:"database transaction conflict"}},it=function(){return it=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},it.apply(this,arguments)},Fr=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},Ur=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Zp="database.getInTransaction",Vs="database.updateDocInTransaction",ey="database.deleteDocInTransaction",ty="database.insertDocInTransaction",Js=function(){function t(e,r,n){this._coll=r,this.id=n,this._transaction=e,this._request=this._transaction.getRequestMethod(),this._transactionId=this._transaction.getTransactionId()}return t.prototype.create=function(e){return Fr(this,void 0,void 0,function(){var r,n,o,i;return Ur(this,function(a){switch(a.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,data:Fe.stringify(Hr(e),{relaxed:!1})},this.id&&(r._id=this.id),[4,this._request.send(ty,r)];case 1:if(n=a.sent(),n.code)throw n;if(o=Fe.parse(n.inserted),i=Fe.parse(n.ok),i==1&&o==1)return[2,it(it({},n),{ok:i,inserted:o})];throw new Error(uu.INSERT_DOC_FAIL.message)}})})},t.prototype.get=function(){return Fr(this,void 0,void 0,function(){var e,r;return Ur(this,function(n){switch(n.label){case 0:return e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send(Zp,e)];case 1:if(r=n.sent(),r.code)throw r;return[2,{data:r.data!=="null"?Vn.formatField(Fe.parse(r.data)):Fe.parse(r.data),requestId:r.requestId}]}})})},t.prototype.set=function(e){return Fr(this,void 0,void 0,function(){var r,n;return Ur(this,function(o){switch(o.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:Fe.stringify(Hr(e),{relaxed:!1}),upsert:!0},[4,this._request.send(Vs,r)];case 1:if(n=o.sent(),n.code)throw n;return[2,it(it({},n),{updated:Fe.parse(n.updated),upserted:n.upserted?JSON.parse(n.upserted):null})]}})})},t.prototype.update=function(e){return Fr(this,void 0,void 0,function(){var r,n;return Ur(this,function(o){switch(o.label){case 0:return r={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:Fe.stringify(Io.encode(e),{relaxed:!1})},[4,this._request.send(Vs,r)];case 1:if(n=o.sent(),n.code)throw n;return[2,it(it({},n),{updated:Fe.parse(n.updated)})]}})})},t.prototype.delete=function(){return Fr(this,void 0,void 0,function(){var e,r;return Ur(this,function(n){switch(n.label){case 0:return e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send(ey,e)];case 1:if(r=n.sent(),r.code)throw r;return[2,it(it({},r),{deleted:Fe.parse(r.deleted)})]}})})},t}(),ry=function(){function t(e,r){this._coll=r,this._transaction=e}return t}(),ny=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),iy=function(t){ny(e,t);function e(r,n){return t.call(this,r,n)||this}return Object.defineProperty(e.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),e.prototype.doc=function(r){if(typeof r!="string"&&typeof r!="number")throw new Error("docId必须为字符串或数字");return new Js(this._transaction,this._coll,r)},e.prototype.add=function(r){var n;r._id!==void 0&&(n=r._id);var o=new Js(this._transaction,this._coll,n);return o.create(r)},e}(ry),fr=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},lr=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},oy="database.startTransaction",sy="database.commitTransaction",ay="database.abortTransaction",cu=function(){function t(e){this._db=e,this._request=new Oe.reqClass(this._db.config),this.aborted=!1,this.commited=!1,this.inited=!1}return t.prototype.init=function(){return fr(this,void 0,void 0,function(){var e;return lr(this,function(r){switch(r.label){case 0:return[4,this._request.send(oy)];case 1:if(e=r.sent(),e.code)throw e;return this.inited=!0,this._id=e.transactionId,[2]}})})},t.prototype.collection=function(e){if(!e)throw new Error("Collection name is required");return new iy(this,e)},t.prototype.getTransactionId=function(){return this._id},t.prototype.getRequestMethod=function(){return this._request},t.prototype.commit=function(){return fr(this,void 0,void 0,function(){var e,r;return lr(this,function(n){switch(n.label){case 0:return e={transactionId:this._id},[4,this._request.send(sy,e)];case 1:if(r=n.sent(),r.code)throw r;return this.commited=!0,[2,r]}})})},t.prototype.rollback=function(e){return fr(this,void 0,void 0,function(){var r,n;return lr(this,function(o){switch(o.label){case 0:return r={transactionId:this._id},[4,this._request.send(ay,r)];case 1:if(n=o.sent(),n.code)throw n;return this.aborted=!0,this.abortReason=e,[2,n]}})})},t}();function uy(){return fr(this,void 0,void 0,function(){var t;return lr(this,function(e){switch(e.label){case 0:return t=new cu(this),[4,t.init()];case 1:return e.sent(),[2,t]}})})}function fu(t,e){return e===void 0&&(e=3),fr(this,void 0,void 0,function(){var r,n,o,i,a=this;return lr(this,function(c){switch(c.label){case 0:return c.trys.push([0,4,,10]),r=new cu(this),[4,r.init()];case 1:return c.sent(),[4,t(r)];case 2:if(n=c.sent(),r.aborted===!0)throw r.abortReason;return[4,r.commit()];case 3:return c.sent(),[2,n];case 4:if(o=c.sent(),r.inited===!1)throw o;return i=function(h){return fr(a,void 0,void 0,function(){return lr(this,function(s){switch(s.label){case 0:if(!(!r.aborted&&!r.commited))return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,r.rollback()];case 2:return s.sent(),[3,4];case 3:return s.sent(),[3,4];case 4:throw h;case 5:throw r.aborted===!0?r.abortReason:h}})})},e<=0?[4,i(o)]:[3,6];case 5:c.sent(),c.label=6;case 6:return o&&o.code===uu.DATABASE_TRANSACTION_CONFLICT.code?[4,fu.bind(this)(t,--e)]:[3,8];case 7:return[2,c.sent()];case 8:return[4,i(o)];case 9:return c.sent(),[3,10];case 10:return[2]}})})}var Oe=function(){function t(e){this.config=e,this.Geo=Yd,this.serverDate=Kd,this.command=Xp,this.RegExp=Qp,this.startTransaction=uy,this.runTransaction=fu,this.logicCommand=$t,this.updateCommand=ye,this.queryCommand=me}return t.prototype.collection=function(e){if(!e)throw new Error("Collection name is required");return new Yp(this,e)},t.prototype.createCollection=function(e){var r=new t.reqClass(this.config),n={collectionName:e};return r.send("database.addCollection",n)},t}(),kn=function(){return kn=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},kn.apply(this,arguments)},cy="database";function fy(t){var e=this.platform,r=e.adapter,n=e.runtime;return Oe.reqClass=this.request.constructor,Oe.getAccessToken=this.authInstance?this.authInstance.getAccessToken.bind(this.authInstance):function(){return""},Oe.runtime=n,this.wsClientClass&&(Oe.wsClass=r.wsClass,Oe.wsClientClass=this.wsClientClass),Oe.ws||(Oe.ws=null),new Oe(kn(kn({},this.config),t))}var ly={name:cy,entity:{database:fy}};try{cloudbase.registerComponent(ly)}catch{}var hy="Expected a function",lu="__lodash_hash_undefined__",hu=1/0,dy=9007199254740991,py="[object Function]",yy="[object GeneratorFunction]",gy="[object Symbol]",my=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,vy=/^\w*$/,_y=/^\./,wy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ey=/[\\^$.*+?()[\]{}|]/g,by=/\\(\\)?/g,Sy=/^\[object .+?Constructor\]$/,Ay=/^(?:0|[1-9]\d*)$/,Iy=typeof D=="object"&&D&&D.Object===Object&&D,Ty=typeof self=="object"&&self&&self.Object===Object&&self,Co=Iy||Ty||Function("return this")();function Oy(t,e){return t==null?void 0:t[e]}function xy(t){var e=!1;if(t!=null&&typeof t.toString!="function")try{e=!!(t+"")}catch{}return e}var Ny=Array.prototype,Ry=Function.prototype,du=Object.prototype,Qi=Co["__core-js_shared__"],Ys=function(){var t=/[^.]+$/.exec(Qi&&Qi.keys&&Qi.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),pu=Ry.toString,ei=du.hasOwnProperty,yu=du.toString,Cy=RegExp("^"+pu.call(ei).replace(Ey,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Xs=Co.Symbol,Py=Ny.splice,By=gu(Co,"Map"),Vr=gu(Object,"create"),zs=Xs?Xs.prototype:void 0,Qs=zs?zs.toString:void 0;function Ht(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Dy(){this.__data__=Vr?Vr(null):{}}function Ly(t){return this.has(t)&&delete this.__data__[t]}function Fy(t){var e=this.__data__;if(Vr){var r=e[t];return r===lu?void 0:r}return ei.call(e,t)?e[t]:void 0}function Uy(t){var e=this.__data__;return Vr?e[t]!==void 0:ei.call(e,t)}function ky(t,e){var r=this.__data__;return r[t]=Vr&&e===void 0?lu:e,this}Ht.prototype.clear=Dy;Ht.prototype.delete=Ly;Ht.prototype.get=Fy;Ht.prototype.has=Uy;Ht.prototype.set=ky;function gr(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function My(){this.__data__=[]}function $y(t){var e=this.__data__,r=ti(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Py.call(e,r,1),!0}function jy(t){var e=this.__data__,r=ti(e,t);return r<0?void 0:e[r][1]}function Wy(t){return ti(this.__data__,t)>-1}function qy(t,e){var r=this.__data__,n=ti(r,t);return n<0?r.push([t,e]):r[n][1]=e,this}gr.prototype.clear=My;gr.prototype.delete=$y;gr.prototype.get=jy;gr.prototype.has=Wy;gr.prototype.set=qy;function Vt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Hy(){this.__data__={hash:new Ht,map:new(By||gr),string:new Ht}}function Ky(t){return ri(this,t).delete(t)}function Gy(t){return ri(this,t).get(t)}function Vy(t){return ri(this,t).has(t)}function Jy(t,e){return ri(this,t).set(t,e),this}Vt.prototype.clear=Hy;Vt.prototype.delete=Ky;Vt.prototype.get=Gy;Vt.prototype.has=Vy;Vt.prototype.set=Jy;function Yy(t,e,r){var n=t[e];(!(ei.call(t,e)&&mu(n,r))||r===void 0&&!(e in t))&&(t[e]=r)}function ti(t,e){for(var r=t.length;r--;)if(mu(t[r][0],e))return r;return-1}function Xy(t){if(!Mn(t)||ng(t))return!1;var e=ag(t)||xy(t)?Cy:Sy;return e.test(sg(t))}function zy(t,e,r,n){if(!Mn(t))return t;e=tg(e,t)?[e]:Zy(e);for(var o=-1,i=e.length,a=i-1,c=t;c!=null&&++o<i;){var h=og(e[o]),s=r;if(o!=a){var u=c[h];s=void 0,s===void 0&&(s=Mn(u)?u:eg(e[o+1])?[]:{})}Yy(c,h,s),c=c[h]}return t}function Qy(t){if(typeof t=="string")return t;if(Bo(t))return Qs?Qs.call(t):"";var e=t+"";return e=="0"&&1/t==-hu?"-0":e}function Zy(t){return vu(t)?t:ig(t)}function ri(t,e){var r=t.__data__;return rg(e)?r[typeof e=="string"?"string":"hash"]:r.map}function gu(t,e){var r=Oy(t,e);return Xy(r)?r:void 0}function eg(t,e){return e=e??dy,!!e&&(typeof t=="number"||Ay.test(t))&&t>-1&&t%1==0&&t<e}function tg(t,e){if(vu(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||Bo(t)?!0:vy.test(t)||!my.test(t)||e!=null&&t in Object(e)}function rg(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ng(t){return!!Ys&&Ys in t}var ig=Po(function(t){t=cg(t);var e=[];return _y.test(t)&&e.push(""),t.replace(wy,function(r,n,o,i){e.push(o?i.replace(by,"$1"):n||r)}),e});function og(t){if(typeof t=="string"||Bo(t))return t;var e=t+"";return e=="0"&&1/t==-hu?"-0":e}function sg(t){if(t!=null){try{return pu.call(t)}catch{}try{return t+""}catch{}}return""}function Po(t,e){if(typeof t!="function"||e&&typeof e!="function")throw new TypeError(hy);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=t.apply(this,n);return r.cache=i.set(o,a),a};return r.cache=new(Po.Cache||Vt),r}Po.Cache=Vt;function mu(t,e){return t===e||t!==t&&e!==e}var vu=Array.isArray;function ag(t){var e=Mn(t)?yu.call(t):"";return e==py||e==yy}function Mn(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function ug(t){return!!t&&typeof t=="object"}function Bo(t){return typeof t=="symbol"||ug(t)&&yu.call(t)==gy}function cg(t){return t==null?"":Qy(t)}function fg(t,e,r){return t==null?t:zy(t,e,r)}var lg=fg;const hg=vo(lg);var dg="Expected a function",_u="__lodash_hash_undefined__",wu=1/0,pg="[object Function]",yg="[object GeneratorFunction]",gg="[object Symbol]",mg=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,vg=/^\w*$/,_g=/^\./,wg=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Eg=/[\\^$.*+?()[\]{}|]/g,bg=/\\(\\)?/g,Sg=/^\[object .+?Constructor\]$/,Ag=typeof D=="object"&&D&&D.Object===Object&&D,Ig=typeof self=="object"&&self&&self.Object===Object&&self,Do=Ag||Ig||Function("return this")();function Tg(t,e){return t==null?void 0:t[e]}function Og(t){var e=!1;if(t!=null&&typeof t.toString!="function")try{e=!!(t+"")}catch{}return e}var xg=Array.prototype,Ng=Function.prototype,Eu=Object.prototype,Zi=Do["__core-js_shared__"],Zs=function(){var t=/[^.]+$/.exec(Zi&&Zi.keys&&Zi.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),bu=Ng.toString,ni=Eu.hasOwnProperty,Su=Eu.toString,Rg=RegExp("^"+bu.call(ni).replace(Eg,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ea=Do.Symbol,Cg=xg.splice,Pg=Iu(Do,"Map"),Jr=Iu(Object,"create"),ta=ea?ea.prototype:void 0,ra=ta?ta.toString:void 0;function Kt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Bg(){this.__data__=Jr?Jr(null):{}}function Dg(t){return this.has(t)&&delete this.__data__[t]}function Lg(t){var e=this.__data__;if(Jr){var r=e[t];return r===_u?void 0:r}return ni.call(e,t)?e[t]:void 0}function Fg(t){var e=this.__data__;return Jr?e[t]!==void 0:ni.call(e,t)}function Ug(t,e){var r=this.__data__;return r[t]=Jr&&e===void 0?_u:e,this}Kt.prototype.clear=Bg;Kt.prototype.delete=Dg;Kt.prototype.get=Lg;Kt.prototype.has=Fg;Kt.prototype.set=Ug;function mr(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function kg(){this.__data__=[]}function Mg(t){var e=this.__data__,r=ii(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Cg.call(e,r,1),!0}function $g(t){var e=this.__data__,r=ii(e,t);return r<0?void 0:e[r][1]}function jg(t){return ii(this.__data__,t)>-1}function Wg(t,e){var r=this.__data__,n=ii(r,t);return n<0?r.push([t,e]):r[n][1]=e,this}mr.prototype.clear=kg;mr.prototype.delete=Mg;mr.prototype.get=$g;mr.prototype.has=jg;mr.prototype.set=Wg;function Jt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function qg(){this.__data__={hash:new Kt,map:new(Pg||mr),string:new Kt}}function Hg(t){return oi(this,t).delete(t)}function Kg(t){return oi(this,t).get(t)}function Gg(t){return oi(this,t).has(t)}function Vg(t,e){return oi(this,t).set(t,e),this}Jt.prototype.clear=qg;Jt.prototype.delete=Hg;Jt.prototype.get=Kg;Jt.prototype.has=Gg;Jt.prototype.set=Vg;function ii(t,e){for(var r=t.length;r--;)if(o0(t[r][0],e))return r;return-1}function Jg(t,e){e=Tu(e,t)?[e]:Au(e);for(var r=0,n=e.length;t!=null&&r<n;)t=t[Ou(e[r++])];return r&&r==n?t:void 0}function Yg(t){if(!Nu(t)||e0(t))return!1;var e=s0(t)||Og(t)?Rg:Sg;return e.test(n0(t))}function Xg(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),r=r>o?o:r,r<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var i=Array(o);++n<o;)i[n]=t[n+e];return i}function zg(t){if(typeof t=="string")return t;if(Fo(t))return ra?ra.call(t):"";var e=t+"";return e=="0"&&1/t==-wu?"-0":e}function Qg(t,e){e=Tu(e,t)?[e]:Au(e),t=t0(t,e);var r=Ou(i0(e));return!(t!=null&&ni.call(t,r))||delete t[r]}function Au(t){return xu(t)?t:r0(t)}function oi(t,e){var r=t.__data__;return Zg(e)?r[typeof e=="string"?"string":"hash"]:r.map}function Iu(t,e){var r=Tg(t,e);return Yg(r)?r:void 0}function Tu(t,e){if(xu(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||Fo(t)?!0:vg.test(t)||!mg.test(t)||e!=null&&t in Object(e)}function Zg(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function e0(t){return!!Zs&&Zs in t}function t0(t,e){return e.length==1?t:Jg(t,Xg(e,0,-1))}var r0=Lo(function(t){t=u0(t);var e=[];return _g.test(t)&&e.push(""),t.replace(wg,function(r,n,o,i){e.push(o?i.replace(bg,"$1"):n||r)}),e});function Ou(t){if(typeof t=="string"||Fo(t))return t;var e=t+"";return e=="0"&&1/t==-wu?"-0":e}function n0(t){if(t!=null){try{return bu.call(t)}catch{}try{return t+""}catch{}}return""}function i0(t){var e=t?t.length:0;return e?t[e-1]:void 0}function Lo(t,e){if(typeof t!="function"||e&&typeof e!="function")throw new TypeError(dg);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=t.apply(this,n);return r.cache=i.set(o,a),a};return r.cache=new(Lo.Cache||Jt),r}Lo.Cache=Jt;function o0(t,e){return t===e||t!==t&&e!==e}var xu=Array.isArray;function s0(t){var e=Nu(t)?Su.call(t):"";return e==pg||e==yg}function Nu(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function a0(t){return!!t&&typeof t=="object"}function Fo(t){return typeof t=="symbol"||a0(t)&&Su.call(t)==gg}function u0(t){return t==null?"":zg(t)}function c0(t,e){return t==null?!0:Qg(t,e)}var f0=c0;const l0=vo(f0);var $n={exports:{}};$n.exports;(function(t,e){var r=200,n="__lodash_hash_undefined__",o=9007199254740991,i="[object Arguments]",a="[object Array]",c="[object Boolean]",h="[object Date]",s="[object Error]",u="[object Function]",d="[object GeneratorFunction]",m="[object Map]",v="[object Number]",b="[object Object]",I="[object Promise]",E="[object RegExp]",A="[object Set]",_="[object String]",O="[object Symbol]",T="[object WeakMap]",B="[object ArrayBuffer]",P="[object DataView]",F="[object Float32Array]",q="[object Float64Array]",H="[object Int8Array]",oe="[object Int16Array]",$="[object Int32Array]",te="[object Uint8Array]",G="[object Uint8ClampedArray]",Ee="[object Uint16Array]",Ae="[object Uint32Array]",rt=/[\\^$.*+?()[\]{}|]/g,ne=/\w*$/,Ie=/^\[object .+?Constructor\]$/,Y=/^(?:0|[1-9]\d*)$/,L={};L[i]=L[a]=L[B]=L[P]=L[c]=L[h]=L[F]=L[q]=L[H]=L[oe]=L[$]=L[m]=L[v]=L[b]=L[E]=L[A]=L[_]=L[O]=L[te]=L[G]=L[Ee]=L[Ae]=!0,L[s]=L[u]=L[T]=!1;var Se=typeof D=="object"&&D&&D.Object===Object&&D,Qr=typeof self=="object"&&self&&self.Object===Object&&self,je=Se||Qr||Function("return this")(),vr=e&&!e.nodeType&&e,Zr=vr&&!0&&t&&!t.nodeType&&t,ai=Zr&&Zr.exports===vr;function _r(p,S){return p.set(S[0],S[1]),p}function ui(p,S){return p.add(S),p}function ci(p,S){for(var x=-1,U=p?p.length:0;++x<U&&S(p[x],x,p)!==!1;);return p}function en(p,S){for(var x=-1,U=S.length,be=p.length;++x<U;)p[be+x]=S[x];return p}function Nt(p,S,x,U){for(var be=-1,Ne=p?p.length:0;++be<Ne;)x=S(x,p[be],be,p);return x}function We(p,S){for(var x=-1,U=Array(p);++x<p;)U[x]=S(x);return U}function wr(p,S){return p==null?void 0:p[S]}function tn(p){var S=!1;if(p!=null&&typeof p.toString!="function")try{S=!!(p+"")}catch{}return S}function y(p){var S=-1,x=Array(p.size);return p.forEach(function(U,be){x[++S]=[be,U]}),x}function f(p,S){return function(x){return p(S(x))}}function l(p){var S=-1,x=Array(p.size);return p.forEach(function(U){x[++S]=U}),x}var g=Array.prototype,w=Function.prototype,N=Object.prototype,R=je["__core-js_shared__"],V=function(){var p=/[^.]+$/.exec(R&&R.keys&&R.keys.IE_PROTO||"");return p?"Symbol(src)_1."+p:""}(),Q=w.toString,X=N.hasOwnProperty,he=N.toString,ae=RegExp("^"+Q.call(X).replace(rt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rt=ai?je.Buffer:void 0,Er=je.Symbol,br=je.Uint8Array,Bu=f(Object.getPrototypeOf,Object),Du=Object.create,Lu=N.propertyIsEnumerable,Fu=g.splice,ko=Object.getOwnPropertySymbols,Uu=Rt?Rt.isBuffer:void 0,ku=f(Object.keys,Object),fi=zt(je,"DataView"),Sr=zt(je,"Map"),li=zt(je,"Promise"),hi=zt(je,"Set"),di=zt(je,"WeakMap"),Ar=zt(Object,"create"),Mu=Bt(fi),$u=Bt(Sr),ju=Bt(li),Wu=Bt(hi),qu=Bt(di),Mo=Er?Er.prototype:void 0,$o=Mo?Mo.valueOf:void 0;function Ct(p){var S=-1,x=p?p.length:0;for(this.clear();++S<x;){var U=p[S];this.set(U[0],U[1])}}function Hu(){this.__data__=Ar?Ar(null):{}}function Ku(p){return this.has(p)&&delete this.__data__[p]}function Gu(p){var S=this.__data__;if(Ar){var x=S[p];return x===n?void 0:x}return X.call(S,p)?S[p]:void 0}function Vu(p){var S=this.__data__;return Ar?S[p]!==void 0:X.call(S,p)}function Ju(p,S){var x=this.__data__;return x[p]=Ar&&S===void 0?n:S,this}Ct.prototype.clear=Hu,Ct.prototype.delete=Ku,Ct.prototype.get=Gu,Ct.prototype.has=Vu,Ct.prototype.set=Ju;function lt(p){var S=-1,x=p?p.length:0;for(this.clear();++S<x;){var U=p[S];this.set(U[0],U[1])}}function Yu(){this.__data__=[]}function Xu(p){var S=this.__data__,x=rn(S,p);if(x<0)return!1;var U=S.length-1;return x==U?S.pop():Fu.call(S,x,1),!0}function zu(p){var S=this.__data__,x=rn(S,p);return x<0?void 0:S[x][1]}function Qu(p){return rn(this.__data__,p)>-1}function Zu(p,S){var x=this.__data__,U=rn(x,p);return U<0?x.push([p,S]):x[U][1]=S,this}lt.prototype.clear=Yu,lt.prototype.delete=Xu,lt.prototype.get=zu,lt.prototype.has=Qu,lt.prototype.set=Zu;function Yt(p){var S=-1,x=p?p.length:0;for(this.clear();++S<x;){var U=p[S];this.set(U[0],U[1])}}function ec(){this.__data__={hash:new Ct,map:new(Sr||lt),string:new Ct}}function tc(p){return nn(this,p).delete(p)}function rc(p){return nn(this,p).get(p)}function nc(p){return nn(this,p).has(p)}function ic(p,S){return nn(this,p).set(p,S),this}Yt.prototype.clear=ec,Yt.prototype.delete=tc,Yt.prototype.get=rc,Yt.prototype.has=nc,Yt.prototype.set=ic;function Xt(p){this.__data__=new lt(p)}function oc(){this.__data__=new lt}function sc(p){return this.__data__.delete(p)}function ac(p){return this.__data__.get(p)}function uc(p){return this.__data__.has(p)}function cc(p,S){var x=this.__data__;if(x instanceof lt){var U=x.__data__;if(!Sr||U.length<r-1)return U.push([p,S]),this;x=this.__data__=new Yt(U)}return x.set(p,S),this}Xt.prototype.clear=oc,Xt.prototype.delete=sc,Xt.prototype.get=ac,Xt.prototype.has=uc,Xt.prototype.set=cc;function fc(p,S){var x=gi(p)||Dc(p)?We(p.length,String):[],U=x.length,be=!!U;for(var Ne in p)X.call(p,Ne)&&!(be&&(Ne=="length"||Rc(Ne,U)))&&x.push(Ne);return x}function jo(p,S,x){var U=p[S];(!(X.call(p,S)&&Ko(U,x))||x===void 0&&!(S in p))&&(p[S]=x)}function rn(p,S){for(var x=p.length;x--;)if(Ko(p[x][0],S))return x;return-1}function lc(p,S){return p&&Wo(S,mi(S),p)}function pi(p,S,x,U,be,Ne,ht){var Re;if(U&&(Re=Ne?U(p,be,Ne,ht):U(p)),Re!==void 0)return Re;if(!on(p))return p;var Jo=gi(p);if(Jo){if(Re=Oc(p),!S)return Ac(p,Re)}else{var Qt=Pt(p),Yo=Qt==u||Qt==d;if(Fc(p))return mc(p,S);if(Qt==b||Qt==i||Yo&&!Ne){if(tn(p))return Ne?p:{};if(Re=xc(Yo?{}:p),!S)return Ic(p,lc(Re,p))}else{if(!L[Qt])return Ne?p:{};Re=Nc(p,Qt,pi,S)}}ht||(ht=new Xt);var Xo=ht.get(p);if(Xo)return Xo;if(ht.set(p,Re),!Jo)var zo=x?Tc(p):mi(p);return ci(zo||p,function(vi,sn){zo&&(sn=vi,vi=p[sn]),jo(Re,sn,pi(vi,S,x,U,sn,p,ht))}),Re}function hc(p){return on(p)?Du(p):{}}function dc(p,S,x){var U=S(p);return gi(p)?U:en(U,x(p))}function pc(p){return he.call(p)}function yc(p){if(!on(p)||Pc(p))return!1;var S=Vo(p)||tn(p)?ae:Ie;return S.test(Bt(p))}function gc(p){if(!Ho(p))return ku(p);var S=[];for(var x in Object(p))X.call(p,x)&&x!="constructor"&&S.push(x);return S}function mc(p,S){if(S)return p.slice();var x=new p.constructor(p.length);return p.copy(x),x}function yi(p){var S=new p.constructor(p.byteLength);return new br(S).set(new br(p)),S}function vc(p,S){var x=S?yi(p.buffer):p.buffer;return new p.constructor(x,p.byteOffset,p.byteLength)}function _c(p,S,x){var U=S?x(y(p),!0):y(p);return Nt(U,_r,new p.constructor)}function wc(p){var S=new p.constructor(p.source,ne.exec(p));return S.lastIndex=p.lastIndex,S}function Ec(p,S,x){var U=S?x(l(p),!0):l(p);return Nt(U,ui,new p.constructor)}function bc(p){return $o?Object($o.call(p)):{}}function Sc(p,S){var x=S?yi(p.buffer):p.buffer;return new p.constructor(x,p.byteOffset,p.length)}function Ac(p,S){var x=-1,U=p.length;for(S||(S=Array(U));++x<U;)S[x]=p[x];return S}function Wo(p,S,x,U){x||(x={});for(var be=-1,Ne=S.length;++be<Ne;){var ht=S[be],Re=void 0;jo(x,ht,Re===void 0?p[ht]:Re)}return x}function Ic(p,S){return Wo(p,qo(p),S)}function Tc(p){return dc(p,mi,qo)}function nn(p,S){var x=p.__data__;return Cc(S)?x[typeof S=="string"?"string":"hash"]:x.map}function zt(p,S){var x=wr(p,S);return yc(x)?x:void 0}var qo=ko?f(ko,Object):Mc,Pt=pc;(fi&&Pt(new fi(new ArrayBuffer(1)))!=P||Sr&&Pt(new Sr)!=m||li&&Pt(li.resolve())!=I||hi&&Pt(new hi)!=A||di&&Pt(new di)!=T)&&(Pt=function(p){var S=he.call(p),x=S==b?p.constructor:void 0,U=x?Bt(x):void 0;if(U)switch(U){case Mu:return P;case $u:return m;case ju:return I;case Wu:return A;case qu:return T}return S});function Oc(p){var S=p.length,x=p.constructor(S);return S&&typeof p[0]=="string"&&X.call(p,"index")&&(x.index=p.index,x.input=p.input),x}function xc(p){return typeof p.constructor=="function"&&!Ho(p)?hc(Bu(p)):{}}function Nc(p,S,x,U){var be=p.constructor;switch(S){case B:return yi(p);case c:case h:return new be(+p);case P:return vc(p,U);case F:case q:case H:case oe:case $:case te:case G:case Ee:case Ae:return Sc(p,U);case m:return _c(p,U,x);case v:case _:return new be(p);case E:return wc(p);case A:return Ec(p,U,x);case O:return bc(p)}}function Rc(p,S){return S=S??o,!!S&&(typeof p=="number"||Y.test(p))&&p>-1&&p%1==0&&p<S}function Cc(p){var S=typeof p;return S=="string"||S=="number"||S=="symbol"||S=="boolean"?p!=="__proto__":p===null}function Pc(p){return!!V&&V in p}function Ho(p){var S=p&&p.constructor,x=typeof S=="function"&&S.prototype||N;return p===x}function Bt(p){if(p!=null){try{return Q.call(p)}catch{}try{return p+""}catch{}}return""}function Bc(p){return pi(p,!0,!0)}function Ko(p,S){return p===S||p!==p&&S!==S}function Dc(p){return Lc(p)&&X.call(p,"callee")&&(!Lu.call(p,"callee")||he.call(p)==i)}var gi=Array.isArray;function Go(p){return p!=null&&Uc(p.length)&&!Vo(p)}function Lc(p){return kc(p)&&Go(p)}var Fc=Uu||$c;function Vo(p){var S=on(p)?he.call(p):"";return S==u||S==d}function Uc(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=o}function on(p){var S=typeof p;return!!p&&(S=="object"||S=="function")}function kc(p){return!!p&&typeof p=="object"}function mi(p){return Go(p)?fc(p):gc(p)}function Mc(){return[]}function $c(){return!1}t.exports=Bc})($n,$n.exports);var h0=$n.exports;const d0=vo(h0);function ur(t){return t===void 0&&(t=""),(t?t+"_":"")+ +new Date+"_"+Math.random()}var p0=function(){function t(e){this.close=e.close,this.onChange=e.onChange,this.onError=e.onError,e.debug&&Object.defineProperty(this,"virtualClient",{get:function(){return e.virtualClient}})}return t}(),na=function(){function t(e){var r=e.id,n=e.docChanges,o=e.docs,i=e.msgType,a=e.type,c,h;Object.defineProperties(this,{id:{get:function(){return r},enumerable:!0},docChanges:{get:function(){return c||(c=JSON.parse(JSON.stringify(n))),c},enumerable:!0},docs:{get:function(){return h||(h=JSON.parse(JSON.stringify(o))),h},enumerable:!0},msgType:{get:function(){return i},enumerable:!0},type:{get:function(){return a},enumerable:!0}})}return t}(),si=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)o.hasOwnProperty(i)&&(n[i]=o[i])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),y0=function(t){si(e,t);function e(r){var n=t.call(this,"Watch Error "+JSON.stringify(r.msgData)+" (requestid: "+r.requestId+")")||this;return n.isRealtimeErrorMessageError=!0,n.payload=r,n}return e}(Error),ia=function(t){return t==null?void 0:t.isRealtimeErrorMessageError},g0=function(t){si(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.type="timeout",r.payload=null,r.generic=!0,r}return e}(Error),m0=function(t){return t.type==="timeout"},v0=function(t){si(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.type="cancelled",r.payload=null,r.generic=!0,r}return e}(Error),_0=function(t){return t.type==="cancelled"},Je=function(t){si(e,t);function e(r){var n=t.call(this,r.errMsg)||this;return n.errCode="UNKNOWN_ERROR",Object.defineProperties(n,{message:{get:function(){return"errCode: "+this.errCode+" "+(Be[this.errCode]||"")+" | errMsg: "+this.errMsg},set:function(o){this.errMsg=o}}}),n.errCode=r.errCode||"UNKNOWN_ERROR",n.errMsg=r.errMsg,n}return Object.defineProperty(e.prototype,"message",{get:function(){return"errCode: "+this.errCode+" | errMsg: "+this.errMsg},set:function(r){this.errMsg=r},enumerable:!1,configurable:!0}),e}(Error),Be={UNKNOWN_ERROR:"UNKNOWN_ERROR",SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG:"SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG",SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA:"SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED",SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL",SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR:"SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR"},mo=function(t){return t===void 0&&(t=0),new Promise(function(e){return setTimeout(e,t)})},Le=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},Ce=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},oa=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)n[o]=i[a];return n},ie;(function(t){t.LOGGINGIN="LOGGINGIN",t.INITING="INITING",t.REBUILDING="REBUILDING",t.ACTIVE="ACTIVE",t.ERRORED="ERRORED",t.CLOSING="CLOSING",t.CLOSED="CLOSED",t.PAUSED="PAUSED",t.RESUMING="RESUMING"})(ie||(ie={}));var w0=100,wn=2,E0=2,b0=10*1e3,S0=10*1e3,A0=10*1e3,I0=function(){function t(e){var r=this;this.watchStatus=ie.INITING,this._login=function(n,o){return Le(r,void 0,void 0,function(){var i;return Ce(this,function(a){switch(a.label){case 0:return this.watchStatus=ie.LOGGINGIN,[4,this.login(n,o)];case 1:return i=a.sent(),this.envId||(this.envId=i.envId),[2,i]}})})},this.initWatch=function(n){return Le(r,void 0,void 0,function(){var o,i=this;return Ce(this,function(a){switch(a.label){case 0:if(this._initWatchPromise)return[2,this._initWatchPromise];this._initWatchPromise=new Promise(function(c,h){return Le(i,void 0,void 0,function(){var s,u,d,m,v,b,I,E,A,_,O;return Ce(this,function(T){switch(T.label){case 0:return T.trys.push([0,3,,4]),this.watchStatus===ie.PAUSED?(console.log("[realtime] initWatch cancelled on pause"),[2,c()]):[4,this._login(this.envId,n)];case 1:return s=T.sent().envId,this.watchStatus===ie.PAUSED?(console.log("[realtime] initWatch cancelled on pause"),[2,c()]):(this.watchStatus=ie.INITING,u={watchId:this.watchId,requestId:ur(),msgType:"INIT_WATCH",msgData:{envId:s,collName:this.collectionName,query:this.query,limit:this.limit,orderBy:this.orderBy}},[4,this.send({msg:u,waitResponse:!0,skipOnMessage:!0,timeout:S0})]);case 2:if(d=T.sent(),m=d.msgData,v=m.events,b=m.currEvent,this.sessionInfo={queryID:d.msgData.queryID,currentEventId:b-1,currentDocs:[]},v.length>0){for(I=0,E=v;I<E.length;I++)A=E[I],A.ID=b;this.handleServerEvents(d)}else this.sessionInfo.currentEventId=b,_=new na({id:b,docChanges:[],docs:[],type:"init"}),this.listener.onChange(_),this.scheduleSendACK();return this.onWatchStart(this,this.sessionInfo.queryID),this.watchStatus=ie.ACTIVE,this._availableRetries.INIT_WATCH=wn,c(),[3,4];case 3:return O=T.sent(),this.handleWatchEstablishmentError(O,{operationName:"INIT_WATCH",resolve:c,reject:h}),[3,4];case 4:return[2]}})})}),o=!1,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this._initWatchPromise];case 2:return a.sent(),o=!0,[3,4];case 3:return this._initWatchPromise=void 0,[7];case 4:return console.log("[realtime] initWatch "+(o?"success":"fail")),[2]}})})},this.rebuildWatch=function(n){return Le(r,void 0,void 0,function(){var o,i=this;return Ce(this,function(a){switch(a.label){case 0:if(this._rebuildWatchPromise)return[2,this._rebuildWatchPromise];this._rebuildWatchPromise=new Promise(function(c,h){return Le(i,void 0,void 0,function(){var s,u,d,m;return Ce(this,function(v){switch(v.label){case 0:return v.trys.push([0,3,,4]),this.watchStatus===ie.PAUSED?(console.log("[realtime] rebuildWatch cancelled on pause"),[2,c()]):[4,this._login(this.envId,n)];case 1:if(s=v.sent().envId,!this.sessionInfo)throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)");return this.watchStatus===ie.PAUSED?(console.log("[realtime] rebuildWatch cancelled on pause"),[2,c()]):(this.watchStatus=ie.REBUILDING,u={watchId:this.watchId,requestId:ur(),msgType:"REBUILD_WATCH",msgData:{envId:s,collName:this.collectionName,queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:u,waitResponse:!0,skipOnMessage:!1,timeout:A0})]);case 2:return d=v.sent(),this.handleServerEvents(d),this.watchStatus=ie.ACTIVE,this._availableRetries.REBUILD_WATCH=wn,c(),[3,4];case 3:return m=v.sent(),this.handleWatchEstablishmentError(m,{operationName:"REBUILD_WATCH",resolve:c,reject:h}),[3,4];case 4:return[2]}})})}),o=!1,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this._rebuildWatchPromise];case 2:return a.sent(),o=!0,[3,4];case 3:return this._rebuildWatchPromise=void 0,[7];case 4:return console.log("[realtime] rebuildWatch "+(o?"success":"fail")),[2]}})})},this.handleWatchEstablishmentError=function(n,o){return Le(r,void 0,void 0,function(){var i,a,c,h=this;return Ce(this,function(s){return i=o.operationName==="INIT_WATCH",a=function(){h.closeWithError(new Je({errCode:i?Be.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:Be.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:n})),o.reject(n)},c=function(u){h.useRetryTicket(o.operationName)?i?(h._initWatchPromise=void 0,o.resolve(h.initWatch(u))):(h._rebuildWatchPromise=void 0,o.resolve(h.rebuildWatch(u))):a()},this.handleCommonError(n,{onSignError:function(){return c(!0)},onTimeoutError:function(){return c(!1)},onNotRetryableError:a,onCancelledError:o.reject,onUnknownError:function(){return Le(h,void 0,void 0,function(){var u,d=this;return Ce(this,function(m){switch(m.label){case 0:return m.trys.push([0,8,,9]),u=function(){return Le(d,void 0,void 0,function(){return Ce(this,function(v){switch(v.label){case 0:return this.pause(),[4,this.onceWSConnected()];case 1:return v.sent(),c(!0),[2]}})})},this.isWSConnected()?[3,2]:[4,u()];case 1:return m.sent(),[3,7];case 2:return[4,mo(w0)];case 3:return m.sent(),this.watchStatus!==ie.PAUSED?[3,4]:(o.reject(new v0(o.operationName+" cancelled due to pause after unknownError")),[3,7]);case 4:return this.isWSConnected()?[3,6]:[4,u()];case 5:return m.sent(),[3,7];case 6:c(!1),m.label=7;case 7:return[3,9];case 8:return m.sent(),c(!0),[3,9];case 9:return[2]}})})}}),[2]})})},this.closeWatch=function(){return Le(r,void 0,void 0,function(){var n,o,i;return Ce(this,function(a){switch(a.label){case 0:if(n=this.sessionInfo?this.sessionInfo.queryID:"",this.watchStatus!==ie.ACTIVE)return this.watchStatus=ie.CLOSED,this.onWatchClose(this,n),[2];a.label=1;case 1:return a.trys.push([1,3,4,5]),this.watchStatus=ie.CLOSING,o={watchId:this.watchId,requestId:ur(),msgType:"CLOSE_WATCH",msgData:null},[4,this.send({msg:o})];case 2:return a.sent(),this.sessionInfo=void 0,this.watchStatus=ie.CLOSED,[3,5];case 3:return i=a.sent(),this.closeWithError(new Je({errCode:Be.SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL,errMsg:i})),[3,5];case 4:return this.onWatchClose(this,n),[7];case 5:return[2]}})})},this.scheduleSendACK=function(){r.clearACKSchedule(),r._ackTimeoutId=setTimeout(function(){r._waitExpectedTimeoutId?r.scheduleSendACK():r.sendACK()},b0)},this.clearACKSchedule=function(){r._ackTimeoutId&&clearTimeout(r._ackTimeoutId)},this.sendACK=function(){return Le(r,void 0,void 0,function(){var n,o,i;return Ce(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),this.watchStatus!==ie.ACTIVE?(this.scheduleSendACK(),[2]):this.sessionInfo?(n={watchId:this.watchId,requestId:ur(),msgType:"CHECK_LAST",msgData:{queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:n})]):(console.warn("[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)"),[2]);case 1:return a.sent(),this.scheduleSendACK(),[3,3];case 2:if(o=a.sent(),ia(o))switch(i=o.payload,i.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return this.rebuildWatch(),[2];case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return this.closeWithError(new Je({errCode:Be.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:i.msgData.code})),[2]}return this._availableRetries.CHECK_LAST&&this._availableRetries.CHECK_LAST>0?(this._availableRetries.CHECK_LAST--,this.scheduleSendACK()):this.closeWithError(new Je({errCode:Be.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:o})),[3,3];case 3:return[2]}})})},this.handleCommonError=function(n,o){if(ia(n)){var i=n.payload;switch(i.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":{o.onSignError(n);return}case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":{o.onNotRetryableError(n);return}default:{o.onNotRetryableError(n);return}}}else if(m0(n)){o.onTimeoutError(n);return}else if(_0(n)){o.onCancelledError(n);return}o.onUnknownError(n)},this.watchId="watchid_"+ +new Date+"_"+Math.random(),this.envId=e.envId,this.collectionName=e.collectionName,this.query=e.query,this.limit=e.limit,this.orderBy=e.orderBy,this.send=e.send,this.login=e.login,this.isWSConnected=e.isWSConnected,this.onceWSConnected=e.onceWSConnected,this.getWaitExpectedTimeoutLength=e.getWaitExpectedTimeoutLength,this.onWatchStart=e.onWatchStart,this.onWatchClose=e.onWatchClose,this.debug=e.debug,this._availableRetries={INIT_WATCH:wn,REBUILD_WATCH:wn,CHECK_LAST:E0},this.listener=new p0({close:this.closeWatch,onChange:e.onChange,onError:e.onError,debug:this.debug,virtualClient:this}),this.initWatch()}return t.prototype.onMessage=function(e){var r=this;switch(this.watchStatus){case ie.PAUSED:{if(e.msgType!=="ERROR")return;break}case ie.LOGGINGIN:case ie.INITING:case ie.REBUILDING:{console.warn("[realtime listener] internal non-fatal error: unexpected message received while "+this.watchStatus);return}case ie.CLOSED:{console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has closed");return}case ie.ERRORED:{console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has ended with error");return}}if(!this.sessionInfo){console.warn("[realtime listener] internal non-fatal error: sessionInfo not found while message is received.");return}switch(this.scheduleSendACK(),e.msgType){case"NEXT_EVENT":{console.warn("nextevent "+e.msgData.currEvent+" ignored",e),this.handleServerEvents(e);break}case"CHECK_EVENT":{this.sessionInfo.currentEventId<e.msgData.currEvent&&(this.sessionInfo.expectEventId=e.msgData.currEvent,this.clearWaitExpectedEvent(),this._waitExpectedTimeoutId=setTimeout(function(){r.rebuildWatch()},this.getWaitExpectedTimeoutLength()),console.log("[realtime] waitExpectedTimeoutLength "+this.getWaitExpectedTimeoutLength()));break}case"ERROR":{this.closeWithError(new Je({errCode:Be.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,errMsg:e.msgData.code+" - "+e.msgData.message}));break}default:{console.warn("[realtime listener] virtual client receive unexpected msg "+e.msgType+": ",e);break}}},t.prototype.closeWithError=function(e){this.watchStatus=ie.ERRORED,this.clearACKSchedule(),this.listener.onError(e),this.onWatchClose(this,this.sessionInfo&&this.sessionInfo.queryID||""),console.log("[realtime] client closed ("+this.collectionName+" "+this.query+") (watchId "+this.watchId+")")},t.prototype.pause=function(){this.watchStatus=ie.PAUSED,console.log("[realtime] client paused ("+this.collectionName+" "+this.query+") (watchId "+this.watchId+")")},t.prototype.resume=function(){return Le(this,void 0,void 0,function(){var e;return Ce(this,function(r){switch(r.label){case 0:this.watchStatus=ie.RESUMING,console.log("[realtime] client resuming with "+(this.sessionInfo?"REBUILD_WATCH":"INIT_WATCH")+" ("+this.collectionName+" "+this.query+") ("+this.watchId+")"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.sessionInfo?this.rebuildWatch():this.initWatch()];case 2:return r.sent(),console.log("[realtime] client successfully resumed ("+this.collectionName+" "+this.query+") ("+this.watchId+")"),[3,4];case 3:return e=r.sent(),console.error("[realtime] client resume failed ("+this.collectionName+" "+this.query+") ("+this.watchId+")",e),[3,4];case 4:return[2]}})})},t.prototype.useRetryTicket=function(e){return this._availableRetries[e]&&this._availableRetries[e]>0?(this._availableRetries[e]--,console.log("[realtime] "+e+" use a retry ticket, now only "+this._availableRetries[e]+" retry left"),!0):!1},t.prototype.handleServerEvents=function(e){return Le(this,void 0,void 0,function(){var r;return Ce(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this.scheduleSendACK(),[4,this._handleServerEvents(e)];case 1:return n.sent(),this._postHandleServerEventsValidityCheck(e),[3,3];case 2:throw r=n.sent(),console.error("[realtime listener] internal non-fatal error: handle server events failed with error: ",r),r;case 3:return[2]}})})},t.prototype._handleServerEvents=function(e){return Le(this,void 0,void 0,function(){var r,n,o,i,a,c,h,s,u,d,m,v;return Ce(this,function(b){switch(b.label){case 0:if(r=e.requestId,n=e.msgData.events,o=e.msgType,!n.length||!this.sessionInfo)return[2];i=this.sessionInfo;try{a=n.map(T0)}catch(I){return this.closeWithError(new Je({errCode:Be.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,errMsg:I})),[2]}c=oa(i.currentDocs),h=!1,s=function(I,E){var A,_,P,B,O,T,B,F,F,P,P,F,q,q,H,oe,$;return Ce(this,function(te){switch(te.label){case 0:return A=a[I],i.currentEventId>=A.id?(!a[I-1]||A.id>a[I-1].id?console.warn("[realtime] duplicate event received, cur "+i.currentEventId+" but got "+A.id):console.error("[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId "+r+")"),[2,"continue"]):[3,1];case 1:if(i.currentEventId!==A.id-1)return[3,2];switch(A.dataType){case"update":{if(!A.doc)switch(A.queueType){case"update":case"dequeue":{if(_=c.find(function(G){return G._id===A.docId}),_){if(P=d0(_),A.updatedFields)for(B in A.updatedFields)hg(P,B,A.updatedFields[B]);if(A.removedFields)for(O=0,T=A.removedFields;O<T.length;O++)B=T[O],l0(P,B);A.doc=P}else console.error("[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated.");break}case"enqueue":throw F=new Je({errCode:Be.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId '+e.requestId+")"}),u.closeWithError(F),F}break}case"replace":{if(!A.doc)throw F=new Je({errCode:Be.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="replace" (requestId '+e.requestId+")"}),u.closeWithError(F),F;break}case"remove":{P=c.find(function(G){return G._id===A.docId}),P?A.doc=P:console.error("[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated.");break}case"limit":{if(!A.doc)switch(A.queueType){case"dequeue":{P=c.find(function(G){return G._id===A.docId}),P?A.doc=P:console.error("[realtime listener] internal non-fatal server error: unexpected limit dataType event where no doc is associated.");break}case"enqueue":throw F=new Je({errCode:Be.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="limit" and queueType="enqueue" (requestId '+e.requestId+")"}),u.closeWithError(F),F}break}}switch(A.queueType){case"init":{h?c.push(A.doc):(h=!0,c=[A.doc]);break}case"enqueue":{c.push(A.doc);break}case"dequeue":{q=c.findIndex(function(G){return G._id===A.docId}),q>-1?c.splice(q,1):console.error("[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated.");break}case"update":{q=c.findIndex(function(G){return G._id===A.docId}),q>-1?c[q]=A.doc:console.error("[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated.");break}}return(I===E-1||a[I+1]&&a[I+1].id!==A.id)&&(H=oa(c),oe=a.slice(0,I+1).filter(function(G){return G.id===A.id}),u.sessionInfo.currentEventId=A.id,u.sessionInfo.currentDocs=c,$=new na({id:A.id,docChanges:oe,docs:H,msgType:o}),u.listener.onChange($)),[3,4];case 2:return console.warn("[realtime listener] event received is out of order, cur "+u.sessionInfo.currentEventId+" but got "+A.id),[4,u.rebuildWatch()];case 3:return te.sent(),[2,{value:void 0}];case 4:return[2]}})},u=this,d=0,m=a.length,b.label=1;case 1:return d<m?[5,s(d,m)]:[3,4];case 2:if(v=b.sent(),typeof v=="object")return[2,v.value];b.label=3;case 3:return d++,[3,1];case 4:return[2]}})})},t.prototype._postHandleServerEventsValidityCheck=function(e){if(!this.sessionInfo){console.error("[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur");return}if(this.sessionInfo.expectEventId&&this.sessionInfo.currentEventId>=this.sessionInfo.expectEventId&&this.clearWaitExpectedEvent(),this.sessionInfo.currentEventId<e.msgData.currEvent){console.warn("[realtime listener] internal non-fatal error: client eventId does not match with server event id after server event handling");return}},t.prototype.clearWaitExpectedEvent=function(){this._waitExpectedTimeoutId&&(clearTimeout(this._waitExpectedTimeoutId),this._waitExpectedTimeoutId=void 0)},t}();function T0(t){var e={id:t.ID,dataType:t.DataType,queueType:t.QueueType,docId:t.DocID,doc:t.Doc&&t.Doc!=="{}"?JSON.parse(t.Doc):void 0};return t.DataType==="update"&&(t.UpdatedFields&&(e.updatedFields=JSON.parse(t.UpdatedFields)),(t.removedFields||t.RemovedFields)&&(e.removedFields=JSON.parse(t.removedFields))),e}var Ru={1e3:{code:1e3,name:"Normal Closure",description:"Normal closure; the connection successfully completed whatever purpose for which it was created."},1001:{code:1001,name:"Going Away",description:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{code:1002,name:"Protocol Error",description:"The endpoint is terminating the connection due to a protocol error."},1003:{code:1003,name:"Unsupported Data",description:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."},1005:{code:1005,name:"No Status Received",description:"Indicates that no status code was provided even though one was expected."},1006:{code:1006,name:"Abnormal Closure",description:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{code:1007,name:"Invalid frame payload data",description:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{code:1008,name:"Policy Violation",description:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{code:1009,name:"Message too big",description:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{code:1010,name:"Missing Extension",description:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{code:1011,name:"Internal Error",description:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{code:1012,name:"Service Restart",description:"The server is terminating the connection because it is restarting."},1013:{code:1013,name:"Try Again Later",description:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{code:1014,name:"Bad Gateway",description:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{code:1015,name:"TLS Handshake",description:"Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},3e3:{code:3e3,name:"Reconnect WebSocket",description:"The client is terminating the connection because it wants to reconnect"},3001:{code:3001,name:"No Realtime Listeners",description:"The client is terminating the connection because no more realtime listeners exist"},3002:{code:3002,name:"Heartbeat Ping Error",description:"The client is terminating the connection due to its failure in sending heartbeat messages"},3003:{code:3003,name:"Heartbeat Pong Timeout Error",description:"The client is terminating the connection because no heartbeat response is received from the server"},3050:{code:3050,name:"Server Close",description:"The client is terminating the connection because no heartbeat response is received from the server"}},Ge;(function(t){t[t.NormalClosure=1e3]="NormalClosure",t[t.GoingAway=1001]="GoingAway",t[t.ProtocolError=1002]="ProtocolError",t[t.UnsupportedData=1003]="UnsupportedData",t[t.NoStatusReceived=1005]="NoStatusReceived",t[t.AbnormalClosure=1006]="AbnormalClosure",t[t.InvalidFramePayloadData=1007]="InvalidFramePayloadData",t[t.PolicyViolation=1008]="PolicyViolation",t[t.MessageTooBig=1009]="MessageTooBig",t[t.MissingExtension=1010]="MissingExtension",t[t.InternalError=1011]="InternalError",t[t.ServiceRestart=1012]="ServiceRestart",t[t.TryAgainLater=1013]="TryAgainLater",t[t.BadGateway=1014]="BadGateway",t[t.TLSHandshake=1015]="TLSHandshake",t[t.ReconnectWebSocket=3e3]="ReconnectWebSocket",t[t.NoRealtimeListeners=3001]="NoRealtimeListeners",t[t.HeartbeatPingError=3002]="HeartbeatPingError",t[t.HeartbeatPongTimeoutError=3003]="HeartbeatPongTimeoutError",t[t.NoAuthentication=3050]="NoAuthentication"})(Ge||(Ge={}));var eo=function(t,e){var r=Ru[t],n=r?r.name+", code "+t+", reason "+(e||r.description):"code "+t;return new Je({errCode:Be.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,errMsg:n})},Cu=null,Pu="web";function O0(){return Cu}function x0(t){Cu=t}function sa(){return Pu}function N0(t){Pu=t}var jn=function(){return jn=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},jn.apply(this,arguments)},Qe=function(t,e,r,n){function o(i){return i instanceof r?i:new r(function(a){a(i)})}return new(r||(r=Promise))(function(i,a){function c(u){try{s(n.next(u))}catch(d){a(d)}}function h(u){try{s(n.throw(u))}catch(d){a(d)}}function s(u){u.done?i(u.value):o(u.value).then(c,h)}s((n=n.apply(t,e||[])).next())})},Ze=function(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(s){return function(u){return h([s,u])}}function h(s){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=s[0]&2?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[s[0]&2,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(s[0]===6&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(u){s=[6,u],o=0}finally{n=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},to={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},aa=3,R0=5e3,C0=1e4,P0=5,B0=1e4,D0=2,L0=2,F0=5e3,U0=function(){function t(e){var r=this;this._virtualWSClient=new Set,this._queryIdClientMap=new Map,this._watchIdClientMap=new Map,this._pingFailed=0,this._pongMissed=0,this._logins=new Map,this._wsReadySubsribers=[],this._wsResponseWait=new Map,this._rttObserved=[],this.send=function(n){return Qe(r,void 0,void 0,function(){var o=this;return Ze(this,function(i){return[2,new Promise(function(a,c){return Qe(o,void 0,void 0,function(){var h,s,u,d,m,v,b,I=this;return Ze(this,function(E){switch(E.label){case 0:s=!1,u=!1,d=function(A){s=!0,h&&clearTimeout(h),a(A)},m=function(A){u=!0,h&&clearTimeout(h),c(A)},n.timeout&&(h=setTimeout(function(){return Qe(I,void 0,void 0,function(){return Ze(this,function(A){switch(A.label){case 0:return!s||!u?[4,mo(0)]:[3,2];case 1:A.sent(),(!s||!u)&&m(new g0("wsclient.send timedout")),A.label=2;case 2:return[2]}})})},n.timeout)),E.label=1;case 1:return E.trys.push([1,8,,9]),this._wsInitPromise?[4,this._wsInitPromise]:[3,3];case 2:E.sent(),E.label=3;case 3:if(!this._ws)return m(new Error("invalid state: ws connection not exists, can not send message")),[2];if(this._ws.readyState!==to.OPEN)return m(new Error("ws readyState invalid: "+this._ws.readyState+", can not send message")),[2];n.waitResponse&&this._wsResponseWait.set(n.msg.requestId,{resolve:d,reject:m,skipOnMessage:n.skipOnMessage}),E.label=4;case 4:return E.trys.push([4,6,,7]),[4,this._ws.send(JSON.stringify(n.msg))];case 5:return E.sent(),n.waitResponse||d(),[3,7];case 6:return v=E.sent(),v&&(m(v),n.waitResponse&&this._wsResponseWait.delete(n.msg.requestId)),[3,7];case 7:return[3,9];case 8:return b=E.sent(),m(b),[3,9];case 9:return[2]}})})})]})})},this.closeAllClients=function(n){r._virtualWSClient.forEach(function(o){o.closeWithError(n)})},this.pauseClients=function(n){(n||r._virtualWSClient).forEach(function(o){o.pause()})},this.resumeClients=function(n){(n||r._virtualWSClient).forEach(function(o){o.resume()})},this.initWebSocketConnection=function(n,o){return o===void 0&&(o=r._maxReconnect),Qe(r,void 0,void 0,function(){var i=this;return Ze(this,function(a){switch(a.label){case 0:if(n&&this._reconnectState)return[2];if(n&&(this._reconnectState=!0),this._wsInitPromise)return[2,this._wsInitPromise];n&&this.pauseClients(),this.close(Ge.ReconnectWebSocket),this._wsInitPromise=new Promise(function(c,h){return Qe(i,void 0,void 0,function(){var s,u,d,m=this;return Ze(this,function(v){switch(v.label){case 0:return v.trys.push([0,6,,11]),[4,this.getWsSign()];case 1:return s=v.sent(),[4,new Promise(function(b){var I=s.wsUrl||"wss://tcb-ws.tencentcloudapi.com",E=O0();m._ws=E?new E(I):new WebSocket(I),b()})];case 2:return v.sent(),this._ws.connect?[4,this._ws.connect()]:[3,4];case 3:v.sent(),v.label=4;case 4:return[4,this.initWebSocketEvent()];case 5:return v.sent(),c(),n&&(this.resumeClients(),this._reconnectState=!1),[3,11];case 6:return u=v.sent(),console.error("[realtime] initWebSocketConnection connect fail",u),o>0?(d=!0,this._wsInitPromise=void 0,d?[4,mo(this._reconnectInterval)]:[3,8]):[3,9];case 7:v.sent(),n&&(this._reconnectState=!1),v.label=8;case 8:return c(this.initWebSocketConnection(n,o-1)),[3,10];case 9:h(u),n&&this.closeAllClients(new Je({errCode:Be.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL,errMsg:u})),v.label=10;case 10:return[3,11];case 11:return[2]}})})}),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,this._wsInitPromise];case 2:return a.sent(),this._wsReadySubsribers.forEach(function(c){var h=c.resolve;return h()}),[3,5];case 3:return a.sent(),this._wsReadySubsribers.forEach(function(c){var h=c.reject;return h()}),[3,5];case 4:return this._wsInitPromise=void 0,this._wsReadySubsribers=[],[7];case 5:return[2]}})})},this.initWebSocketEvent=function(){return new Promise(function(n,o){if(!r._ws)throw new Error("can not initWebSocketEvent, ws not exists");var i=!1;r._ws.onopen=function(a){console.warn("[realtime] ws event: open",a),i=!0,n()},r._ws.onerror=function(a){r._logins=new Map,i?(console.error("[realtime] ws event: error",a),r.clearHeartbeat(),r._virtualWSClient.forEach(function(c){return c.closeWithError(new Je({errCode:Be.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR,errMsg:a}))})):(console.error("[realtime] ws open failed with ws event: error",a),o(a))},r._ws.onclose=function(a){switch(console.warn("[realtime] ws event: close",a),r._logins=new Map,r.clearHeartbeat(),a.code){case Ge.ReconnectWebSocket:break;case Ge.NoRealtimeListeners:break;case Ge.HeartbeatPingError:case Ge.HeartbeatPongTimeoutError:case Ge.NormalClosure:case Ge.AbnormalClosure:{r._maxReconnect>0?r.initWebSocketConnection(!0,r._maxReconnect):r.closeAllClients(eo(a.code));break}case Ge.NoAuthentication:{r.closeAllClients(eo(a.code,a.reason));break}default:r._maxReconnect>0?r.initWebSocketConnection(!0,r._maxReconnect):r.closeAllClients(eo(a.code))}},r._ws.onmessage=function(a){var c=a.data;r.heartbeat();var h;try{h=JSON.parse(c)}catch(A){throw new Error("[realtime] onMessage parse res.data error: "+A)}if(h.msgType==="ERROR"){var s=null;r._virtualWSClient.forEach(function(A){A.watchId===h.watchId&&(s=A)}),s&&s.listener.onError(h)}var u=r._wsResponseWait.get(h.requestId);if(u){try{h.msgType==="ERROR"?u.reject(new y0(h)):u.resolve(h)}catch(A){console.error("ws onMessage responseWaitSpec.resolve(msg) errored:",A)}finally{r._wsResponseWait.delete(h.requestId)}if(u.skipOnMessage)return}if(h.msgType==="PONG"){if(r._lastPingSendTS){var d=Date.now()-r._lastPingSendTS;if(d>C0){console.warn("[realtime] untrusted rtt observed: "+d);return}r._rttObserved.length>=aa&&r._rttObserved.splice(0,r._rttObserved.length-aa+1),r._rttObserved.push(d)}return}var m=h.watchId&&r._watchIdClientMap.get(h.watchId);if(m)m.onMessage(h);else switch(console.error("[realtime] no realtime listener found responsible for watchId "+h.watchId+": ",h),h.msgType){case"INIT_EVENT":case"NEXT_EVENT":case"CHECK_EVENT":{m=r._queryIdClientMap.get(h.msgData.queryID),m&&m.onMessage(h);break}default:for(var v=0,b=Array.from(r._watchIdClientMap.entries());v<b.length;v++){var I=b[v],E=I[1];E.onMessage(h);break}}},r.heartbeat()})},this.isWSConnected=function(){return!!(r._ws&&r._ws.readyState===to.OPEN)},this.onceWSConnected=function(){return Qe(r,void 0,void 0,function(){var n=this;return Ze(this,function(o){return this.isWSConnected()?[2]:this._wsInitPromise?[2,this._wsInitPromise]:[2,new Promise(function(i,a){n._wsReadySubsribers.push({resolve:i,reject:a})})]})})},this.webLogin=function(n,o){return Qe(r,void 0,void 0,function(){var i,a,c,h,s,u,d,m,v=this;return Ze(this,function(b){switch(b.label){case 0:if(!o){if(n){if(i=this._logins.get(n),i){if(i.loggedIn&&i.loginResult)return[2,i.loginResult];if(i.loggingInPromise)return[2,i.loggingInPromise]}}else if(a=this._logins.get(""),a!=null&&a.loggingInPromise)return[2,a.loggingInPromise]}c=new Promise(function(I,E){return Qe(v,void 0,void 0,function(){var A,_,O,T,B;return Ze(this,function(P){switch(P.label){case 0:return P.trys.push([0,3,,4]),[4,this.getWsSign()];case 1:return A=P.sent(),_={envId:A.envId||"",accessToken:"",referrer:"web",sdkVersion:"",dataVersion:""},O={watchId:void 0,requestId:ur(),msgType:"LOGIN",msgData:_,exMsgData:{runtime:sa(),signStr:A.signStr,secretVersion:A.secretVersion}},[4,this.send({msg:O,waitResponse:!0,skipOnMessage:!0,timeout:F0})];case 2:return T=P.sent(),T.msgData.code?E(new Error(T.msgData.code+" "+T.msgData.message)):I({envId:A.envId}),[3,4];case 3:return B=P.sent(),E(B),[3,4];case 4:return[2]}})})}),h=n&&this._logins.get(n),s=Date.now(),h?(h.loggedIn=!1,h.loggingInPromise=c,h.loginStartTS=s):(h={loggedIn:!1,loggingInPromise:c,loginStartTS:s},this._logins.set(n||"",h)),b.label=1;case 1:return b.trys.push([1,3,,4]),[4,c];case 2:if(u=b.sent(),d=n&&this._logins.get(n),d&&d===h&&d.loginStartTS===s)return h.loggedIn=!0,h.loggingInPromise=void 0,h.loginStartTS=void 0,h.loginResult=u,[2,u];if(d){if(d.loggedIn&&d.loginResult)return[2,d.loginResult];if(d.loggingInPromise)return[2,d.loggingInPromise];throw new Error("ws unexpected login info")}else throw new Error("ws login info reset");case 3:throw m=b.sent(),h.loggedIn=!1,h.loggingInPromise=void 0,h.loginStartTS=void 0,h.loginResult=void 0,m;case 4:return[2]}})})},this.getWsSign=function(){return Qe(r,void 0,void 0,function(){var n,o,i,a,c,h,s;return Ze(this,function(u){switch(u.label){case 0:return this._wsSign&&this._wsSign.expiredTs>Date.now()?[2,this._wsSign]:(n=Date.now()+6e4,[4,this._context.appConfig.request.send("auth.wsWebSign",{runtime:sa()})]);case 1:if(o=u.sent(),o.code)throw new Error("[tcb-js-sdk] 获取实时数据推送登录票据失败: "+o.code);if(o.data)return i=o.data,a=i.signStr,c=i.wsUrl,h=i.secretVersion,s=i.envId,[2,{signStr:a,wsUrl:c,secretVersion:h,envId:s,expiredTs:n}];throw new Error("[tcb-js-sdk] 获取实时数据推送登录票据失败")}})})},this.getWaitExpectedTimeoutLength=function(){return r._rttObserved.length?r._rttObserved.reduce(function(n,o){return n+o})/r._rttObserved.length*1.5:R0},this.ping=function(){return Qe(r,void 0,void 0,function(){var n;return Ze(this,function(o){switch(o.label){case 0:return n={watchId:void 0,requestId:ur(),msgType:"PING",msgData:null},[4,this.send({msg:n})];case 1:return o.sent(),[2]}})})},this.onWatchStart=function(n,o){r._queryIdClientMap.set(o,n)},this.onWatchClose=function(n,o){o&&r._queryIdClientMap.delete(o),r._watchIdClientMap.delete(n.watchId),r._virtualWSClient.delete(n),r._virtualWSClient.size||r.close(Ge.NoRealtimeListeners)},this._maxReconnect=e.maxReconnect||P0,this._reconnectInterval=e.reconnectInterval||B0,this._context=e.context}return t.prototype.clearHeartbeat=function(){this._pingTimeoutId&&clearTimeout(this._pingTimeoutId),this._pongTimeoutId&&clearTimeout(this._pongTimeoutId)},t.prototype.close=function(e){this.clearHeartbeat(),this._ws&&(this._ws.close(e,Ru[e].name),this._ws=void 0)},t.prototype.watch=function(e){!this._ws&&!this._wsInitPromise&&this.initWebSocketConnection(!1);var r=new I0(jn(jn({},e),{send:this.send,login:this.webLogin,isWSConnected:this.isWSConnected,onceWSConnected:this.onceWSConnected,getWaitExpectedTimeoutLength:this.getWaitExpectedTimeoutLength,onWatchStart:this.onWatchStart,onWatchClose:this.onWatchClose,debug:!0}));return this._virtualWSClient.add(r),this._watchIdClientMap.set(r.watchId,r),r.listener},t.prototype.heartbeat=function(e){var r=this;this.clearHeartbeat(),this._pingTimeoutId=setTimeout(function(){return Qe(r,void 0,void 0,function(){var n=this;return Ze(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),!this._ws||this._ws.readyState!==to.OPEN?[2]:(this._lastPingSendTS=Date.now(),[4,this.ping()]);case 1:return o.sent(),this._pingFailed=0,this._pongTimeoutId=setTimeout(function(){console.error("pong timed out"),n._pongMissed<L0?(n._pongMissed++,n.heartbeat(!0)):n.initWebSocketConnection(!0)},this._context.appConfig.realtimePongWaitTimeout),[3,3];case 2:return o.sent(),this._pingFailed<D0?(this._pingFailed++,this.heartbeat()):this.close(Ge.HeartbeatPingError),[3,3];case 3:return[2]}})})},e?0:this._context.appConfig.realtimePingInterval)},t}(),k0={target:"database",entity:function(){var t=this.platform,e=t.adapter,r=t.runtime;x0(e.wsClass),N0(r)}},M0={name:"realtime",IIFE:!0,entity:function(){this.prototype.wsClientClass=U0}};try{cloudbase.registerComponent(M0),cloudbase.registerHook(k0)}catch{}const $0="walle-quant-website-2cg83b3402af",En="pms",Uo=dr.init({env:$0}),bn=Uo.database(),ro=Uo.auth();class j0{async login(){return ro.anonymousAuthProvider().signIn()}hasLoginState(){return ro.hasLoginState()}uid(){return void 0||ro.currentUser.uid}}class W0{create({uid:e="",order:r={},key:n=""}){return bn.collection(En).add({uid:e,order:r,key:n})}query(e){return bn.collection(En).where({uid:e}).get()}delete(e){return bn.collection(En).where({uid:e}).delete()}watch(e,r=()=>{},n=()=>{}){return bn.collection(En).where({uid:e}).watch({onChange:r,onError:n})}}class q0{async native({amount:e,id:r,title:n,attach:o}){const i=async a=>({result:await(await fetch(a,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({total_fee:e,out_trade_no:r,body:n,attach:o})})).json()});try{const a=location.hostname==="localhost"?"/s/pay/native":"https://s.one-quant.com/pay/native";return await i(a)}catch{return await i("https://walle-quant-website-2cg83b3402af-1256154226.ap-shanghai.app.tcloudbase.com/pay/native")}}}const Ut={app:Uo,user:new j0,db:new W0,pay:new q0},H0="/assets/wx-Bfv1OeoY.png",K0={props:["visible","price","title","message","messageTip","messageSucc","messageFail","orderTitle","orderAttach","orderPrefix","showClose"],components:{ElDialog:da},data(){return{isVisible:this.$props.visible,isShowClose:this.$props.showClose||!1,amount:0,order:{qrcode:"",out_trade_no:"",pay_order_id:""},elmessage:this.$props.message||gf}},mounted(){this.$props.visible&&this.payment(this.$props.price)},unmounted(){this.hide()},methods:{show(){this.isVisible=!0},hide(){this.isVisible=!1,this.watcher&&this.watcher.close(),clearInterval(this.intervalId),this.elmessage.closeAll()},async payment(t,e=()=>{},r=()=>{},n=()=>{}){if(t&&(this.amount=t),this.amount<=0){this.elmessage.info("非法价格"),this.$emit("fail"),r();return}try{await Ut.user.login();const o=Ut.user.uid(),i=an().format("YYYYMMDD"),a=an().format("YYYYMMDD"),c=this.$props.orderPrefix||"9560",h=(this.$props.orderTitle?this.$props.orderTitle+" - ":"")+i.slice(4)+a.slice(4)+an().format("SSS"),s=this.$props.orderAttach||o,u=c+i+a+an().format("HHmmssSSSSSS"),d=+(this.amount*100).toFixed(),m=await Ut.pay.native({title:h,amount:d,id:u,attach:s});if(!(m.result.return_code===1&&m.result.qrcode)){this.elmessage.info({message:"请求支付二维码失败 请稍后重试"}),this.$emit("fail"),r();return}this.isVisible=!0,this.elmessage.closeAll(),this.elmessage.info({message:this.$props.messageTip||"请微信扫码完成支付 等待支付结果中",duration:0});const v=_=>_&&_.order&&_.order.out_trade_no==u?(this.watcher&&this.watcher.close(),clearInterval(this.intervalId),this.isVisible=!1,this.elmessage.closeAll(),this.elmessage.info({message:this.$props.messageSucc||"支付成功"}),this.$emit("succ",_),e(_),!0):!1,b=await Ut.db.query(o);(!b.data||!b.data.length)&&await Ut.db.create({uid:o}),this.order=m.result;let I=50;this.intervalId=setInterval(async()=>{I--;const _=await Ut.db.query(o);_&&_.data&&_.data.length&&v(_.data[0])||I===0&&(this.watcher&&this.watcher.close(),clearInterval(this.intervalId),this.elmessage.closeAll(),this.elmessage.info({message:this.$props.messageFail||"支付失败 请稍后重试"}),this.$emit("fail"),r())},6*1e3);const E=_=>{_.msgType!=="INIT_EVENT"&&v(_.docs[0])},A=()=>{};this.watcher=Ut.db.watch(o,E,A)}catch(o){try{window.__WALLE_GUARD&&window.__WALLE_GUARD.sendSecurityReport("pay|"+(o.message||"exception").toLowerCase(),o.stack||o)}catch{}}},async onClose(t){this.watcher&&this.watcher.close(),clearInterval(this.intervalId),this.elmessage.closeAll(),this.isVisible=!1,this.order={},t&&t(),this.$emit("close")}}},G0={class:"tips"},V0={class:"qrcode"},J0={class:"img"},Y0=["src"],X0={class:"price"},z0={key:0},Q0={class:"footer"};function Z0(t,e,r,n,o,i){const a=mf,c=da,h=vf;return _t(),Tn(c,{class:"payment-dialog-9527",modelValue:o.isVisible,"onUpdate:modelValue":e[0]||(e[0]=s=>o.isVisible=s),modal:!1,"close-on-click-modal":!1,"destroy-on-close":!0,"before-close":i.onClose,"show-close":o.isShowClose},{default:tt(()=>[wt(t.$slots,"header"),Pe("p",G0,Sn(t.$props.title||"微信扫码支付"),1),Pe("div",V0,[fa((_t(),Mr("div",J0,[Pe("img",{src:o.order.qrcode},null,8,Y0)])),[[h,!o.order.qrcode]]),Pe("h3",X0,[e[1]||(e[1]=Pe("span",{class:"icon-price"},"¥",-1)),un(" "+Sn(o.amount)+" ",1),e[2]||(e[2]=Pe("span",{class:"unit-price"},"元",-1))]),o.order.pay_order_id?(_t(),Mr("p",z0,"订单号 - "+Sn(o.order.pay_order_id),1)):On("",!0),e[3]||(e[3]=un(" 请使用微信扫码完成支付 结果返回前 请勿关闭页面 ")),e[4]||(e[4]=Pe("br",null,null,-1))]),Pe("div",Q0,[wt(t.$slots,"footer",{},()=>[e[7]||(e[7]=un(" 若支付出现异常 请将订单号提供给 ")),$r(a,{effect:"light",placement:"top"},{content:tt(()=>e[5]||(e[5]=[Pe("img",{src:H0,width:"100",style:{"margin-top":"5px"}},null,-1)])),default:tt(()=>[e[6]||(e[6]=Pe("a",{class:"custom-wx"},"客服",-1))]),_:1}),e[8]||(e[8]=un(" 处理 "))])])]),_:3},8,["modelValue","before-close","show-close"])}const tm=yf(K0,[["render",Z0]]);export{tm as default};
